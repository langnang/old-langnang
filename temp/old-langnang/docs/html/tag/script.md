# script - HTML

`<script>` 标签用于定义客户端脚本，比如 JavaScript。

script 元素既可以包含脚本语句，也可以通过 src 属性指向外部脚本文件。

必需的 type 属性规定脚本的 MIME 类型。

JavaScript 的常见应用时图像操作、表单验证以及动态内容更新。

## defer & async

浏览器在执行 HTML 的时候如果遇到 `<script>` 时会停止页面的渲染,去下载和执行 js 的文件直接遇见 `</scirpt>` 会继续渲染页面。故浏览器在执行 js 文件的时候浏览器表现为一片空白,为了解决这个问题 `ECMAScript` 定义了 `defer` 和 `async` 两个属性用于控制 JS 的下载和执行

### script defer

这个属性的用途是表面脚本在执行时不会影响页面的构造。也就是说，脚本会被延迟到整个页面都解析完毕后再运行。因此，在`<script>` 元素中设置 defer 属性，相当于告诉浏览器立即下载，但延迟执行。

HTML5 规范要求脚本按照他们出现的先后顺序执行，因此第一个延迟脚本会先于第二个延迟脚本执行，而这两个脚本会先于 `DOMContentLoaded` 事件执行。在现实当中，延迟脚本并不一定会按照顺序执行，也不一定会在 `DOMContentLoaded` 时间触发前执行，因此最好只包含一个延迟脚本。

对于 `defer`，我们可以认为是将外链的 js 放在了页面底部。js 的加载不会阻塞页面的渲染和资源的加载。不过 `defer` 会按照原本的 js 的顺序执行.

### script async

这个属性与 `defer` 类似，都用于改变处理脚本的行为。同样与 `defer` 类似，`async` 只适用于外部脚本文件，并告诉浏览器立即下载文件。但与 `defer` 不同的是，标记为 `async` 的脚本并不保证按照他们的先后顺序执行。
第二个脚本文件可能会在第一个脚本文件之前执行。因此确保两者之间互不依赖非常重要。指定 `async` 属性的目的是不让页面等待两个脚本下载和执行，从而异步加载页面其他内容。
和 `defer` 一样，会等待的资源不会阻塞其余资源的加载，也不会影响页面的加载。但是有一点需要注意下，在有 `async` 的情况下，js 一旦下载好了就会执行,也就是如果有多个 js，谁先加载完就先执行谁，所以很有可能不是按照原本的顺序来执行的。如果 js 前后有依赖性，用 `async`，就很有可能出错。

### 总结

这两个属性都会使 `script` 标签异步加载，然而执行的时机是不一样的。
也就是说 `async` 是乱序的，而 `defer` 是顺序执行的。
这也就决定了 `async` 比较适用于百度分析或者谷歌分析这类不依赖其他脚本的库。从图中可以看到一个普通的`<script>`标签的加载和解析都是同步的，会阻塞 DOM 的渲染，这也就是我们经常会把`<script>`写在 `<body>`底部的原因之一，为了防止加载资源而导致的长时间白屏，另一个原因是 js 可能会进行 DOM 操作，所以要在 DOM 全部渲染完后再执行。
`async` 比较适用于百度分析或者谷歌分析这类不依赖其他脚本的库

所以，通俗来讲，chrome 浏览器首先会请求 HTML 文档，然后对其中的各种资源调用相应的资源加载器进行异步网络请求，同时进行 DOM 渲染，直到遇到`<script>`标签的时候，主进程才会停止渲染等待此资源加载完毕然后调用 V8 引擎对 js 解析，继而继续进行 DOM 解析。我的理解如果加了 `async` 属性就相当于单独开了一个进程去独立加载和执行，而 `defer` 是和将`<script>`放到`<body>`底部一样的效果。
最稳妥的办法还是把`<script>`写在`<body>`底部，没有兼容性问题，没有白屏问题，没有执行顺序问题。

## 参考链接

- [HTML \<script> 标签](https://www.w3school.com.cn/tags/tag_script.asp)
- [html 小知识点 - 掘金](https://juejin.im/post/5cbac6ebf265da03a97ae7d4)
