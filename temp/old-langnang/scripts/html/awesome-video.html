<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Awesome Video</title>
		<link rel="shortcut icon" href="../favicon.ico" type="image/x-icon" />
		<!-- CSS only -->
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css" />

		<style type="text/css">
			::-webkit-scrollbar {
				width: 6px;
				height: 4px;
			}

			::-webkit-scrollbar-thumb {
				border-radius: 4px;
				background-color: #cbcbcb;
			}

			::-webkit-scrollbar-track-piece {
				background: #eee;
			}

			.search-wrapper {
				margin: 0 auto;
				height: 200px;
				width: 800px;
				overflow: hidden;
			}

			.search-wrapper .form-control,
			.search-wrapper .btn {
				border-radius: 999px;
			}

			.btn-circle {
				border-radius: 9999px;
			}

			#DPlayerList {
				height: 90%;
				overflow: auto;
				position: absolute;
				top: 0;
				right: 0;
				min-width: 100px;
				text-align: center;
			}

			#DPlayerList .list-group-item {
				display: none;
				padding: 0.5rem 1.25rem;
				background: #000000;
				border: 1px solid #ccc;
				color: #ccc;
			}

			#DPlayerList:hover .list-group-item {
				display: block;
			}
		</style>
	</head>

	<body>
		<header></header>

		<section class="search-wrapper">
			<div class="input-group input-group-lg" style="margin-top: 80px">
				<input type="text" class="form-control" id="searchInput" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-lg" value="" />
				<div class="input-group-append">
					<button class="btn btn-outline-secondary" type="button" onclick="search()">Search</button>
				</div>
			</div>
			<a href="https://www.okzyw.com/" target="_blank" class="badge badge-primary">OK 资源网</a>
		</section>
		<div class="container-fluid">
			<div class="row" id="okzyw"></div>
		</div>
		<div class="modal fade" id="DPlayerModal" tabindex="-1" role="dialog" aria-labelledby="DPlayer_title" style="display: none" aria-hidden="true">
			<div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="DPlayer_title">Modal title</h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">×</span>
						</button>
					</div>
					<div class="modal-body" style="padding: 0; height: 80vh; overflow: hidden">
						<iframe
							id="DPlayer"
							src=""
							frameborder="0"
							allowfullscreen="allowfullscreen"
							mozallowfullscreen="mozallowfullscreen"
							msallowfullscreen="msallowfullscreen"
							oallowfullscreen="oallowfullscreen"
							webkitallowfullscreen="webkitallowfullscreen"
							style="width: 100%; height: 100%"
						>
						</iframe>
						<div class="list-group" id="DPlayerList"></div>
					</div>
				</div>
			</div>
		</div>
		<footer></footer>
		<!-- JS, Popper.js, and jQuery -->
		<script
			src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
			integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
			crossorigin="anonymous"
		></script>
		<script
			src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
			integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
			crossorigin="anonymous"
		></script>
		<script
			src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"
			integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
			crossorigin="anonymous"
		></script>
		<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
		<script type="text/javascript">
			const call = {
				_okzyw: {
					list(val) {
						return axios(`https://api.okzy.tv/api.php/provide/vod/?ac=list&wd=${val}`);
					},
					detail(ids) {
						return axios(`https://api.okzy.tv/api.php/provide/vod/?ac=detail&ids=${ids.join(',')}`);
					},
				},
				okzyw(wd) {},
				_play_server: {},
			};
			const awesome = {};

			awesome._site = [{ title: 'OK 资源网', url: 'https://www.okzyw.com/' }];

			// OK 资源网：https://www.okzyw.com/
			awesome.okzyw = function (options, callback = () => {}) {
				let list_url = 'https://api.okzy.tv/api.php/provide/vod/?ac=list';
				let detail_url = 'https://api.okzy.tv/api.php/provide/vod/?ac=detail';

				for (let key in options.params) {
					list_url += `&${key}=${options.params[key]}`;
				}
				this.list = [];
				this.details = [];

				return axios(list_url)
					.then((res) => {
						if (res?.data?.list?.length > 0) {
							this.list = res.data.list;
							const ids = res.data.list.map((v) => v.vod_id);
							return axios(`https://api.okzy.tv/api.php/provide/vod/?ac=detail&ids=${ids.join(',')}`);
						}
					})
					.then((res) => {
						this.details = res.data.list.map((v) => {
							const note = v.vod_play_note;
							const form = v.vod_play_from.split(note);
							const url = v.vod_play_url.split(note);
							v.vod_details = form.reduce((total, v, k) => {
								total[v] = url[k].split('#').reduce((total, v) => {
									const kv = v.split('$');
									total.push({
										name: kv[0],
										src: kv[1],
									});
									return total;
								}, []);
								return total;
							}, {});
							return v;
						});

						return new Promise((resolve) => {
							resolve(this.details);
						});
					});

				this.draw = function () {};
				this.build = function () {};
				// return this.details;
			};

			// 在线播放器
			awesome._play_server = {
				ckm3u8(url) {
					return `https://www.dplayer.tv/dp/?url=${url}`;
				},
				kuyun(url) {
					return `https://www.dplayer.tv/dp/?url=${url}`;
				},
			};
		</script>
		<script type="text/javascript">
			const awesomes = [
				{
					title: '鸡毛飞上天2017',
					dplayer: [],
				},
			];

			function changeDPlayerSrc(e) {
				$('#DPlayer_title').html($(e).attr('data-modal-title'));
				$('#DPlayer').attr('src', 'https://langnang.github.io/views/DPlayer.html?url=' + $(e).attr('data-play-src'));
			}

			function showDPlayerModal(index, type) {
				const awe = awesomes[index];
				console.log(awe, type);
				$('#DPlayer_title').html(awe.vod_name);
				let list = ``;

				awe.vod_details[type].forEach((v) => {
					list += `
        <button type="button" class="list-group-item"
          data-play-src="${v.src}"
          data-modal-title="${awe.vod_name} - ${v.name}"
          onclick="changeDPlayerSrc(this)">
          ${v.name}
        </button>`;
				});
				$('#DPlayerList').html(list);

				$('#DPlayerModal').modal({
					backdrop: 'static',
					keyboard: false,
					focus: false,
				});
			}

			function search() {
				let val = $('#searchInput').val();
				$('#okzyw').html('');
				awesome.okzyw({ params: { wd: val } }).then((res) => {
					console.log(res);
					res.forEach((v) => {
						awesomes.push(v);
						console.log(v);
						let content = `
        <div class="col-sm-6 col-md-4 col-xl-3">
            <div class="card">
              <img src="${v.vod_pic}" class="card-img-top"
                alt="${v.vod_name}"
                title="${v.vod_blurb}" />
              <div class="card-body">
                <h5 class="card-title">${v.vod_name}</h5>
                <span class="badge badge-dark">${v.type_name}</span>
                <span class="badge badge-dark">${v.vod_remarks}</span>
                <span class="badge badge-dark">${v.vod_area}</span>
                <span class="badge badge-dark">${v.vod_lang}</span>
                <span class="badge badge-dark">${v.vod_year}</span>
                <span class="badge badge-dark">${v.vod_douban_score}</span>
                <span class="badge badge-dark">${v.vod_actor}</span>
                <span class="badge badge-dark">${v.vod_director}</span>`;
						console.log(awesomes.length - 1);
						for (let k in v.vod_details) {
							let func = '';
							if (k == 'ckm3u8') {
								func = `showDPlayerModal(${awesomes.length - 1},'${k}')`;
							}
							content += `
            <button type="button" class="btn btn-outline-dark btn-sm" data-toggle="modal" onclick="${func}">
              视频源：${k}
            </button>
          `;
						}
						content += `
              </div>
            </div>
          </div>
        `;
						$('#okzyw').append(content);
					});
				});
			}
		</script>
	</body>
</html>
