(window.webpackJsonp=window.webpackJsonp||[]).push([[168],{636:function(e,r,n){"use strict";n.r(r);var t=n(18),o=Object(t.a)({},(function(){var e=this,r=e.$createElement,n=e._self._c||r;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"vm-虚拟机-node-js-api-文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vm-虚拟机-node-js-api-文档"}},[e._v("#")]),e._v(" vm 虚拟机 | Node.js API 文档")]),e._v(" "),n("blockquote",[n("h2",{attrs:{id:"excerpt"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#excerpt"}},[e._v("#")]),e._v(" Excerpt")]),e._v(" "),n("p",[e._v("中英对照")])]),e._v(" "),n("hr"),e._v(" "),n("p",[n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm/vm_executing_javascript.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("strong",[e._v("源代码:")]),e._v(" "),n("a",{attrs:{href:"https://github.com/nodejs/node/blob/v12.22.12/lib/vm.js",target:"_blank",rel:"noopener noreferrer"}},[e._v("lib/vm.js"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("code",[e._v("vm")]),e._v(" 模块允许在 V8 虚拟机上下文中编译和运行代码。 "),n("strong",[n("code",[e._v("vm")]),e._v(" 模块不是安全的机制。 不要使用它来运行不受信任的代码。")])]),e._v(" "),n("p",[e._v("JavaScript 代码可以立即编译并运行，也可以编译、保存并稍后运行。")]),e._v(" "),n("p",[e._v("常见的用例是在不同的 V8 上下文中运行代码。 这意味着被调用的代码与调用代码具有不同的全局对象。")]),e._v(" "),n("p",[e._v("可以通过"),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#vm_what_does_it_mean_to_contextify_an_object",target:"_blank",rel:"noopener noreferrer"}},[e._v("上下文隔离化"),n("OutboundLink")],1),e._v("一个对象来提供上下文。 调用的代码将上下文中的任何属性视为全局变量。 由调用的代码引起的对全局变量的任何更改都反映在上下文对象中。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("const vm = require('vm');\n\nconst x = 1;\n\nconst context = { x: 2 };\nvm.createContext(context); // 上下文隔离化对象。\n\nconst code = 'x += 40; var y = 17;';\n// `x` 和 `y` 是上下文中的全局变量。\n// 最初，x 的值为 2，因为这是 context.x 的值。\nvm.runInContext(code, context);\n\nconsole.log(context.x); // 42\nconsole.log(context.y); // 17\n\nconsole.log(x); // 1; y 未定义。\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br")])]),n("h3",{attrs:{id:"vm-script-类"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vm-script-类"}},[e._v("#")]),e._v(" "),n("code",[e._v("vm.Script")]),e._v(" 类"),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#class-vmscript",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm/class_vm_script.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),n("OutboundLink")],1)]),e._v(" "),n("p",[e._v("新增于: v0.3.1")]),e._v(" "),n("p",[n("code",[e._v("vm.Script")]),e._v(" 类的实例包含可以在特定上下文中执行的预编译脚本。")]),e._v(" "),n("h4",{attrs:{id:"new-vm-script-code-options"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#new-vm-script-code-options"}},[e._v("#")]),e._v(" "),n("code",[e._v("new vm.Script(code[, options])")]),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#new-vmscriptcode-options",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm/new_vm_script_code_options.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),n("OutboundLink")],1)]),e._v(" "),n("ul",[n("li",[n("code",[e._v("code")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),e._v(" 要编译的 JavaScript 代码。")]),e._v(" "),n("li",[n("code",[e._v("options")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1),e._v(" | "),n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),e._v(" "),n("ul",[n("li",[n("code",[e._v("filename")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),e._v(" 指定此脚本生成的堆栈跟踪中使用的文件名。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("'evalmachine.<anonymous>'")]),e._v("。")]),e._v(" "),n("li",[n("code",[e._v("lineOffset")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("number",[n("OutboundLink")],1)],1),e._v(" 指定在此脚本生成的堆栈跟踪中显示的行号偏移量。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("0")]),e._v("。")]),e._v(" "),n("li",[n("code",[e._v("columnOffset")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("number",[n("OutboundLink")],1)],1),e._v(" "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("0")]),e._v("。")]),e._v(" "),n("li",[n("code",[e._v("cachedData")]),e._v(" "),n("a",{attrs:{href:"http://nodejs.cn/api/buffer.html#class-buffer",target:"_blank",rel:"noopener noreferrer"}},[n("Buffer",[n("OutboundLink")],1)],1),e._v(" | "),n("a",{attrs:{href:"http://url.nodejs.cn/oh3CkV",target:"_blank",rel:"noopener noreferrer"}},[n("TypedArray",[n("OutboundLink")],1)],1),e._v(" | "),n("a",{attrs:{href:"http://url.nodejs.cn/yCdVkD",target:"_blank",rel:"noopener noreferrer"}},[n("DataView",[n("OutboundLink")],1)],1),e._v(" 为所提供的源提供可选的 "),n("code",[e._v("Buffer")]),e._v(" 或 "),n("code",[e._v("TypedArray")]),e._v(" 或 "),n("code",[e._v("DataView")]),e._v("，其中包含 V8 的代码缓存数据。 当提供时，"),n("code",[e._v("cachedDataRejected")]),e._v(" 值将设置为 "),n("code",[e._v("true")]),e._v(" 或 "),n("code",[e._v("false")]),e._v("，具体取决于 V8 对数据的接受程度。")]),e._v(" "),n("li",[n("code",[e._v("produceCachedData")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1),e._v(" 当 "),n("code",[e._v("true")]),e._v(" 且没有 "),n("code",[e._v("cachedData")]),e._v(" 存在时，则 V8 将尝试为 "),n("code",[e._v("code")]),e._v(" 生成代码缓存数据。 当成功后，会生成带有 V8 代码缓存数据的 "),n("code",[e._v("Buffer")]),e._v(" 并存储在返回的 "),n("code",[e._v("vm.Script")]),e._v(" 实例的 "),n("code",[e._v("cachedData")]),e._v(" 属性中。 "),n("code",[e._v("cachedDataProduced")]),e._v(" 值将设置为 "),n("code",[e._v("true")]),e._v(" 或 "),n("code",[e._v("false")]),e._v("，这取决于代码缓存数据是否成功生成。 此选项"),n("strong",[e._v("已弃用")]),e._v("，支持 "),n("code",[e._v("script.createCachedData()")]),e._v("。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("false")]),e._v("。")]),e._v(" "),n("li",[n("code",[e._v("importModuleDynamically")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/ceTQa6",target:"_blank",rel:"noopener noreferrer"}},[n("Function",[n("OutboundLink")],1)],1),e._v(" 在调用 "),n("code",[e._v("import()")]),e._v(" 时在评估此模块期间调用。 如果未指定此选项，则调用 "),n("code",[e._v("import()")]),e._v(" 将使用 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/errors.html#ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING")]),n("OutboundLink")],1),e._v(" 拒绝。 此选项是实验模块 API 的一部分，不应被视为稳定的。\n"),n("ul",[n("li",[n("code",[e._v("specifier")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),e._v(" 传给 "),n("code",[e._v("import()")]),e._v(" 的说明符")]),e._v(" "),n("li",[n("code",[e._v("module")]),e._v(" "),n("a",{attrs:{href:"http://nodejs.cn/api/vm.html#class-vmmodule",target:"_blank",rel:"noopener noreferrer"}},[e._v("<vm.Module>"),n("OutboundLink")],1)]),e._v(" "),n("li",[e._v("返回: "),n("a",{attrs:{href:"http://url.nodejs.cn/uwQPrn",target:"_blank",rel:"noopener noreferrer"}},[n("Module",{attrs:{Namespace:"",Object:""}},[n("OutboundLink")],1)],1),e._v(" | "),n("a",{attrs:{href:"http://nodejs.cn/api/vm.html#class-vmmodule",target:"_blank",rel:"noopener noreferrer"}},[e._v("<vm.Module>"),n("OutboundLink")],1),e._v(" 建议返回 "),n("code",[e._v("vm.Module")]),e._v(" 以利用错误跟踪，并避免包含 "),n("code",[e._v("then")]),e._v(" 函数导出的命名空间出现问题。")])])])])])]),e._v(" "),n("p",[e._v("如果 "),n("code",[e._v("options")]),e._v(" 是字符串，则指定文件名。")]),e._v(" "),n("p",[e._v("创建新的 "),n("code",[e._v("vm.Script")]),e._v(" 对象编译 "),n("code",[e._v("code")]),e._v(" 但不运行它。 编译后的 "),n("code",[e._v("vm.Script")]),e._v(" 可以多次运行。 "),n("code",[e._v("code")]),e._v(" 没有绑定到任何全局对象；相反，它在每次运行之前绑定，只是为了那次运行。")]),e._v(" "),n("h4",{attrs:{id:"script-createcacheddata"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#script-createcacheddata"}},[e._v("#")]),e._v(" "),n("code",[e._v("script.createCachedData()")]),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#scriptcreatecacheddata",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm/script_createcacheddata.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),n("OutboundLink")],1)]),e._v(" "),n("p",[e._v("新增于: v10.6.0")]),e._v(" "),n("ul",[n("li",[e._v("返回: "),n("a",{attrs:{href:"http://nodejs.cn/api/buffer.html#class-buffer",target:"_blank",rel:"noopener noreferrer"}},[n("Buffer",[n("OutboundLink")],1)],1)])]),e._v(" "),n("p",[e._v("此方法可以随时调用任意次数。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("const script = new vm.Script(`\nfunction add(a, b) {\n  return a + b;\n}\n\nconst x = add(1, 2);\n`);\n\nconst cacheWithoutX = script.createCachedData();\n\nscript.runInThisContext();\n\nconst cacheWithX = script.createCachedData();\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br")])]),n("h4",{attrs:{id:"script-runincontext-contextifiedobject-options"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#script-runincontext-contextifiedobject-options"}},[e._v("#")]),e._v(" "),n("code",[e._v("script.runInContext(contextifiedObject[, options])")]),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#scriptrunincontextcontextifiedobject-options",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm/script_runincontext_contextifiedobject_options.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),n("OutboundLink")],1)]),e._v(" "),n("ul",[n("li",[n("p",[n("code",[e._v("contextifiedObject")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1),e._v(" "),n("code",[e._v("vm.createContext()")]),e._v(" 方法返回的"),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#vm_what_does_it_mean_to_contextify_an_object",target:"_blank",rel:"noopener noreferrer"}},[e._v("上下文隔离化的"),n("OutboundLink")],1),e._v("对象。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("options")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1)]),e._v(" "),n("ul",[n("li",[n("p",[n("code",[e._v("displayErrors")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1),e._v(" 当为 "),n("code",[e._v("true")]),e._v(" 时，如果编译 "),n("code",[e._v("code")]),e._v(" 时出现 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/errors.html#errors_class_error",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("Error")]),n("OutboundLink")],1),e._v("，则导致错误的代码行会附加到堆栈跟踪中。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("true")]),e._v("。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("timeout")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("integer",[n("OutboundLink")],1)],1),e._v(" 指定终止执行前执行 "),n("code",[e._v("code")]),e._v(" 的毫秒数。 如果执行终止，则将抛出 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/errors.html#errors_class_error",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("Error")]),n("OutboundLink")],1),e._v("。 此值必须是严格的正整数。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("breakOnSigint")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1)]),e._v(" "),n("p",[e._v("如果执行终止，则将抛出 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/errors.html#errors_class_error",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("Error")]),n("OutboundLink")],1),e._v("。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("false")]),e._v("。")])])])]),e._v(" "),n("li",[n("p",[e._v("返回: "),n("a",{attrs:{href:"http://url.nodejs.cn/6sTGdS",target:"_blank",rel:"noopener noreferrer"}},[n("any",[n("OutboundLink")],1)],1),e._v(" 脚本中执行的最后一条语句的结果。")])])]),e._v(" "),n("p",[e._v("在给定的 "),n("code",[e._v("contextifiedObject")]),e._v(" 中运行 "),n("code",[e._v("vm.Script")]),e._v(" 对象包含的编译代码并返回结果。 运行代码无权访问本地作用域。")]),e._v(" "),n("p",[e._v("下面的示例编译代码，增加一个全局变量，设置另一个全局变量的值，然后多次执行代码。 全局变量包含在 "),n("code",[e._v("context")]),e._v(" 对象中。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("const vm = require('vm');\n\nconst context = {\n  animal: 'cat',\n  count: 2\n};\n\nconst script = new vm.Script('count += 1; name = \"kitty\";');\n\nvm.createContext(context);\nfor (let i = 0; i < 10; ++i) {\n  script.runInContext(context);\n}\n\nconsole.log(context);\n// 打印: { animal: 'cat', count: 12, name: 'kitty' }\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br")])]),n("p",[e._v("使用 "),n("code",[e._v("timeout")]),e._v(" 或 "),n("code",[e._v("breakOnSigint")]),e._v(" 选项将导致新的事件循环和相应的线程被启动，其性能开销非零。")]),e._v(" "),n("h4",{attrs:{id:"script-runinnewcontext-contextobject-options"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#script-runinnewcontext-contextobject-options"}},[e._v("#")]),e._v(" "),n("code",[e._v("script.runInNewContext([contextObject[, options]])")]),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#scriptruninnewcontextcontextobject-options",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm/script_runinnewcontext_contextobject_options.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),n("OutboundLink")],1)]),e._v(" "),n("ul",[n("li",[n("code",[e._v("contextObject")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1),e._v(" 将被"),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#vm_what_does_it_mean_to_contextify_an_object",target:"_blank",rel:"noopener noreferrer"}},[e._v("上下文隔离化的"),n("OutboundLink")],1),e._v("对象。 如果为 "),n("code",[e._v("undefined")]),e._v("，则将创建新的对象。")]),e._v(" "),n("li",[n("code",[e._v("options")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1),e._v(" "),n("ul",[n("li",[n("p",[n("code",[e._v("displayErrors")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1),e._v(" 当为 "),n("code",[e._v("true")]),e._v(" 时，如果编译 "),n("code",[e._v("code")]),e._v(" 时出现 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/errors.html#errors_class_error",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("Error")]),n("OutboundLink")],1),e._v("，则导致错误的代码行会附加到堆栈跟踪中。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("true")]),e._v("。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("timeout")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("integer",[n("OutboundLink")],1)],1),e._v(" 指定终止执行前执行 "),n("code",[e._v("code")]),e._v(" 的毫秒数。 如果执行终止，则将抛出 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/errors.html#errors_class_error",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("Error")]),n("OutboundLink")],1),e._v("。 此值必须是严格的正整数。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("breakOnSigint")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1)]),e._v(" "),n("p",[e._v("如果执行终止，则将抛出 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/errors.html#errors_class_error",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("Error")]),n("OutboundLink")],1),e._v("。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("false")]),e._v("。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("contextName")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),e._v(" 新创建的上下文的可读名称。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("'VM Context i'")]),e._v(", 其中 "),n("code",[e._v("i")]),e._v(" 是创建的上下文的升序数字索引。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("contextOrigin")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),e._v(" 对应于新创建的用于显示目的的上下文的"),n("a",{attrs:{href:"http://url.nodejs.cn/SYyZxA",target:"_blank",rel:"noopener noreferrer"}},[e._v("来源"),n("OutboundLink")],1),e._v("。 来源的格式应该像 URL，但只有协议、主机和端口（如果需要），就像 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/url.html#url_class_url",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("URL")]),n("OutboundLink")],1),e._v(" 对象的 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/url.html#url_url_origin",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("url.origin")]),n("OutboundLink")],1),e._v(" 属性的值。 最值得注意的是，该字符串应省略尾部斜杠，因为它表示路径。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("''")]),e._v("。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("contextCodeGeneration")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1)]),e._v(" "),n("ul",[n("li",[n("code",[e._v("strings")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1),e._v(" 如果设置为 false，则任何对 "),n("code",[e._v("eval")]),e._v(" 或函数构造函数（"),n("code",[e._v("Function")]),e._v("、"),n("code",[e._v("GeneratorFunction")]),e._v(" 等）的调用都将抛出 "),n("code",[e._v("EvalError")]),e._v("。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("true")]),e._v("。")]),e._v(" "),n("li",[n("code",[e._v("wasm")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1),e._v(" 如果设置为 false，则任何编译 WebAssembly 模块的尝试都将抛出 "),n("code",[e._v("WebAssembly.CompileError")]),e._v("。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("true")]),e._v("。")])])])])]),e._v(" "),n("li",[e._v("返回: "),n("a",{attrs:{href:"http://url.nodejs.cn/6sTGdS",target:"_blank",rel:"noopener noreferrer"}},[n("any",[n("OutboundLink")],1)],1),e._v(" 脚本中执行的最后一条语句的结果。")])]),e._v(" "),n("p",[e._v("首先对给定的 "),n("code",[e._v("contextObject")]),e._v(" 进行上下文隔离化，在创建的上下文中运行 "),n("code",[e._v("vm.Script")]),e._v(" 对象包含的编译代码，并返回结果。 运行代码无权访问本地作用域。")]),e._v(" "),n("p",[e._v("以下示例编译设置全局变量的代码，然后在不同的上下文中多次执行代码。 全局变量设置并包含在每个单独的 "),n("code",[e._v("context")]),e._v(" 中。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("const vm = require('vm');\n\nconst script = new vm.Script('globalVar = \"set\"');\n\nconst contexts = [{}, {}, {}];\ncontexts.forEach((context) => {\n  script.runInNewContext(context);\n});\n\nconsole.log(contexts);\n// 打印: [{ globalVar: 'set' }, { globalVar: 'set' }, { globalVar: 'set' }]\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br")])]),n("h4",{attrs:{id:"script-runinthiscontext-options"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#script-runinthiscontext-options"}},[e._v("#")]),e._v(" "),n("code",[e._v("script.runInThisContext([options])")]),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#scriptruninthiscontextoptions",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm/script_runinthiscontext_options.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),n("OutboundLink")],1)]),e._v(" "),n("ul",[n("li",[n("p",[n("code",[e._v("options")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1)]),e._v(" "),n("ul",[n("li",[n("p",[n("code",[e._v("displayErrors")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1),e._v(" 当为 "),n("code",[e._v("true")]),e._v(" 时，如果编译 "),n("code",[e._v("code")]),e._v(" 时出现 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/errors.html#errors_class_error",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("Error")]),n("OutboundLink")],1),e._v("，则导致错误的代码行会附加到堆栈跟踪中。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("true")]),e._v("。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("timeout")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("integer",[n("OutboundLink")],1)],1),e._v(" 指定终止执行前执行 "),n("code",[e._v("code")]),e._v(" 的毫秒数。 如果执行终止，则将抛出 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/errors.html#errors_class_error",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("Error")]),n("OutboundLink")],1),e._v("。 此值必须是严格的正整数。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("breakOnSigint")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1)]),e._v(" "),n("p",[e._v("如果执行终止，则将抛出 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/errors.html#errors_class_error",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("Error")]),n("OutboundLink")],1),e._v("。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("false")]),e._v("。")])])])]),e._v(" "),n("li",[n("p",[e._v("返回: "),n("a",{attrs:{href:"http://url.nodejs.cn/6sTGdS",target:"_blank",rel:"noopener noreferrer"}},[n("any",[n("OutboundLink")],1)],1),e._v(" 脚本中执行的最后一条语句的结果。")])])]),e._v(" "),n("p",[e._v("在当前 "),n("code",[e._v("global")]),e._v(" 对象的上下文中运行 "),n("code",[e._v("vm.Script")]),e._v(" 包含的编译代码。 运行代码无权访问本地作用域，但_确实_有访问当前 "),n("code",[e._v("global")]),e._v(" 对象的权限。")]),e._v(" "),n("p",[e._v("下面的示例编译了增加 "),n("code",[e._v("global")]),e._v(" 变量的代码，然后多次执行该代码：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("const vm = require('vm');\n\nglobal.globalVar = 0;\n\nconst script = new vm.Script('globalVar += 1', { filename: 'myfile.vm' });\n\nfor (let i = 0; i < 1000; ++i) {\n  script.runInThisContext();\n}\n\nconsole.log(globalVar);\n\n// 1000\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br")])]),n("h3",{attrs:{id:"vm-module-类"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vm-module-类"}},[e._v("#")]),e._v(" "),n("code",[e._v("vm.Module")]),e._v(" 类"),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#class-vmmodule",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm/class_vm_module.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),n("OutboundLink")],1)]),e._v(" "),n("p",[e._v("新增于: v12.16.0")]),e._v(" "),n("p",[n("code",[e._v("vm.Module")]),e._v(" 类为在 VM 上下文中使用 ECMAScript 模块提供了低层接口。 它是 "),n("code",[e._v("vm.Script")]),e._v(" 类的对应物，它密切反映了 ECMAScript 规范中定义的"),n("a",{attrs:{href:"http://url.nodejs.cn/V6bsLN",target:"_blank",rel:"noopener noreferrer"}},[e._v("模块记录"),n("OutboundLink")],1),e._v("。")]),e._v(" "),n("p",[e._v("但是，与 "),n("code",[e._v("vm.Script")]),e._v(" 不同，每个 "),n("code",[e._v("vm.Module")]),e._v(" 对象都从它的创建开始绑定到上下文。 与 "),n("code",[e._v("vm.Script")]),e._v(" 对象的同步性质相比，对 "),n("code",[e._v("vm.Module")]),e._v(" 对象的操作本质上是异步的。 'async' 函数的使用有助于操作 "),n("code",[e._v("vm.Module")]),e._v(" 对象。")]),e._v(" "),n("p",[e._v("使用 "),n("code",[e._v("vm.Module")]),e._v(" 对象需要三个不同的步骤：创建/解析、链接、以及评估。 以下示例说明了这三个步骤")]),e._v(" "),n("p",[e._v("此实现位于比 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#esm_modules_ecmascript_modules",target:"_blank",rel:"noopener noreferrer"}},[e._v("ECMAScript 模块加载器"),n("OutboundLink")],1),e._v("更低的级别。 虽然计划提供支持，但也无法与加载器交互。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('const vm = require(\'vm\');\n\nconst contextifiedObject = vm.createContext({ secret: 42 });\n\n(async () => {\n  // 步骤 1\n  //\n  // Create a Module by constructing a new `vm.SourceTextModule` object. This\n  // parses the provided source text, throwing a `SyntaxError` if anything goes\n  // wrong. By default, a Module is created in the top context. But here, we\n  // specify `contextifiedObject` as the context this Module belongs to.\n  //\n  // Here, we attempt to obtain the default export from the module "foo", and\n  // put it into local binding "secret".\n\n  const bar = new vm.SourceTextModule(`\n    import s from \'foo\';\n    s;\n  `, { context: contextifiedObject });\n\n  // 步骤 2\n  //\n  // "Link" 此模块的导入依赖项。\n  //\n  // 提供的链接回调（“链接器”）接受两个参数：the\n  // parent module (`bar` in this case) and the string that is the specifier of\n  // the imported module. The callback is expected to return a Module that\n  // corresponds to the provided specifier, with certain requirements documented\n  // in `module.link()`.\n  //\n  // If linking has not started for the returned Module, the same linker\n  // callback will be called on the returned Module.\n  //\n  // Even top-level Modules without dependencies must be explicitly linked. The\n  // callback provided would never be called, however.\n  //\n  // link() 方法返回 Promise，\n  // 当链接器返回的所有 Promise 都解决时，则该 Promise 将被解决。\n  //\n  // Note: This is a contrived example in that the linker function creates a new\n  // "foo" module every time it is called. In a full-fledged module system, a\n  // cache would probably be used to avoid duplicated modules.\n\n  async function linker(specifier, referencingModule) {\n    if (specifier === \'foo\') {\n      return new vm.SourceTextModule(`\n        // The "secret" variable refers to the global variable we added to\n        // "contextifiedObject" when creating the context.\n        export default secret;\n      `, { context: referencingModule.context });\n\n      // Using `contextifiedObject` instead of `referencingModule.context`\n      // here would work as well.\n    }\n    throw new Error(`Unable to resolve dependency: ${specifier}`);\n  }\n  await bar.link(linker);\n\n  // 步骤 3\n  //\n  // Evaluate the Module. The evaluate() method returns a Promise with a single\n  // property "result" that contains the result of the very last statement\n  // executed in the Module. In the case of `bar`, it is `s;`, which refers to\n  // the default export of the `foo` module, the `secret` we set in the\n  // beginning to 42.\n\n  const { result } = await bar.evaluate();\n\n  console.log(result);\n  // 打印 42。\n})();\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br"),n("span",{staticClass:"line-number"},[e._v("19")]),n("br"),n("span",{staticClass:"line-number"},[e._v("20")]),n("br"),n("span",{staticClass:"line-number"},[e._v("21")]),n("br"),n("span",{staticClass:"line-number"},[e._v("22")]),n("br"),n("span",{staticClass:"line-number"},[e._v("23")]),n("br"),n("span",{staticClass:"line-number"},[e._v("24")]),n("br"),n("span",{staticClass:"line-number"},[e._v("25")]),n("br"),n("span",{staticClass:"line-number"},[e._v("26")]),n("br"),n("span",{staticClass:"line-number"},[e._v("27")]),n("br"),n("span",{staticClass:"line-number"},[e._v("28")]),n("br"),n("span",{staticClass:"line-number"},[e._v("29")]),n("br"),n("span",{staticClass:"line-number"},[e._v("30")]),n("br"),n("span",{staticClass:"line-number"},[e._v("31")]),n("br"),n("span",{staticClass:"line-number"},[e._v("32")]),n("br"),n("span",{staticClass:"line-number"},[e._v("33")]),n("br"),n("span",{staticClass:"line-number"},[e._v("34")]),n("br"),n("span",{staticClass:"line-number"},[e._v("35")]),n("br"),n("span",{staticClass:"line-number"},[e._v("36")]),n("br"),n("span",{staticClass:"line-number"},[e._v("37")]),n("br"),n("span",{staticClass:"line-number"},[e._v("38")]),n("br"),n("span",{staticClass:"line-number"},[e._v("39")]),n("br"),n("span",{staticClass:"line-number"},[e._v("40")]),n("br"),n("span",{staticClass:"line-number"},[e._v("41")]),n("br"),n("span",{staticClass:"line-number"},[e._v("42")]),n("br"),n("span",{staticClass:"line-number"},[e._v("43")]),n("br"),n("span",{staticClass:"line-number"},[e._v("44")]),n("br"),n("span",{staticClass:"line-number"},[e._v("45")]),n("br"),n("span",{staticClass:"line-number"},[e._v("46")]),n("br"),n("span",{staticClass:"line-number"},[e._v("47")]),n("br"),n("span",{staticClass:"line-number"},[e._v("48")]),n("br"),n("span",{staticClass:"line-number"},[e._v("49")]),n("br"),n("span",{staticClass:"line-number"},[e._v("50")]),n("br"),n("span",{staticClass:"line-number"},[e._v("51")]),n("br"),n("span",{staticClass:"line-number"},[e._v("52")]),n("br"),n("span",{staticClass:"line-number"},[e._v("53")]),n("br"),n("span",{staticClass:"line-number"},[e._v("54")]),n("br"),n("span",{staticClass:"line-number"},[e._v("55")]),n("br"),n("span",{staticClass:"line-number"},[e._v("56")]),n("br"),n("span",{staticClass:"line-number"},[e._v("57")]),n("br"),n("span",{staticClass:"line-number"},[e._v("58")]),n("br"),n("span",{staticClass:"line-number"},[e._v("59")]),n("br"),n("span",{staticClass:"line-number"},[e._v("60")]),n("br"),n("span",{staticClass:"line-number"},[e._v("61")]),n("br"),n("span",{staticClass:"line-number"},[e._v("62")]),n("br"),n("span",{staticClass:"line-number"},[e._v("63")]),n("br"),n("span",{staticClass:"line-number"},[e._v("64")]),n("br"),n("span",{staticClass:"line-number"},[e._v("65")]),n("br"),n("span",{staticClass:"line-number"},[e._v("66")]),n("br"),n("span",{staticClass:"line-number"},[e._v("67")]),n("br"),n("span",{staticClass:"line-number"},[e._v("68")]),n("br"),n("span",{staticClass:"line-number"},[e._v("69")]),n("br"),n("span",{staticClass:"line-number"},[e._v("70")]),n("br"),n("span",{staticClass:"line-number"},[e._v("71")]),n("br")])]),n("h4",{attrs:{id:"module-dependencyspecifiers"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#module-dependencyspecifiers"}},[e._v("#")]),e._v(" "),n("code",[e._v("module.dependencySpecifiers")]),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#moduledependencyspecifiers",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm/module_dependencyspecifiers.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),n("OutboundLink")],1)]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[e._v("<string[]>"),n("OutboundLink")],1)])]),e._v(" "),n("p",[e._v("该模块所有依赖项的说明符。 返回的数组被冻结，不允许对其进行任何更改。")]),e._v(" "),n("p",[e._v("对应于 ECMAScript 规范中"),n("a",{attrs:{href:"http://url.nodejs.cn/pe2Fus",target:"_blank",rel:"noopener noreferrer"}},[e._v("循环模块记录"),n("OutboundLink")],1),e._v("的 "),n("code",[e._v("[[RequestedModules]]")]),e._v(" 字段。")]),e._v(" "),n("h4",{attrs:{id:"module-error"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#module-error"}},[e._v("#")]),e._v(" "),n("code",[e._v("module.error")]),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#moduleerror",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm/module_error.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),n("OutboundLink")],1)]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"http://url.nodejs.cn/6sTGdS",target:"_blank",rel:"noopener noreferrer"}},[n("any",[n("OutboundLink")],1)],1)])]),e._v(" "),n("p",[e._v("如果 "),n("code",[e._v("module.status")]),e._v(" 为 "),n("code",[e._v("'errored'")]),e._v("，则该属性包含模块在求值过程中抛出的异常。 如果状态是别的，访问这个属性会导致抛出异常。")]),e._v(" "),n("p",[e._v("值 "),n("code",[e._v("undefined")]),e._v(" 不能用于由于可能与 "),n("code",[e._v("throw undefined;")]),e._v(" 有歧义而没有抛出异常的情况。")]),e._v(" "),n("p",[e._v("对应于 ECMAScript 规范中"),n("a",{attrs:{href:"http://url.nodejs.cn/pe2Fus",target:"_blank",rel:"noopener noreferrer"}},[e._v("循环模块记录"),n("OutboundLink")],1),e._v("的 "),n("code",[e._v("[[EvaluationError]]")]),e._v(" 字段。")]),e._v(" "),n("h4",{attrs:{id:"module-evaluate-options"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#module-evaluate-options"}},[e._v("#")]),e._v(" "),n("code",[e._v("module.evaluate([options])")]),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#moduleevaluateoptions",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm/module_evaluate_options.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),n("OutboundLink")],1)]),e._v(" "),n("ul",[n("li",[n("p",[n("code",[e._v("options")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1)]),e._v(" "),n("ul",[n("li",[n("p",[n("code",[e._v("timeout")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("integer",[n("OutboundLink")],1)],1),e._v(" 指定终止执行前要评估的毫秒数。 如果执行中断，则会抛出"),n("a",{attrs:{href:"http://nodejs.cn/api-v12/errors.html#errors_class_error",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("Error")]),n("OutboundLink")],1),e._v("。 此值必须是严格的正整数。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("breakOnSigint")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1)]),e._v(" "),n("p",[e._v("如果执行中断，则会抛出"),n("a",{attrs:{href:"http://nodejs.cn/api-v12/errors.html#errors_class_error",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("Error")]),n("OutboundLink")],1),e._v("。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("false")]),e._v("。")])])])]),e._v(" "),n("li",[n("p",[e._v("返回: "),n("a",{attrs:{href:"http://url.nodejs.cn/ri1kj8",target:"_blank",rel:"noopener noreferrer"}},[n("Promise",[n("OutboundLink")],1)],1)])])]),e._v(" "),n("p",[e._v("评估模块。")]),e._v(" "),n("p",[e._v("对应 ECMAScript 规范中"),n("a",{attrs:{href:"http://url.nodejs.cn/pe2Fus",target:"_blank",rel:"noopener noreferrer"}},[e._v("循环模块记录"),n("OutboundLink")],1),e._v("的 "),n("a",{attrs:{href:"http://url.nodejs.cn/J4YRhE",target:"_blank",rel:"noopener noreferrer"}},[e._v("Evaluate() 具体方法"),n("OutboundLink")],1),e._v("字段。")]),e._v(" "),n("h4",{attrs:{id:"module-link-linker"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#module-link-linker"}},[e._v("#")]),e._v(" "),n("code",[e._v("module.link(linker)")]),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#modulelinklinker",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm/module_link_linker.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),n("OutboundLink")],1)]),e._v(" "),n("ul",[n("li",[n("p",[n("code",[e._v("linker")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/ceTQa6",target:"_blank",rel:"noopener noreferrer"}},[n("Function",[n("OutboundLink")],1)],1)]),e._v(" "),n("ul",[n("li",[n("p",[n("code",[e._v("specifier")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1)]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("import foo from 'foo';\n//              ^^^^^ 模块说明符\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])])]),e._v(" "),n("li",[n("p",[n("code",[e._v("referencingModule")]),e._v(" "),n("a",{attrs:{href:"http://nodejs.cn/api/vm.html#class-vmmodule",target:"_blank",rel:"noopener noreferrer"}},[e._v("<vm.Module>"),n("OutboundLink")],1),e._v(" "),n("code",[e._v("Module")]),e._v(" 对象 "),n("code",[e._v("link()")]),e._v(" 被调用。")])]),e._v(" "),n("li",[n("p",[e._v("返回: "),n("a",{attrs:{href:"http://nodejs.cn/api/vm.html#class-vmmodule",target:"_blank",rel:"noopener noreferrer"}},[e._v("<vm.Module>"),n("OutboundLink")],1),e._v(" | "),n("a",{attrs:{href:"http://url.nodejs.cn/ri1kj8",target:"_blank",rel:"noopener noreferrer"}},[n("Promise",[n("OutboundLink")],1)],1)])])])]),e._v(" "),n("li",[n("p",[e._v("返回: "),n("a",{attrs:{href:"http://url.nodejs.cn/ri1kj8",target:"_blank",rel:"noopener noreferrer"}},[n("Promise",[n("OutboundLink")],1)],1)])])]),e._v(" "),n("p",[e._v("链接模块依赖项。 此方法必须在求值前调用，并且每个模块只能调用一次。")]),e._v(" "),n("p",[e._v("该函数应返回 "),n("code",[e._v("Module")]),e._v(" 对象或最终解析为 "),n("code",[e._v("Module")]),e._v(" 对象的 "),n("code",[e._v("Promise")]),e._v("。 返回的 "),n("code",[e._v("Module")]),e._v(" 必须满足以下两个不变量：")]),e._v(" "),n("ul",[n("li",[e._v("它必须与父 "),n("code",[e._v("Module")]),e._v(" 属于相同的上下文。")]),e._v(" "),n("li",[e._v("它的 "),n("code",[e._v("status")]),e._v(" 不能是 "),n("code",[e._v("'errored'")]),e._v("。")])]),e._v(" "),n("p",[e._v("如果返回的 "),n("code",[e._v("Module")]),e._v(" 的 "),n("code",[e._v("status")]),e._v(" 是 "),n("code",[e._v("'unlinked'")]),e._v("，则将在返回的 "),n("code",[e._v("Module")]),e._v(" 上递归调用此方法，并使用相同提供的 "),n("code",[e._v("linker")]),e._v(" 函数。")]),e._v(" "),n("p",[n("code",[e._v("link()")]),e._v(" 返回 "),n("code",[e._v("Promise")]),e._v("，当所有链接实例都解析为有效的 "),n("code",[e._v("Module")]),e._v(" 时，它将被解析，或者如果链接器函数抛出异常或返回无效的 "),n("code",[e._v("Module")]),e._v("，则被拒绝。")]),e._v(" "),n("p",[e._v("链接器函数大致对应于 ECMAScript 规范中实现定义的 "),n("a",{attrs:{href:"http://url.nodejs.cn/DjcMRi",target:"_blank",rel:"noopener noreferrer"}},[e._v("HostResolveImportedModule"),n("OutboundLink")],1),e._v(" 抽象操作，有几个关键区别：")]),e._v(" "),n("ul",[n("li",[e._v("当 "),n("a",{attrs:{href:"http://url.nodejs.cn/DjcMRi",target:"_blank",rel:"noopener noreferrer"}},[e._v("HostResolveImportedModule"),n("OutboundLink")],1),e._v(" 是同步的时，允许链接器函数是异步的。")])]),e._v(" "),n("p",[e._v("在模块链接期间使用的实际 "),n("a",{attrs:{href:"http://url.nodejs.cn/DjcMRi",target:"_blank",rel:"noopener noreferrer"}},[e._v("HostResolveImportedModule"),n("OutboundLink")],1),e._v(" 实现是一种返回链接期间链接的模块的实现。 因为那时所有模块都已经完全链接了，"),n("a",{attrs:{href:"http://url.nodejs.cn/DjcMRi",target:"_blank",rel:"noopener noreferrer"}},[e._v("HostResolveImportedModule"),n("OutboundLink")],1),e._v(" 实现是完全同步的每个规范。")]),e._v(" "),n("p",[e._v("对应 ECMAScript 规范中"),n("a",{attrs:{href:"http://url.nodejs.cn/pe2Fus",target:"_blank",rel:"noopener noreferrer"}},[e._v("循环模块记录"),n("OutboundLink")],1),e._v("的 "),n("a",{attrs:{href:"http://url.nodejs.cn/NSenof",target:"_blank",rel:"noopener noreferrer"}},[e._v("Link() 具体方法"),n("OutboundLink")],1),e._v("字段。")]),e._v(" "),n("h4",{attrs:{id:"module-namespace"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#module-namespace"}},[e._v("#")]),e._v(" "),n("code",[e._v("module.namespace")]),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#modulenamespace",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm/module_namespace.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),n("OutboundLink")],1)]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1)])]),e._v(" "),n("p",[e._v("模块的命名空间对象。 这仅在链接 ("),n("code",[e._v("module.link()")]),e._v(") 完成后可用。")]),e._v(" "),n("p",[e._v("对应于 ECMAScript 规范中的 "),n("a",{attrs:{href:"http://url.nodejs.cn/8AR3t2",target:"_blank",rel:"noopener noreferrer"}},[e._v("GetModuleNamespace"),n("OutboundLink")],1),e._v(" 抽象操作。")]),e._v(" "),n("h4",{attrs:{id:"module-status"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#module-status"}},[e._v("#")]),e._v(" "),n("code",[e._v("module.status")]),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#modulestatus",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm/module_status.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),n("OutboundLink")],1)]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1)])]),e._v(" "),n("p",[e._v("模块的当前状态。 将是以下之一：")]),e._v(" "),n("ul",[n("li",[n("p",[n("code",[e._v("'unlinked'")]),e._v(": "),n("code",[e._v("module.link()")]),e._v(" 还没有被调用。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("'linking'")]),e._v(": "),n("code",[e._v("module.link()")]),e._v(" 已被调用，但链接器函数返回的 Promise 尚未全部解决。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("'linked'")]),e._v(": 模块已成功链接，其所有依赖都已链接，但尚未调用 "),n("code",[e._v("module.evaluate()")]),e._v("。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("'evaluating'")]),e._v(": 该模块正在通过自身或父模块上的 "),n("code",[e._v("module.evaluate()")]),e._v(" 进行评估。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("'evaluated'")]),e._v(": 模块已成功评估。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("'errored'")]),e._v(": 模块已被评估，但抛出异常。")])])]),e._v(" "),n("p",[e._v("除了 "),n("code",[e._v("'errored'")]),e._v("，此状态字符串对应于规范的"),n("a",{attrs:{href:"http://url.nodejs.cn/pe2Fus",target:"_blank",rel:"noopener noreferrer"}},[e._v("循环模块记录"),n("OutboundLink")],1),e._v("的 "),n("code",[e._v("[[Status]]")]),e._v(" 字段。 "),n("code",[e._v("'errored'")]),e._v(" 对应于规范中的 "),n("code",[e._v("'evaluated'")]),e._v("，但 "),n("code",[e._v("[[EvaluationError]]")]),e._v(" 设置为不是 "),n("code",[e._v("undefined")]),e._v(" 的值。")]),e._v(" "),n("h4",{attrs:{id:"module-identifier"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#module-identifier"}},[e._v("#")]),e._v(" "),n("code",[e._v("module.identifier")]),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#moduleidentifier",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm/module_identifier.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),n("OutboundLink")],1)]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1)])]),e._v(" "),n("p",[e._v("当前模块的标识符，在构造函数中设置。")]),e._v(" "),n("h3",{attrs:{id:"vm-sourcetextmodule-类"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vm-sourcetextmodule-类"}},[e._v("#")]),e._v(" "),n("code",[e._v("vm.SourceTextModule")]),e._v(" 类"),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#class-vmsourcetextmodule",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm/class_vm_sourcetextmodule.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),n("OutboundLink")],1)]),e._v(" "),n("p",[e._v("新增于: v9.6.0")]),e._v(" "),n("ul",[n("li",[e._v("继承自: "),n("a",{attrs:{href:"http://nodejs.cn/api/vm.html#class-vmmodule",target:"_blank",rel:"noopener noreferrer"}},[e._v("<vm.Module>"),n("OutboundLink")],1)])]),e._v(" "),n("p",[n("code",[e._v("vm.SourceTextModule")]),e._v(" 类提供了 ECMAScript 规范中定义的"),n("a",{attrs:{href:"http://url.nodejs.cn/gCBZGk",target:"_blank",rel:"noopener noreferrer"}},[e._v("源文本模块记录"),n("OutboundLink")],1),e._v("。")]),e._v(" "),n("h4",{attrs:{id:"new-vm-sourcetextmodule-code-options"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#new-vm-sourcetextmodule-code-options"}},[e._v("#")]),e._v(" "),n("code",[e._v("new vm.SourceTextModule(code[, options])")]),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#new-vmsourcetextmodulecode-options",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm/new_vm_sourcetextmodule_code_options.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),n("OutboundLink")],1)]),e._v(" "),n("ul",[n("li",[n("code",[e._v("code")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),e._v(" 要解析的 JavaScript 模块代码")]),e._v(" "),n("li",[n("code",[e._v("options")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("identifier")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),e._v(" 用于堆栈跟踪的字符串。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("'vm:module(i)'")]),e._v(" 其中 "),n("code",[e._v("i")]),e._v(" 是上下文特定的升序索引。")]),e._v(" "),n("li",[n("code",[e._v("cachedData")]),e._v(" "),n("a",{attrs:{href:"http://nodejs.cn/api/buffer.html#class-buffer",target:"_blank",rel:"noopener noreferrer"}},[n("Buffer",[n("OutboundLink")],1)],1),e._v(" | "),n("a",{attrs:{href:"http://url.nodejs.cn/oh3CkV",target:"_blank",rel:"noopener noreferrer"}},[n("TypedArray",[n("OutboundLink")],1)],1),e._v(" | "),n("a",{attrs:{href:"http://url.nodejs.cn/yCdVkD",target:"_blank",rel:"noopener noreferrer"}},[n("DataView",[n("OutboundLink")],1)],1),e._v(" 为所提供的源提供可选的 "),n("code",[e._v("Buffer")]),e._v(" 或 "),n("code",[e._v("TypedArray")]),e._v(" 或 "),n("code",[e._v("DataView")]),e._v("，其中包含 V8 的代码缓存数据。 "),n("code",[e._v("code")]),e._v(" 必须与创建此 "),n("code",[e._v("cachedData")]),e._v(" 的模块相同。")]),e._v(" "),n("li",[n("code",[e._v("context")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1),e._v(" "),n("code",[e._v("vm.createContext()")]),e._v(" 方法返回的"),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#vm_what_does_it_mean_to_contextify_an_object",target:"_blank",rel:"noopener noreferrer"}},[e._v("上下文隔离化的"),n("OutboundLink")],1),e._v("对象，用于编译和评估此 "),n("code",[e._v("Module")]),e._v("。")]),e._v(" "),n("li",[n("code",[e._v("lineOffset")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("integer",[n("OutboundLink")],1)],1),e._v(" 指定在此 "),n("code",[e._v("Module")]),e._v(" 产生的堆栈跟踪中显示的行号偏移量。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("0")]),e._v("。")]),e._v(" "),n("li",[n("code",[e._v("columnOffset")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("integer",[n("OutboundLink")],1)],1),e._v(" "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("0")]),e._v("。")]),e._v(" "),n("li",[n("code",[e._v("initializeImportMeta")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/ceTQa6",target:"_blank",rel:"noopener noreferrer"}},[n("Function",[n("OutboundLink")],1)],1),e._v(" 在评估此 "),n("code",[e._v("Module")]),e._v(" 期间调用以初始化 "),n("code",[e._v("import.meta")]),e._v("。\n"),n("ul",[n("li",[n("code",[e._v("meta")]),e._v(" "),n("a",{attrs:{href:"http://nodejs.cn/api/esm.html#importmeta",target:"_blank",rel:"noopener noreferrer"}},[e._v("<import.meta>"),n("OutboundLink")],1)]),e._v(" "),n("li",[n("code",[e._v("module")]),e._v(" "),n("a",{attrs:{href:"http://nodejs.cn/api/vm.html#class-vmsourcetextmodule",target:"_blank",rel:"noopener noreferrer"}},[e._v("<vm.SourceTextModule>"),n("OutboundLink")],1)])])]),e._v(" "),n("li",[n("code",[e._v("importModuleDynamically")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/ceTQa6",target:"_blank",rel:"noopener noreferrer"}},[n("Function",[n("OutboundLink")],1)],1),e._v(" 在调用 "),n("code",[e._v("import()")]),e._v(" 时在评估此模块期间调用。 如果未指定此选项，则调用 "),n("code",[e._v("import()")]),e._v(" 将使用 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/errors.html#ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING")]),n("OutboundLink")],1),e._v(" 拒绝。\n"),n("ul",[n("li",[n("code",[e._v("specifier")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),e._v(" 传给 "),n("code",[e._v("import()")]),e._v(" 的说明符")]),e._v(" "),n("li",[n("code",[e._v("module")]),e._v(" "),n("a",{attrs:{href:"http://nodejs.cn/api/vm.html#class-vmmodule",target:"_blank",rel:"noopener noreferrer"}},[e._v("<vm.Module>"),n("OutboundLink")],1)]),e._v(" "),n("li",[e._v("返回: "),n("a",{attrs:{href:"http://url.nodejs.cn/uwQPrn",target:"_blank",rel:"noopener noreferrer"}},[n("Module",{attrs:{Namespace:"",Object:""}},[n("OutboundLink")],1)],1),e._v(" | "),n("a",{attrs:{href:"http://nodejs.cn/api/vm.html#class-vmmodule",target:"_blank",rel:"noopener noreferrer"}},[e._v("<vm.Module>"),n("OutboundLink")],1),e._v(" 建议返回 "),n("code",[e._v("vm.Module")]),e._v(" 以利用错误跟踪，并避免包含 "),n("code",[e._v("then")]),e._v(" 函数导出的命名空间出现问题。")])])])])])]),e._v(" "),n("p",[e._v("创建新的 "),n("code",[e._v("SourceTextModule")]),e._v(" 实例。")]),e._v(" "),n("p",[e._v("分配给作为对象的 "),n("code",[e._v("import.meta")]),e._v(" 对象的属性可能允许模块访问指定 "),n("code",[e._v("context")]),e._v(" 之外的信息。 使用 "),n("code",[e._v("vm.runInContext()")]),e._v(" 在特定上下文中创建对象。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("const vm = require('vm');\n\nconst contextifiedObject = vm.createContext({ secret: 42 });\n\n(async () => {\n  const module = new vm.SourceTextModule(\n    'Object.getPrototypeOf(import.meta.prop).secret = secret;',\n    {\n      initializeImportMeta(meta) {\n        // 注意：这个对象是在顶层上下文中创建的。因此，\n        // Object.getPrototypeOf(import.meta.prop) 指向\n        // 顶层上下文中的 Object.prototype，\n        // 而不是在上下文对象中。\n        meta.prop = {};\n      }\n    });\n  // 由于模块没有依赖关系，链接器函数永远不会被调用。\n  await module.link(() => {});\n  await module.evaluate();\n\n  // 现在，Object.prototype.secret 将等于 42。\n  //\n  // 要解决这个问题，则将上面的\n  //     meta.prop = {};\n  // 替换为\n  //     meta.prop = vm.runInContext('{}', contextifiedObject);\n})();\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br"),n("span",{staticClass:"line-number"},[e._v("19")]),n("br"),n("span",{staticClass:"line-number"},[e._v("20")]),n("br"),n("span",{staticClass:"line-number"},[e._v("21")]),n("br"),n("span",{staticClass:"line-number"},[e._v("22")]),n("br"),n("span",{staticClass:"line-number"},[e._v("23")]),n("br"),n("span",{staticClass:"line-number"},[e._v("24")]),n("br"),n("span",{staticClass:"line-number"},[e._v("25")]),n("br"),n("span",{staticClass:"line-number"},[e._v("26")]),n("br"),n("span",{staticClass:"line-number"},[e._v("27")]),n("br")])]),n("h4",{attrs:{id:"sourcetextmodule-createcacheddata"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sourcetextmodule-createcacheddata"}},[e._v("#")]),e._v(" "),n("code",[e._v("sourceTextModule.createCachedData()")]),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#sourcetextmodulecreatecacheddata",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm/sourcetextmodule_createcacheddata.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),n("OutboundLink")],1)]),e._v(" "),n("p",[e._v("新增于: v12.17.0")]),e._v(" "),n("ul",[n("li",[e._v("返回: "),n("a",{attrs:{href:"http://nodejs.cn/api/buffer.html#class-buffer",target:"_blank",rel:"noopener noreferrer"}},[n("Buffer",[n("OutboundLink")],1)],1)])]),e._v(" "),n("p",[e._v("在评估模块之前，可以多次调用此方法。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("// 创建初始模块\nconst module = new vm.SourceTextModule('const a = 1;');\n\n// 从这个模块创建缓存数据\nconst cachedData = module.createCachedData();\n\n// 使用缓存数据创建新的模块。代码必须相同。\nconst module2 = new vm.SourceTextModule('const a = 1;', { cachedData });\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br")])]),n("h3",{attrs:{id:"vm-syntheticmodule-类"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vm-syntheticmodule-类"}},[e._v("#")]),e._v(" "),n("code",[e._v("vm.SyntheticModule")]),e._v(" 类"),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#class-vmsyntheticmodule",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm/class_vm_syntheticmodule.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),n("OutboundLink")],1)]),e._v(" "),n("p",[e._v("新增于: v12.16.0")]),e._v(" "),n("ul",[n("li",[e._v("继承自: "),n("a",{attrs:{href:"http://nodejs.cn/api/vm.html#class-vmmodule",target:"_blank",rel:"noopener noreferrer"}},[e._v("<vm.Module>"),n("OutboundLink")],1)])]),e._v(" "),n("p",[n("code",[e._v("vm.SyntheticModule")]),e._v(" 类提供了 WebIDL 规范中定义的"),n("a",{attrs:{href:"http://url.nodejs.cn/bCp8jt",target:"_blank",rel:"noopener noreferrer"}},[e._v("合成模块记录"),n("OutboundLink")],1),e._v("。 合成模块的目的是提供通用的接口，用于将非 JavaScript 源暴露给 ECMAScript 模块图。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("const vm = require('vm');\n\nconst source = '{ \"a\": 1 }';\nconst module = new vm.SyntheticModule(['default'], function() {\n  const obj = JSON.parse(source);\n  this.setExport('default', obj);\n});\n\n// 在链接中使用 `module`...\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br")])]),n("h4",{attrs:{id:"new-vm-syntheticmodule-exportnames-evaluatecallback-options"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#new-vm-syntheticmodule-exportnames-evaluatecallback-options"}},[e._v("#")]),e._v(" "),n("code",[e._v("new vm.SyntheticModule(exportNames, evaluateCallback[, options])")]),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#new-vmsyntheticmoduleexportnames-evaluatecallback-options",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm/new_vm_syntheticmodule_exportnames_evaluatecallback_options.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),n("OutboundLink")],1)]),e._v(" "),n("p",[e._v("新增于: v12.16.0")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("exportNames")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[e._v("<string[]>"),n("OutboundLink")],1),e._v(" 将从模块导出的名称数组。")]),e._v(" "),n("li",[n("code",[e._v("evaluateCallback")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/ceTQa6",target:"_blank",rel:"noopener noreferrer"}},[n("Function",[n("OutboundLink")],1)],1),e._v(" 在评估模块时调用。")]),e._v(" "),n("li",[n("code",[e._v("options")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("identifier")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),e._v(" 用于堆栈跟踪的字符串。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("'vm:module(i)'")]),e._v(" 其中 "),n("code",[e._v("i")]),e._v(" 是上下文特定的升序索引。")]),e._v(" "),n("li",[n("code",[e._v("context")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1),e._v(" "),n("code",[e._v("vm.createContext()")]),e._v(" 方法返回的"),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#vm_what_does_it_mean_to_contextify_an_object",target:"_blank",rel:"noopener noreferrer"}},[e._v("上下文隔离化的"),n("OutboundLink")],1),e._v("对象，用于编译和评估此 "),n("code",[e._v("Module")]),e._v("。")])])])]),e._v(" "),n("p",[e._v("创建新的 "),n("code",[e._v("SyntheticModule")]),e._v(" 实例。")]),e._v(" "),n("p",[e._v("分配给此实例导出的对象可能允许模块的导入者访问指定 "),n("code",[e._v("context")]),e._v(" 之外的信息。 使用 "),n("code",[e._v("vm.runInContext()")]),e._v(" 在特定上下文中创建对象。")]),e._v(" "),n("h4",{attrs:{id:"syntheticmodule-setexport-name-value"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#syntheticmodule-setexport-name-value"}},[e._v("#")]),e._v(" "),n("code",[e._v("syntheticModule.setExport(name, value)")]),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#syntheticmodulesetexportname-value",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm/syntheticmodule_setexport_name_value.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),n("OutboundLink")],1)]),e._v(" "),n("p",[e._v("新增于: v12.16.0")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("name")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),e._v(" 要设置的导出名称。")]),e._v(" "),n("li",[n("code",[e._v("value")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/6sTGdS",target:"_blank",rel:"noopener noreferrer"}},[n("any",[n("OutboundLink")],1)],1),e._v(" 将导出设置为的值。")])]),e._v(" "),n("p",[e._v("此方法用于模块链接后设置导出的值。 如果在链接模块之前调用，则会抛出 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/errors.html#ERR_VM_MODULE_STATUS",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("ERR_VM_MODULE_STATUS")]),n("OutboundLink")],1),e._v(" 错误。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("const vm = require('vm');\n\n(async () => {\n  const m = new vm.SyntheticModule(['x'], () => {\n    m.setExport('x', 1);\n  });\n\n  await m.link(() => {});\n  await m.evaluate();\n\n  assert.strictEqual(m.namespace.x, 1);\n})();\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br")])]),n("h3",{attrs:{id:"vm-compilefunction-code-params-options"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vm-compilefunction-code-params-options"}},[e._v("#")]),e._v(" "),n("code",[e._v("vm.compileFunction(code[, params[, options]])")]),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#vmcompilefunctioncode-params-options",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm/vm_compilefunction_code_params_options.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),n("OutboundLink")],1)]),e._v(" "),n("p",[e._v("新增于: v10.10.0")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("code")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),e._v(" 要编译的函数体。")]),e._v(" "),n("li",[n("code",[e._v("params")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[e._v("<string[]>"),n("OutboundLink")],1),e._v(" 包含函数所有参数的字符串数组。")]),e._v(" "),n("li",[n("code",[e._v("options")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1),e._v(" "),n("ul",[n("li",[n("code",[e._v("filename")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),e._v(" 指定此脚本生成的堆栈跟踪中使用的文件名。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("''")]),e._v("。")]),e._v(" "),n("li",[n("code",[e._v("lineOffset")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("number",[n("OutboundLink")],1)],1),e._v(" 指定在此脚本生成的堆栈跟踪中显示的行号偏移量。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("0")]),e._v("。")]),e._v(" "),n("li",[n("code",[e._v("columnOffset")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("number",[n("OutboundLink")],1)],1),e._v(" "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("0")]),e._v("。")]),e._v(" "),n("li",[n("code",[e._v("cachedData")]),e._v(" "),n("a",{attrs:{href:"http://nodejs.cn/api/buffer.html#class-buffer",target:"_blank",rel:"noopener noreferrer"}},[n("Buffer",[n("OutboundLink")],1)],1),e._v(" | "),n("a",{attrs:{href:"http://url.nodejs.cn/oh3CkV",target:"_blank",rel:"noopener noreferrer"}},[n("TypedArray",[n("OutboundLink")],1)],1),e._v(" | "),n("a",{attrs:{href:"http://url.nodejs.cn/yCdVkD",target:"_blank",rel:"noopener noreferrer"}},[n("DataView",[n("OutboundLink")],1)],1),e._v(" 为所提供的源提供可选的 "),n("code",[e._v("Buffer")]),e._v(" 或 "),n("code",[e._v("TypedArray")]),e._v(" 或 "),n("code",[e._v("DataView")]),e._v("，其中包含 V8 的代码缓存数据。")]),e._v(" "),n("li",[n("code",[e._v("produceCachedData")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1),e._v(" 指定是否产生新的缓存数据。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("false")]),e._v("。")]),e._v(" "),n("li",[n("code",[e._v("parsingContext")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1),e._v(" 应在其中编译所述函数的"),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#vm_what_does_it_mean_to_contextify_an_object",target:"_blank",rel:"noopener noreferrer"}},[e._v("上下文隔离化的"),n("OutboundLink")],1),e._v("对象。")]),e._v(" "),n("li",[n("code",[e._v("contextExtensions")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[e._v("<Object[]>"),n("OutboundLink")],1),e._v(" 包含要在编译时应用的上下文扩展集合（包含当前作用域的对象）的数组。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("[]")]),e._v("。")])])]),e._v(" "),n("li",[e._v("返回: "),n("a",{attrs:{href:"http://url.nodejs.cn/ceTQa6",target:"_blank",rel:"noopener noreferrer"}},[n("Function",[n("OutboundLink")],1)],1)])]),e._v(" "),n("p",[e._v("将给定的代码编译到提供的上下文中（如果没有提供上下文，则使用当前上下文），并返回它包装在具有给定 "),n("code",[e._v("params")]),e._v(" 的函数中。")]),e._v(" "),n("h3",{attrs:{id:"vm-createcontext-contextobject-options"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vm-createcontext-contextobject-options"}},[e._v("#")]),e._v(" "),n("code",[e._v("vm.createContext([contextObject[, options]])")]),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#vmcreatecontextcontextobject-options",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm/vm_createcontext_contextobject_options.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),n("OutboundLink")],1)]),e._v(" "),n("ul",[n("li",[n("code",[e._v("contextObject")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1)]),e._v(" "),n("li",[n("code",[e._v("options")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1),e._v(" "),n("ul",[n("li",[n("code",[e._v("name")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),e._v(" 新创建的上下文的可读名称。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("'VM Context i'")]),e._v(", 其中 "),n("code",[e._v("i")]),e._v(" 是创建的上下文的升序数字索引。")]),e._v(" "),n("li",[n("code",[e._v("origin")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),e._v(" 对应于新创建的用于显示目的的上下文的"),n("a",{attrs:{href:"http://url.nodejs.cn/SYyZxA",target:"_blank",rel:"noopener noreferrer"}},[e._v("来源"),n("OutboundLink")],1),e._v("。 来源的格式应该像 URL，但只有协议、主机和端口（如果需要），就像 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/url.html#url_class_url",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("URL")]),n("OutboundLink")],1),e._v(" 对象的 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/url.html#url_url_origin",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("url.origin")]),n("OutboundLink")],1),e._v(" 属性的值。 最值得注意的是，该字符串应省略尾部斜杠，因为它表示路径。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("''")]),e._v("。")]),e._v(" "),n("li",[n("code",[e._v("codeGeneration")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1),e._v(" "),n("ul",[n("li",[n("code",[e._v("strings")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1),e._v(" 如果设置为 false，则任何对 "),n("code",[e._v("eval")]),e._v(" 或函数构造函数（"),n("code",[e._v("Function")]),e._v("、"),n("code",[e._v("GeneratorFunction")]),e._v(" 等）的调用都将抛出 "),n("code",[e._v("EvalError")]),e._v("。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("true")]),e._v("。")]),e._v(" "),n("li",[n("code",[e._v("wasm")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1),e._v(" 如果设置为 false，则任何编译 WebAssembly 模块的尝试都将抛出 "),n("code",[e._v("WebAssembly.CompileError")]),e._v("。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("true")]),e._v("。")])])])])]),e._v(" "),n("li",[e._v("返回: "),n("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1),e._v(" 上下文隔离化的对象。")])]),e._v(" "),n("p",[e._v("如果给定 "),n("code",[e._v("contextObject")]),e._v("，"),n("code",[e._v("vm.createContext()")]),e._v(" 方法将"),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#vm_what_does_it_mean_to_contextify_an_object",target:"_blank",rel:"noopener noreferrer"}},[e._v("准备那个对象"),n("OutboundLink")],1),e._v("，以便它可以用于调用 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#vm_vm_runincontext_code_contextifiedobject_options",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("vm.runInContext()")]),n("OutboundLink")],1),e._v(" 或 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#vm_script_runincontext_contextifiedobject_options",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("script.runInContext()")]),n("OutboundLink")],1),e._v("。 在此类脚本中，"),n("code",[e._v("contextObject")]),e._v(" 将是全局对象，保留其所有现有属性，但也具有任何标准"),n("a",{attrs:{href:"http://url.nodejs.cn/hKgpea",target:"_blank",rel:"noopener noreferrer"}},[e._v("全局对象"),n("OutboundLink")],1),e._v("具有的内置对象和函数。 在 vm 模块运行的脚本之外，全局变量将保持不变。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("const vm = require('vm');\n\nglobal.globalVar = 3;\n\nconst context = { globalVar: 1 };\nvm.createContext(context);\n\nvm.runInContext('globalVar *= 2;', context);\n\nconsole.log(context);\n// 打印: { globalVar: 2 }\n\nconsole.log(global.globalVar);\n// 打印: 3\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br")])]),n("p",[e._v("如果省略 "),n("code",[e._v("contextObject")]),e._v("（或显式地作为 "),n("code",[e._v("undefined")]),e._v(" 传入），则将返回新的空的"),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#vm_what_does_it_mean_to_contextify_an_object",target:"_blank",rel:"noopener noreferrer"}},[e._v("上下文隔离化的"),n("OutboundLink")],1),e._v("对象。")]),e._v(" "),n("p",[n("code",[e._v("vm.createContext()")]),e._v(" 方法主要用于创建可用于运行多个脚本的单个上下文。 例如，如果模拟网络浏览器，则该方法可用于创建表示窗口全局对象的单个上下文，然后在该上下文中一起运行所有 "),n("code",[e._v("<script>")]),e._v(" 标签。")]),e._v(" "),n("p",[e._v("提供的上下文的 "),n("code",[e._v("name")]),e._v(" 和 "),n("code",[e._v("origin")]),e._v(" 通过检查器 API 可见。")]),e._v(" "),n("h3",{attrs:{id:"vm-iscontext-object"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vm-iscontext-object"}},[e._v("#")]),e._v(" "),n("code",[e._v("vm.isContext(object)")]),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#vmiscontextobject",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm/vm_iscontext_object.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),n("OutboundLink")],1)]),e._v(" "),n("p",[e._v("新增于: v0.11.7")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("object")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1)]),e._v(" "),n("li",[e._v("返回: "),n("a",{attrs:{href:"http://url.nodejs.cn/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1)])]),e._v(" "),n("p",[e._v("如果给定的 "),n("code",[e._v("oject")]),e._v(" 对象已使用 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#vm_vm_createcontext_contextobject_options",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("vm.createContext()")]),n("OutboundLink")],1),e._v(" "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#vm_what_does_it_mean_to_contextify_an_object",target:"_blank",rel:"noopener noreferrer"}},[e._v("上下文隔离化"),n("OutboundLink")],1),e._v("，则返回 "),n("code",[e._v("true")]),e._v("。")]),e._v(" "),n("h3",{attrs:{id:"vm-runincontext-code-contextifiedobject-options"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vm-runincontext-code-contextifiedobject-options"}},[e._v("#")]),e._v(" "),n("code",[e._v("vm.runInContext(code, contextifiedObject[, options])")]),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#vmrunincontextcode-contextifiedobject-options",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm/vm_runincontext_code_contextifiedobject_options.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),n("OutboundLink")],1)]),e._v(" "),n("ul",[n("li",[n("code",[e._v("code")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),e._v(" 要编译和运行的 JavaScript 代码。")]),e._v(" "),n("li",[n("code",[e._v("contextifiedObject")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1),e._v(" 编译和运行 "),n("code",[e._v("code")]),e._v(" 时将用作 "),n("code",[e._v("global")]),e._v(" 的"),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#vm_what_does_it_mean_to_contextify_an_object",target:"_blank",rel:"noopener noreferrer"}},[e._v("上下文隔离化的"),n("OutboundLink")],1),e._v("对象。")]),e._v(" "),n("li",[n("code",[e._v("options")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1),e._v(" | "),n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),e._v(" "),n("ul",[n("li",[n("p",[n("code",[e._v("filename")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),e._v(" 指定此脚本生成的堆栈跟踪中使用的文件名。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("'evalmachine.<anonymous>'")]),e._v("。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("lineOffset")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("number",[n("OutboundLink")],1)],1),e._v(" 指定在此脚本生成的堆栈跟踪中显示的行号偏移量。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("0")]),e._v("。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("columnOffset")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("number",[n("OutboundLink")],1)],1),e._v(" "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("0")]),e._v("。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("displayErrors")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1),e._v(" 当为 "),n("code",[e._v("true")]),e._v(" 时，如果编译 "),n("code",[e._v("code")]),e._v(" 时出现 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/errors.html#errors_class_error",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("Error")]),n("OutboundLink")],1),e._v("，则导致错误的代码行会附加到堆栈跟踪中。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("true")]),e._v("。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("timeout")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("integer",[n("OutboundLink")],1)],1),e._v(" 指定终止执行前执行 "),n("code",[e._v("code")]),e._v(" 的毫秒数。 如果执行终止，则将抛出 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/errors.html#errors_class_error",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("Error")]),n("OutboundLink")],1),e._v("。 此值必须是严格的正整数。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("breakOnSigint")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1)]),e._v(" "),n("p",[e._v("如果执行终止，则将抛出 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/errors.html#errors_class_error",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("Error")]),n("OutboundLink")],1),e._v("。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("false")]),e._v("。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("cachedData")]),e._v(" "),n("a",{attrs:{href:"http://nodejs.cn/api/buffer.html#class-buffer",target:"_blank",rel:"noopener noreferrer"}},[n("Buffer",[n("OutboundLink")],1)],1),e._v(" | "),n("a",{attrs:{href:"http://url.nodejs.cn/oh3CkV",target:"_blank",rel:"noopener noreferrer"}},[n("TypedArray",[n("OutboundLink")],1)],1),e._v(" | "),n("a",{attrs:{href:"http://url.nodejs.cn/yCdVkD",target:"_blank",rel:"noopener noreferrer"}},[n("DataView",[n("OutboundLink")],1)],1),e._v(" 为所提供的源提供可选的 "),n("code",[e._v("Buffer")]),e._v(" 或 "),n("code",[e._v("TypedArray")]),e._v(" 或 "),n("code",[e._v("DataView")]),e._v("，其中包含 V8 的代码缓存数据。 当提供时，"),n("code",[e._v("cachedDataRejected")]),e._v(" 值将设置为 "),n("code",[e._v("true")]),e._v(" 或 "),n("code",[e._v("false")]),e._v("，具体取决于 V8 对数据的接受程度。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("produceCachedData")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1),e._v(" 当 "),n("code",[e._v("true")]),e._v(" 且没有 "),n("code",[e._v("cachedData")]),e._v(" 存在时，则 V8 将尝试为 "),n("code",[e._v("code")]),e._v(" 生成代码缓存数据。 当成功后，会生成带有 V8 代码缓存数据的 "),n("code",[e._v("Buffer")]),e._v(" 并存储在返回的 "),n("code",[e._v("vm.Script")]),e._v(" 实例的 "),n("code",[e._v("cachedData")]),e._v(" 属性中。 "),n("code",[e._v("cachedDataProduced")]),e._v(" 值将设置为 "),n("code",[e._v("true")]),e._v(" 或 "),n("code",[e._v("false")]),e._v("，这取决于代码缓存数据是否成功生成。 此选项"),n("strong",[e._v("已弃用")]),e._v("，支持 "),n("code",[e._v("script.createCachedData()")]),e._v("。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("false")]),e._v("。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("importModuleDynamically")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/ceTQa6",target:"_blank",rel:"noopener noreferrer"}},[n("Function",[n("OutboundLink")],1)],1),e._v(" 在调用 "),n("code",[e._v("import()")]),e._v(" 时在评估此模块期间调用。 如果未指定此选项，则调用 "),n("code",[e._v("import()")]),e._v(" 将使用 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/errors.html#ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING")]),n("OutboundLink")],1),e._v(" 拒绝。 此选项是实验模块 API 的一部分，不应被视为稳定的。")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("specifier")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),e._v(" 传给 "),n("code",[e._v("import()")]),e._v(" 的说明符")]),e._v(" "),n("li",[n("code",[e._v("module")]),e._v(" "),n("a",{attrs:{href:"http://nodejs.cn/api/vm.html#class-vmmodule",target:"_blank",rel:"noopener noreferrer"}},[e._v("<vm.Module>"),n("OutboundLink")],1)]),e._v(" "),n("li",[e._v("返回: "),n("a",{attrs:{href:"http://url.nodejs.cn/uwQPrn",target:"_blank",rel:"noopener noreferrer"}},[n("Module",{attrs:{Namespace:"",Object:""}},[n("OutboundLink")],1)],1),e._v(" | "),n("a",{attrs:{href:"http://nodejs.cn/api/vm.html#class-vmmodule",target:"_blank",rel:"noopener noreferrer"}},[e._v("<vm.Module>"),n("OutboundLink")],1),e._v(" 建议返回 "),n("code",[e._v("vm.Module")]),e._v(" 以利用错误跟踪，并避免包含 "),n("code",[e._v("then")]),e._v(" 函数导出的命名空间出现问题。")])])])])]),e._v(" "),n("li",[e._v("返回: "),n("a",{attrs:{href:"http://url.nodejs.cn/6sTGdS",target:"_blank",rel:"noopener noreferrer"}},[n("any",[n("OutboundLink")],1)],1),e._v(" 脚本中执行的最后一条语句的结果。")])]),e._v(" "),n("p",[n("code",[e._v("vm.runInContext()")]),e._v(" 方法编译 "),n("code",[e._v("code")]),e._v("，在 "),n("code",[e._v("contextifiedObject")]),e._v(" 的上下文中运行它，然后返回结果。 运行代码无权访问本地作用域。 "),n("code",[e._v("contextifiedObject")]),e._v(" 对象_必须_之前已经使用 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#vm_vm_createcontext_contextobject_options",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("vm.createContext()")]),n("OutboundLink")],1),e._v(" 方法"),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#vm_what_does_it_mean_to_contextify_an_object",target:"_blank",rel:"noopener noreferrer"}},[e._v("上下文隔离化"),n("OutboundLink")],1),e._v("。")]),e._v(" "),n("p",[e._v("如果 "),n("code",[e._v("options")]),e._v(" 是字符串，则指定文件名。")]),e._v(" "),n("p",[e._v("以下示例使用单个"),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#vm_what_does_it_mean_to_contextify_an_object",target:"_blank",rel:"noopener noreferrer"}},[e._v("上下文隔离化的"),n("OutboundLink")],1),e._v("对象编译并执行不同的脚本：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("const vm = require('vm');\n\nconst contextObject = { globalVar: 1 };\nvm.createContext(contextObject);\n\nfor (let i = 0; i < 10; ++i) {\n  vm.runInContext('globalVar *= 2;', contextObject);\n}\nconsole.log(contextObject);\n// 打印: { globalVar: 1024 }\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br")])]),n("h3",{attrs:{id:"vm-runinnewcontext-code-contextobject-options"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vm-runinnewcontext-code-contextobject-options"}},[e._v("#")]),e._v(" "),n("code",[e._v("vm.runInNewContext(code[, contextObject[, options]])")]),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#vmruninnewcontextcode-contextobject-options",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm/vm_runinnewcontext_code_contextobject_options.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),n("OutboundLink")],1)]),e._v(" "),n("ul",[n("li",[n("code",[e._v("code")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),e._v(" 要编译和运行的 JavaScript 代码。")]),e._v(" "),n("li",[n("code",[e._v("contextObject")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1),e._v(" 将被"),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#vm_what_does_it_mean_to_contextify_an_object",target:"_blank",rel:"noopener noreferrer"}},[e._v("上下文隔离化的"),n("OutboundLink")],1),e._v("对象。 如果为 "),n("code",[e._v("undefined")]),e._v("，则将创建新的对象。")]),e._v(" "),n("li",[n("code",[e._v("options")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1),e._v(" | "),n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),e._v(" "),n("ul",[n("li",[n("p",[n("code",[e._v("filename")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),e._v(" 指定此脚本生成的堆栈跟踪中使用的文件名。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("'evalmachine.<anonymous>'")]),e._v("。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("lineOffset")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("number",[n("OutboundLink")],1)],1),e._v(" 指定在此脚本生成的堆栈跟踪中显示的行号偏移量。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("0")]),e._v("。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("columnOffset")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("number",[n("OutboundLink")],1)],1),e._v(" "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("0")]),e._v("。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("displayErrors")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1),e._v(" 当为 "),n("code",[e._v("true")]),e._v(" 时，如果编译 "),n("code",[e._v("code")]),e._v(" 时出现 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/errors.html#errors_class_error",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("Error")]),n("OutboundLink")],1),e._v("，则导致错误的代码行会附加到堆栈跟踪中。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("true")]),e._v("。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("timeout")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("integer",[n("OutboundLink")],1)],1),e._v(" 指定终止执行前执行 "),n("code",[e._v("code")]),e._v(" 的毫秒数。 如果执行终止，则将抛出 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/errors.html#errors_class_error",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("Error")]),n("OutboundLink")],1),e._v("。 此值必须是严格的正整数。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("breakOnSigint")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1)]),e._v(" "),n("p",[e._v("如果执行终止，则将抛出 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/errors.html#errors_class_error",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("Error")]),n("OutboundLink")],1),e._v("。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("false")]),e._v("。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("contextName")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),e._v(" 新创建的上下文的可读名称。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("'VM Context i'")]),e._v(", 其中 "),n("code",[e._v("i")]),e._v(" 是创建的上下文的升序数字索引。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("contextOrigin")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),e._v(" 对应于新创建的用于显示目的的上下文的"),n("a",{attrs:{href:"http://url.nodejs.cn/SYyZxA",target:"_blank",rel:"noopener noreferrer"}},[e._v("来源"),n("OutboundLink")],1),e._v("。 来源的格式应该像 URL，但只有协议、主机和端口（如果需要），就像 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/url.html#url_class_url",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("URL")]),n("OutboundLink")],1),e._v(" 对象的 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/url.html#url_url_origin",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("url.origin")]),n("OutboundLink")],1),e._v(" 属性的值。 最值得注意的是，该字符串应省略尾部斜杠，因为它表示路径。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("''")]),e._v("。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("contextCodeGeneration")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1)]),e._v(" "),n("ul",[n("li",[n("code",[e._v("strings")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1),e._v(" 如果设置为 false，则任何对 "),n("code",[e._v("eval")]),e._v(" 或函数构造函数（"),n("code",[e._v("Function")]),e._v("、"),n("code",[e._v("GeneratorFunction")]),e._v(" 等）的调用都将抛出 "),n("code",[e._v("EvalError")]),e._v("。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("true")]),e._v("。")]),e._v(" "),n("li",[n("code",[e._v("wasm")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1),e._v(" 如果设置为 false，则任何编译 WebAssembly 模块的尝试都将抛出 "),n("code",[e._v("WebAssembly.CompileError")]),e._v("。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("true")]),e._v("。")])])]),e._v(" "),n("li",[n("p",[n("code",[e._v("cachedData")]),e._v(" "),n("a",{attrs:{href:"http://nodejs.cn/api/buffer.html#class-buffer",target:"_blank",rel:"noopener noreferrer"}},[n("Buffer",[n("OutboundLink")],1)],1),e._v(" | "),n("a",{attrs:{href:"http://url.nodejs.cn/oh3CkV",target:"_blank",rel:"noopener noreferrer"}},[n("TypedArray",[n("OutboundLink")],1)],1),e._v(" | "),n("a",{attrs:{href:"http://url.nodejs.cn/yCdVkD",target:"_blank",rel:"noopener noreferrer"}},[n("DataView",[n("OutboundLink")],1)],1),e._v(" 为所提供的源提供可选的 "),n("code",[e._v("Buffer")]),e._v(" 或 "),n("code",[e._v("TypedArray")]),e._v(" 或 "),n("code",[e._v("DataView")]),e._v("，其中包含 V8 的代码缓存数据。 当提供时，"),n("code",[e._v("cachedDataRejected")]),e._v(" 值将设置为 "),n("code",[e._v("true")]),e._v(" 或 "),n("code",[e._v("false")]),e._v("，具体取决于 V8 对数据的接受程度。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("produceCachedData")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1),e._v(" 当 "),n("code",[e._v("true")]),e._v(" 且没有 "),n("code",[e._v("cachedData")]),e._v(" 存在时，则 V8 将尝试为 "),n("code",[e._v("code")]),e._v(" 生成代码缓存数据。 当成功后，会生成带有 V8 代码缓存数据的 "),n("code",[e._v("Buffer")]),e._v(" 并存储在返回的 "),n("code",[e._v("vm.Script")]),e._v(" 实例的 "),n("code",[e._v("cachedData")]),e._v(" 属性中。 "),n("code",[e._v("cachedDataProduced")]),e._v(" 值将设置为 "),n("code",[e._v("true")]),e._v(" 或 "),n("code",[e._v("false")]),e._v("，这取决于代码缓存数据是否成功生成。 此选项"),n("strong",[e._v("已弃用")]),e._v("，支持 "),n("code",[e._v("script.createCachedData()")]),e._v("。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("false")]),e._v("。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("importModuleDynamically")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/ceTQa6",target:"_blank",rel:"noopener noreferrer"}},[n("Function",[n("OutboundLink")],1)],1),e._v(" 在调用 "),n("code",[e._v("import()")]),e._v(" 时在评估此模块期间调用。 如果未指定此选项，则调用 "),n("code",[e._v("import()")]),e._v(" 将使用 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/errors.html#ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING")]),n("OutboundLink")],1),e._v(" 拒绝。 此选项是实验模块 API 的一部分，不应被视为稳定的。")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("specifier")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),e._v(" 传给 "),n("code",[e._v("import()")]),e._v(" 的说明符")]),e._v(" "),n("li",[n("code",[e._v("module")]),e._v(" "),n("a",{attrs:{href:"http://nodejs.cn/api/vm.html#class-vmmodule",target:"_blank",rel:"noopener noreferrer"}},[e._v("<vm.Module>"),n("OutboundLink")],1)]),e._v(" "),n("li",[e._v("返回: "),n("a",{attrs:{href:"http://url.nodejs.cn/uwQPrn",target:"_blank",rel:"noopener noreferrer"}},[n("Module",{attrs:{Namespace:"",Object:""}},[n("OutboundLink")],1)],1),e._v(" | "),n("a",{attrs:{href:"http://nodejs.cn/api/vm.html#class-vmmodule",target:"_blank",rel:"noopener noreferrer"}},[e._v("<vm.Module>"),n("OutboundLink")],1),e._v(" 建议返回 "),n("code",[e._v("vm.Module")]),e._v(" 以利用错误跟踪，并避免包含 "),n("code",[e._v("then")]),e._v(" 函数导出的命名空间出现问题。")])])])])]),e._v(" "),n("li",[e._v("返回: "),n("a",{attrs:{href:"http://url.nodejs.cn/6sTGdS",target:"_blank",rel:"noopener noreferrer"}},[n("any",[n("OutboundLink")],1)],1),e._v(" 脚本中执行的最后一条语句的结果。")])]),e._v(" "),n("p",[n("code",[e._v("vm.runInNewContext()")]),e._v(" 首先将给定的 "),n("code",[e._v("contextObject")]),e._v(" 上下文化（如果作为 "),n("code",[e._v("undefined")]),e._v(" 传入，则创建新的 "),n("code",[e._v("contextObject")]),e._v("），编译 "),n("code",[e._v("code")]),e._v("，在创建的上下文中运行它，然后返回结果。 运行代码无权访问本地作用域。")]),e._v(" "),n("p",[e._v("如果 "),n("code",[e._v("options")]),e._v(" 是字符串，则指定文件名。")]),e._v(" "),n("p",[e._v("以下示例编译并执行增加全局变量并设置新变量的代码。 这些全局变量包含在 "),n("code",[e._v("contextObject")]),e._v(" 中。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("const vm = require('vm');\n\nconst contextObject = {\n  animal: 'cat',\n  count: 2\n};\n\nvm.runInNewContext('count += 1; name = \"kitty\"', contextObject);\nconsole.log(contextObject);\n// 打印: { animal: 'cat', count: 3, name: 'kitty' }\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br")])]),n("h3",{attrs:{id:"vm-runinthiscontext-code-options"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vm-runinthiscontext-code-options"}},[e._v("#")]),e._v(" "),n("code",[e._v("vm.runInThisContext(code[, options])")]),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#vmruninthiscontextcode-options",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm/vm_runinthiscontext_code_options.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),n("OutboundLink")],1)]),e._v(" "),n("ul",[n("li",[n("code",[e._v("code")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),e._v(" 要编译和运行的 JavaScript 代码。")]),e._v(" "),n("li",[n("code",[e._v("options")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1),e._v(" | "),n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),e._v(" "),n("ul",[n("li",[n("p",[n("code",[e._v("filename")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),e._v(" 指定此脚本生成的堆栈跟踪中使用的文件名。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("'evalmachine.<anonymous>'")]),e._v("。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("lineOffset")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("number",[n("OutboundLink")],1)],1),e._v(" 指定在此脚本生成的堆栈跟踪中显示的行号偏移量。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("0")]),e._v("。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("columnOffset")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("number",[n("OutboundLink")],1)],1),e._v(" "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("0")]),e._v("。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("displayErrors")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1),e._v(" 当为 "),n("code",[e._v("true")]),e._v(" 时，如果编译 "),n("code",[e._v("code")]),e._v(" 时出现 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/errors.html#errors_class_error",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("Error")]),n("OutboundLink")],1),e._v("，则导致错误的代码行会附加到堆栈跟踪中。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("true")]),e._v("。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("timeout")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("integer",[n("OutboundLink")],1)],1),e._v(" 指定终止执行前执行 "),n("code",[e._v("code")]),e._v(" 的毫秒数。 如果执行终止，则将抛出 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/errors.html#errors_class_error",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("Error")]),n("OutboundLink")],1),e._v("。 此值必须是严格的正整数。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("breakOnSigint")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1)]),e._v(" "),n("p",[e._v("如果执行终止，则将抛出 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/errors.html#errors_class_error",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("Error")]),n("OutboundLink")],1),e._v("。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("false")]),e._v("。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("cachedData")]),e._v(" "),n("a",{attrs:{href:"http://nodejs.cn/api/buffer.html#class-buffer",target:"_blank",rel:"noopener noreferrer"}},[n("Buffer",[n("OutboundLink")],1)],1),e._v(" | "),n("a",{attrs:{href:"http://url.nodejs.cn/oh3CkV",target:"_blank",rel:"noopener noreferrer"}},[n("TypedArray",[n("OutboundLink")],1)],1),e._v(" | "),n("a",{attrs:{href:"http://url.nodejs.cn/yCdVkD",target:"_blank",rel:"noopener noreferrer"}},[n("DataView",[n("OutboundLink")],1)],1),e._v(" 为所提供的源提供可选的 "),n("code",[e._v("Buffer")]),e._v(" 或 "),n("code",[e._v("TypedArray")]),e._v(" 或 "),n("code",[e._v("DataView")]),e._v("，其中包含 V8 的代码缓存数据。 当提供时，"),n("code",[e._v("cachedDataRejected")]),e._v(" 值将设置为 "),n("code",[e._v("true")]),e._v(" 或 "),n("code",[e._v("false")]),e._v("，具体取决于 V8 对数据的接受程度。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("produceCachedData")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1),e._v(" 当 "),n("code",[e._v("true")]),e._v(" 且没有 "),n("code",[e._v("cachedData")]),e._v(" 存在时，则 V8 将尝试为 "),n("code",[e._v("code")]),e._v(" 生成代码缓存数据。 当成功后，会生成带有 V8 代码缓存数据的 "),n("code",[e._v("Buffer")]),e._v(" 并存储在返回的 "),n("code",[e._v("vm.Script")]),e._v(" 实例的 "),n("code",[e._v("cachedData")]),e._v(" 属性中。 "),n("code",[e._v("cachedDataProduced")]),e._v(" 值将设置为 "),n("code",[e._v("true")]),e._v(" 或 "),n("code",[e._v("false")]),e._v("，这取决于代码缓存数据是否成功生成。 此选项"),n("strong",[e._v("已弃用")]),e._v("，支持 "),n("code",[e._v("script.createCachedData()")]),e._v("。 "),n("strong",[e._v("默认值:")]),e._v(" "),n("code",[e._v("false")]),e._v("。")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("importModuleDynamically")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/ceTQa6",target:"_blank",rel:"noopener noreferrer"}},[n("Function",[n("OutboundLink")],1)],1),e._v(" 在调用 "),n("code",[e._v("import()")]),e._v(" 时在评估此模块期间调用。 如果未指定此选项，则调用 "),n("code",[e._v("import()")]),e._v(" 将使用 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/errors.html#ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING")]),n("OutboundLink")],1),e._v(" 拒绝。 此选项是实验模块 API 的一部分，不应被视为稳定的。")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("specifier")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),e._v(" 传给 "),n("code",[e._v("import()")]),e._v(" 的说明符")]),e._v(" "),n("li",[n("code",[e._v("module")]),e._v(" "),n("a",{attrs:{href:"http://nodejs.cn/api/vm.html#class-vmmodule",target:"_blank",rel:"noopener noreferrer"}},[e._v("<vm.Module>"),n("OutboundLink")],1)]),e._v(" "),n("li",[e._v("返回: "),n("a",{attrs:{href:"http://url.nodejs.cn/uwQPrn",target:"_blank",rel:"noopener noreferrer"}},[n("Module",{attrs:{Namespace:"",Object:""}},[n("OutboundLink")],1)],1),e._v(" | "),n("a",{attrs:{href:"http://nodejs.cn/api/vm.html#class-vmmodule",target:"_blank",rel:"noopener noreferrer"}},[e._v("<vm.Module>"),n("OutboundLink")],1),e._v(" 建议返回 "),n("code",[e._v("vm.Module")]),e._v(" 以利用错误跟踪，并避免包含 "),n("code",[e._v("then")]),e._v(" 函数导出的命名空间出现问题。")])])])])]),e._v(" "),n("li",[e._v("返回: "),n("a",{attrs:{href:"http://url.nodejs.cn/6sTGdS",target:"_blank",rel:"noopener noreferrer"}},[n("any",[n("OutboundLink")],1)],1),e._v(" 脚本中执行的最后一条语句的结果。")])]),e._v(" "),n("p",[n("code",[e._v("vm.runInThisContext()")]),e._v(" 编译 "),n("code",[e._v("code")]),e._v("，在当前 "),n("code",[e._v("global")]),e._v(" 的上下文中运行它并返回结果。 运行代码无权访问局部作用域，但可以访问当前 "),n("code",[e._v("global")]),e._v(" 对象。")]),e._v(" "),n("p",[e._v("如果 "),n("code",[e._v("options")]),e._v(" 是字符串，则指定文件名。")]),e._v(" "),n("p",[e._v("以下示例说明使用 "),n("code",[e._v("vm.runInThisContext()")]),e._v(" 和 JavaScript "),n("a",{attrs:{href:"http://url.nodejs.cn/qHvCuM",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("eval()")]),n("OutboundLink")],1),e._v(" 函数来运行相同的代码：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("const vm = require('vm');\nlet localVar = 'initial value';\n\nconst vmResult = vm.runInThisContext('localVar = \"vm\";');\nconsole.log(`vmResult: '${vmResult}', localVar: '${localVar}'`);\n// 打印: vmResult: 'vm', localVar: 'initial value'\n\nconst evalResult = eval('localVar = \"eval\";');\nconsole.log(`evalResult: '${evalResult}', localVar: '${localVar}'`);\n// 打印: evalResult: 'eval', localVar: 'eval'\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br")])]),n("p",[e._v("因为 "),n("code",[e._v("vm.runInThisContext()")]),e._v(" 无权访问本地作用域，所以 "),n("code",[e._v("localVar")]),e._v(" 不变。 相比之下，"),n("a",{attrs:{href:"http://url.nodejs.cn/qHvCuM",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("eval()")]),n("OutboundLink")],1),e._v(" _确实_有权访问本地作用域，因此值 "),n("code",[e._v("localVar")]),e._v(" 已更改。 这样 "),n("code",[e._v("vm.runInThisContext()")]),e._v(" 很像 "),n("a",{attrs:{href:"http://url.nodejs.cn/RBapQS",target:"_blank",rel:"noopener noreferrer"}},[e._v("间接 "),n("code",[e._v("eval()")]),e._v(" 调用"),n("OutboundLink")],1),e._v("，例如 "),n("code",[e._v("(0,eval)('code')")]),e._v("。")]),e._v(" "),n("h3",{attrs:{id:"示例-在-vm-中运行-http-server"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#示例-在-vm-中运行-http-server"}},[e._v("#")]),e._v(" 示例：在 VM 中运行 HTTP Server"),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#example-running-an-http-server-within-a-vm",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm/example_running_an_http_server_within_a_vm.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),n("OutboundLink")],1)]),e._v(" "),n("p",[e._v("当使用 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#vm_script_runinthiscontext_options",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("script.runInThisContext()")]),n("OutboundLink")],1),e._v(" 或 "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#vm_vm_runinthiscontext_code_options",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("vm.runInThisContext()")]),n("OutboundLink")],1),e._v(" 时，代码在当前 V8 全局上下文中执行。 传给此 VM 上下文的代码将有自己的隔离作用域。")]),e._v(" "),n("p",[e._v("为了使用 "),n("code",[e._v("http")]),e._v(" 模块运行简单的 web 服务器，传给上下文的代码必须要么自己调用 "),n("code",[e._v("require('http')")]),e._v("，要么有对传给它的 "),n("code",[e._v("http")]),e._v(" 模块的引用。 例如：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("'use strict';\nconst vm = require('vm');\n\nconst code = `\n((require) => {\n  const http = require('http');\n\n  http.createServer((request, response) => {\n    response.writeHead(200, { 'Content-Type': 'text/plain' });\n    response.end('Hello World\\\\n');\n  }).listen(8124);\n\n  console.log('Server running at http://127.0.0.1:8124/');\n})`;\n\nvm.runInThisContext(code)(require);\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br")])]),n("p",[e._v("上述案例中的 "),n("code",[e._v("require()")]),e._v(" 与其传入的上下文共享状态。 当执行不受信任的代码时，这可能会带来风险，例如以不需要的方式更改上下文中的对象。")]),e._v(" "),n("h3",{attrs:{id:"上下文隔离化一个对象意味着什么"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#上下文隔离化一个对象意味着什么"}},[e._v("#")]),e._v(" 上下文隔离化一个对象意味着什么？"),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#what-does-it-mean-to-contextify-an-object",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm/what_does_it_mean_to_contextify_an_object.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),n("OutboundLink")],1)]),e._v(" "),n("p",[e._v('在 Node.js 中执行的所有 JavaScript 都在 "上下文" 的作用域内运行。 根据 '),n("a",{attrs:{href:"http://url.nodejs.cn/SBcUmh",target:"_blank",rel:"noopener noreferrer"}},[e._v("V8 嵌入器指南"),n("OutboundLink")],1),e._v("：")]),e._v(" "),n("blockquote",[n("p",[e._v("在 V8 中，上下文是一个执行环境，它允许单独的、不相关的 JavaScript 应用程序在 V8 的单个实例中运行。 必须明确指定要在其中运行任何 JavaScript 代码的上下文。")])]),e._v(" "),n("p",[e._v("当方法 "),n("code",[e._v("vm.createContext()")]),e._v(" 被调用时，"),n("code",[e._v("contextObject")]),e._v(" 参数（或者新创建的对象，如果 "),n("code",[e._v("contextObject")]),e._v(" 是 "),n("code",[e._v("undefined")]),e._v("）在内部与 V8 上下文的新实例相关联。 这个 V8 上下文使用 "),n("code",[e._v("vm")]),e._v(" 模块的方法提供了 "),n("code",[e._v("code")]),e._v(" 运行，它可以在隔离的全局环境中运行。 创建 V8 上下文并将其与 "),n("code",[e._v("contextObject")]),e._v(" 相关联的过程就是本文档所指的“上下文隔离化”对象。")]),e._v(" "),n("h3",{attrs:{id:"timeout-limitations-when-using-process-nexttick-promises-and-queuemicrotask"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#timeout-limitations-when-using-process-nexttick-promises-and-queuemicrotask"}},[e._v("#")]),e._v(" Timeout limitations when using "),n("code",[e._v("process.nextTick()")]),e._v(", promises, and "),n("code",[e._v("queueMicrotask()")]),n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm.html#timeout-limitations-when-using-processnexttick-promises-and-queuemicrotask",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("a",{attrs:{href:"http://nodejs.cn/api-v12/vm/timeout_limitations_when_using_process_nexttick_promises_and_queuemicrotask.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),n("OutboundLink")],1)]),e._v(" "),n("p",[e._v("例如，以下代码由 "),n("code",[e._v("vm.runInNewContext()")]),e._v(" 执行，超时时间为 5 毫秒，它安排了一个无限循环在 promise 解决后运行。 计划的循环永远不会被超时中断：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("const vm = require('vm');\n\nfunction loop() {\n  while (1) console.log(Date.now());\n}\n\nvm.runInNewContext(\n  'Promise.resolve().then(loop);',\n  { loop, console },\n  { timeout: 5 }\n);\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br")])])])}),[],!1,null,null,null);r.default=o.exports}}]);