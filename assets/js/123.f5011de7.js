(window.webpackJsonp=window.webpackJsonp||[]).push([[123],{592:function(e,t,r){"use strict";r.r(t);var n=r(18),s=Object(n.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"ecmascript-模块-node-js-api-文档"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#ecmascript-模块-node-js-api-文档"}},[e._v("#")]),e._v(" ECMAScript 模块 | Node.js API 文档")]),e._v(" "),r("blockquote",[r("h2",{attrs:{id:"excerpt"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#excerpt"}},[e._v("#")]),e._v(" Excerpt")]),e._v(" "),r("p",[e._v("中英对照")])]),e._v(" "),r("hr"),e._v(" "),r("p",[r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm/modules_ecmascript_modules.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),r("OutboundLink")],1)]),e._v(" "),r("h3",{attrs:{id:"介绍"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[e._v("#")]),e._v(" 介绍"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#introduction",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm/introduction.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("ECMAScript 模块是来打包 JavaScript 代码以供重用的"),r("a",{attrs:{href:"http://url.nodejs.cn/JQY1wd",target:"_blank",rel:"noopener noreferrer"}},[e._v("官方标准格式"),r("OutboundLink")],1),e._v("。 模块使用各种 "),r("a",{attrs:{href:"http://url.nodejs.cn/otfx5w",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("import")]),r("OutboundLink")],1),e._v(" 和 "),r("a",{attrs:{href:"http://url.nodejs.cn/JNCjeW",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("export")]),r("OutboundLink")],1),e._v(" 语句定义。")]),e._v(" "),r("p",[e._v("以下是 ES 模块导出函数的示例：")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// addTwo.mjs\nfunction addTwo(num) {\n  return num + 2;\n}\n\nexport { addTwo };\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br")])]),r("p",[e._v("以下是 ES 模块从 "),r("code",[e._v("addTwo.mjs")]),e._v(" 导入函数的示例：")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// app.mjs\nimport { addTwo } from './addTwo.mjs';\n\n// 打印: 6\nconsole.log(addTwo(4));\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br")])]),r("p",[e._v("Node.js 完全支持当前指定的 ECMAScript 模块，并且提供它们与其原始模块格式 "),r("a",{attrs:{href:"http://nodejs.cn/api-v12/modules.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("CommonJS"),r("OutboundLink")],1),e._v(" 之间的互操作性。")]),e._v(" "),r("h3",{attrs:{id:"启用"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#启用"}},[e._v("#")]),e._v(" 启用"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#enabling",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm/enabling.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("Node.js 默认将 JavaScript 代码视为 CommonJS 模块。 作者可以通过 "),r("code",[e._v(".mjs")]),e._v(" 文件扩展名、"),r("code",[e._v("package.json")]),e._v(" "),r("a",{attrs:{href:"http://nodejs.cn/api-v12/packages.html#packages_type",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v('"type"')]),r("OutboundLink")],1),e._v(" 字段、或 "),r("code",[e._v("--input-type")]),e._v(" 标志告诉 Node.js 将 JavaScript 代码视为 ECMAScript 模块。")]),e._v(" "),r("h3",{attrs:{id:"包"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#包"}},[e._v("#")]),e._v(" 包"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#packages",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("This section was moved to "),r("a",{attrs:{href:"http://nodejs.cn/api-v12/packages.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Modules: Packages"),r("OutboundLink")],1),e._v(".")]),e._v(" "),r("h3",{attrs:{id:"import-说明符"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#import-说明符"}},[e._v("#")]),e._v(" import 说明符"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#import-specifiers",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("h4",{attrs:{id:"术语"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#术语"}},[e._v("#")]),e._v(" 术语"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#terminology",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm/terminology.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("code",[e._v("import")]),e._v(" 语句的说明符是 "),r("code",[e._v("from")]),e._v(" 关键字之后的字符串，例如 "),r("code",[e._v("import { sep } from 'path'")]),e._v(" 中的 "),r("code",[e._v("'path'")]),e._v("。 说明符也用于 "),r("code",[e._v("export from")]),e._v(" 语句，并作为 "),r("code",[e._v("import()")]),e._v(" 表达式的参数。")]),e._v(" "),r("ul",[r("li",[r("p",[e._v("相对说明符，如 "),r("code",[e._v("'./startup.js'")]),e._v(" 或 "),r("code",[e._v("'../config.mjs'")]),e._v("。 它们指的是相对于导入文件位置的路径。")])]),e._v(" "),r("li",[r("p",[e._v("绝对说明符，如 "),r("code",[e._v("'file:///opt/nodejs/config.js'")]),e._v("。 它们直接且明确地引用完整的路径。")])])]),e._v(" "),r("h5",{attrs:{id:"node-导入"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#node-导入"}},[e._v("#")]),e._v(" node: 导入"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#node-imports",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm/node_imports.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("新增于: v12.20.0")]),e._v(" "),r("p",[e._v("此 URL 协议允许有效的绝对的 URL 字符串引用内置模块。")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("import fs from 'node:fs/promises';\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br")])]),r("h5",{attrs:{id:"data-导入"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#data-导入"}},[e._v("#")]),e._v(" data: 导入"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#data-imports",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm/data_imports.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("新增于: v12.10.0")]),e._v(" "),r("p",[r("a",{attrs:{href:"http://url.nodejs.cn/3Lb3vH",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("data:")]),e._v(" URL"),r("OutboundLink")],1),e._v(" 支持使用以下 MIME 类型导入：")]),e._v(" "),r("ul",[r("li",[r("code",[e._v("text/javascript")]),e._v(" 用于 ES 模块")]),e._v(" "),r("li",[r("code",[e._v("application/json")]),e._v(" 用于 JSON")]),e._v(" "),r("li",[r("code",[e._v("application/wasm")]),e._v(" 用于 Wasm")])]),e._v(" "),r("p",[r("code",[e._v("data:")]),e._v(" URL 只为内置模块解析"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#esm_terminology",target:"_blank",rel:"noopener noreferrer"}},[e._v("裸说明符"),r("OutboundLink")],1),e._v("和"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#esm_terminology",target:"_blank",rel:"noopener noreferrer"}},[e._v("绝对说明符"),r("OutboundLink")],1),e._v("。 解析"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#esm_terminology",target:"_blank",rel:"noopener noreferrer"}},[e._v("相对说明符"),r("OutboundLink")],1),e._v("不起作用，因为 "),r("code",[e._v("data:")]),e._v(" 不是"),r("a",{attrs:{href:"http://url.nodejs.cn/fbSryY",target:"_blank",rel:"noopener noreferrer"}},[e._v("特殊协议"),r("OutboundLink")],1),e._v("。 例如，尝试从 "),r("code",[e._v('data:text/javascript,import "./foo";')]),e._v(" 加载 "),r("code",[e._v("./foo")]),e._v(" 无法解析，因为 "),r("code",[e._v("data:")]),e._v(" URL 没有相对解析的概念。 正在使用的 "),r("code",[e._v("data:")]),e._v(" URL 示例是：")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("import 'data:text/javascript,console.log(\"hello!\");';\nimport _ from 'data:application/json,\"world!\"';\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br")])]),r("h3",{attrs:{id:"import-meta"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#import-meta"}},[e._v("#")]),e._v(" "),r("code",[e._v("import.meta")]),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#importmeta",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm/import_meta.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),r("OutboundLink")],1)]),e._v(" "),r("ul",[r("li",[r("p",[r("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[r("Object",[r("OutboundLink")],1)],1)])]),e._v(" "),r("li",[r("p",[r("code",[e._v("url")]),e._v(" "),r("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[r("string",[r("OutboundLink")],1)],1),e._v(" 模块的绝对的 "),r("code",[e._v("file:")]),e._v(" URL。")])])]),e._v(" "),r("h3",{attrs:{id:"es-模块和-commonjs-之间的差异"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#es-模块和-commonjs-之间的差异"}},[e._v("#")]),e._v(" ES 模块和 CommonJS 之间的差异"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#differences-between-es-modules-and-commonjs",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("h4",{attrs:{id:"强制的文件扩展名"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#强制的文件扩展名"}},[e._v("#")]),e._v(" 强制的文件扩展名"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#mandatory-file-extensions",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm/mandatory_file_extensions.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("还必须完全指定目录索引（例如 "),r("code",[e._v("'./startup/index.js'")]),e._v("）。")]),e._v(" "),r("p",[e._v("此行为与 "),r("code",[e._v("import")]),e._v(" 在浏览器环境中的行为方式相匹配，假设服务器是典型配置的。")]),e._v(" "),r("h4",{attrs:{id:"没有-node-path"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#没有-node-path"}},[e._v("#")]),e._v(" 没有 NODE_PATH"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#no-node_path",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm/no_node_path.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("code",[e._v("NODE_PATH")]),e._v(" 不是解析 "),r("code",[e._v("import")]),e._v(" 说明符的一部分。 如果需要这种行为，则使用符号链接。")]),e._v(" "),r("h4",{attrs:{id:"no-require-exports-module-exports-filename-dirname"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#no-require-exports-module-exports-filename-dirname"}},[e._v("#")]),e._v(" No "),r("code",[e._v("require")]),e._v(", "),r("code",[e._v("exports")]),e._v(", "),r("code",[e._v("module.exports")]),e._v(", "),r("code",[e._v("__filename")]),e._v(", "),r("code",[e._v("__dirname")]),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#no-require-exports-moduleexports-__filename-__dirname",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm/no_require_exports_module_exports_filename_dirname.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("这些 CommonJS 变量在 ES 模块中不可用。")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("import { fileURLToPath } from 'url';\nimport { dirname } from 'path';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = dirname(__filename);\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br")])]),r("h4",{attrs:{id:"没有-require-resolve"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#没有-require-resolve"}},[e._v("#")]),e._v(" 没有 require.resolve"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#no-requireresolve",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm/no_require_resolve.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),r("OutboundLink")],1)]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("(async () => {\n  const dependencyAsset = await import.meta.resolve('component-lib/asset.css');\n})();\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br")])]),r("p",[r("code",[e._v("import.meta.resolve")]),e._v(" 还接受第二个参数，它是从中解析的父模块：")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("(async () => {\n  // \n  await import.meta.resolve('./dep', import.meta.url);\n})();\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br")])]),r("h4",{attrs:{id:"没有-require-extensions"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#没有-require-extensions"}},[e._v("#")]),e._v(" 没有 require.extensions"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#no-requireextensions",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm/no_require_extensions.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("code",[e._v("require.extensions")]),e._v(" 没有被 "),r("code",[e._v("import")]),e._v(" 使用。 期望加载器钩子在未来可以提供这个工作流。")]),e._v(" "),r("h4",{attrs:{id:"没有-require-cache"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#没有-require-cache"}},[e._v("#")]),e._v(" 没有 require.cache"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#no-requirecache",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm/no_require_cache.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("code",[e._v("require.cache")]),e._v(" 没有被 "),r("code",[e._v("import")]),e._v(" 使用。")]),e._v(" "),r("h4",{attrs:{id:"url-based-paths"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#url-based-paths"}},[e._v("#")]),e._v(" URL-based paths"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#url-based-paths",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm/url_based_paths.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("这意味着包含 "),r("code",[e._v("#")]),e._v(" 和 "),r("code",[e._v("?")]),e._v(" 等特殊字符的文件需要转义。")]),e._v(" "),r("p",[e._v("如果用于解析模块的 "),r("code",[e._v("import")]),e._v(" 说明符具有不同的查询或片段，则会多次加载模块。")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("import './foo.mjs?query=1'; // 加载具有 \"?query=1\" 查询的 ./foo.mjs\nimport './foo.mjs?query=2'; // 加载具有 \"?query=2\" 查询的 ./foo.mjs\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br")])]),r("h3",{attrs:{id:"与-commonjs-的互操作性"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#与-commonjs-的互操作性"}},[e._v("#")]),e._v(" 与 CommonJS 的互操作性"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#interoperability-with-commonjs",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("h4",{attrs:{id:"require"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#require"}},[e._v("#")]),e._v(" "),r("code",[e._v("require")]),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#require",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("code",[e._v("require")]),e._v(" always treats the files it references as CommonJS. This applies whether "),r("code",[e._v("require")]),e._v(" is used the traditional way within a CommonJS environment, or in an ES module environment using "),r("a",{attrs:{href:"http://nodejs.cn/api-v12/module.html#module_module_createrequire_filename",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("module.createRequire()")]),r("OutboundLink")],1),e._v(".")]),e._v(" "),r("p",[e._v("To include an ES module into CommonJS, use "),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#esm_import_expressions",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("import()")]),r("OutboundLink")],1),e._v(".")]),e._v(" "),r("h4",{attrs:{id:"import-声明"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#import-声明"}},[e._v("#")]),e._v(" import 声明"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#import-statements",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm/import_statements.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("code",[e._v("import")]),e._v(" 语句可以引用 ES 模块或 CommonJS 模块。")]),e._v(" "),r("p",[e._v("当导入 "),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#esm_commonjs_namespaces",target:"_blank",rel:"noopener noreferrer"}},[e._v("CommonJS 模块"),r("OutboundLink")],1),e._v(" 时，提供 "),r("code",[e._v("module.exports")]),e._v(" 对象作为默认导出。 命名导出可能可用，由静态分析提供，以方便更好的生态系统兼容性。")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("import { sin, cos } from 'geometry/trigonometry-functions.mjs';\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br")])]),r("h4",{attrs:{id:"import-表达式"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#import-表达式"}},[e._v("#")]),e._v(" import() 表达式"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#import-expressions",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm/import_expressions.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"http://url.nodejs.cn/4WGpC7",target:"_blank",rel:"noopener noreferrer"}},[e._v("动态的 "),r("code",[e._v("import()")]),r("OutboundLink")],1),e._v(" 在 CommonJS 和 ES 模块中都受支持。")]),e._v(" "),r("h3",{attrs:{id:"commonjs-命名空间"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#commonjs-命名空间"}},[e._v("#")]),e._v(" CommonJS 命名空间"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#commonjs-namespaces",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm/commonjs_namespaces.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("CommonJS 模块由可以是任何类型的 "),r("code",[e._v("module.exports")]),e._v(" 对象组成。")]),e._v(" "),r("p",[e._v("当导入 CommonJS 模块时，可以使用 ES 模块默认导入或其对应的语法糖可靠地导入：")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("import { default as cjs } from 'cjs';\n\n// 下面的导入语句是上面的导入语句中\n// `{ default as cjsSugar }` 的 \"语法糖\"（等价但更甜）：\nimport cjsSugar from 'cjs';\n\nconsole.log(cjs);\nconsole.log(cjs === cjsSugar);\n// 打印:\n//   <module.exports>\n//   true\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br"),r("span",{staticClass:"line-number"},[e._v("7")]),r("br"),r("span",{staticClass:"line-number"},[e._v("8")]),r("br"),r("span",{staticClass:"line-number"},[e._v("9")]),r("br"),r("span",{staticClass:"line-number"},[e._v("10")]),r("br"),r("span",{staticClass:"line-number"},[e._v("11")]),r("br")])]),r("p",[e._v("CommonJS 模块的 ECMAScript 模块命名空间表示始终是使用 "),r("code",[e._v("default")]),e._v(" 导出键指向 CommonJS "),r("code",[e._v("module.exports")]),e._v(" 值的命名空间。")]),e._v(" "),r("p",[e._v("当使用 "),r("code",[e._v("import * as m from 'cjs'")]),e._v(" 或动态导入时，可以直接观察到此模块命名空间外来对象：")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("import * as m from 'cjs';\nconsole.log(m);\nconsole.log(m === await import('cjs'));\n// 打印:\n//   [Module] { default: <module.exports> }\n//   true\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br")])]),r("p",[e._v("为了更好地兼容 JS 生态系统中的现有用法，Node.js 还尝试确定每个导入的 CommonJS 模块的 CommonJS 命名导出，以使用静态分析过程将它们作为单独的 ES 模块导出提供。")]),e._v(" "),r("p",[e._v("例如，考虑编写的 CommonJS 模块：")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// cjs.cjs\nexports.name = 'exported';\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br")])]),r("p",[e._v("前面的模块支持 ES 模块中的命名导入：")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("import { name } from './cjs.cjs';\nconsole.log(name);\n// 打印: 'exported'\n\nimport cjs from './cjs.cjs';\nconsole.log(cjs);\n// 打印: { name: 'exported' }\n\nimport * as m from './cjs.cjs';\nconsole.log(m);\n// 打印: [Module] { default: { name: 'exported' }, name: 'exported' }\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br"),r("span",{staticClass:"line-number"},[e._v("7")]),r("br"),r("span",{staticClass:"line-number"},[e._v("8")]),r("br"),r("span",{staticClass:"line-number"},[e._v("9")]),r("br"),r("span",{staticClass:"line-number"},[e._v("10")]),r("br"),r("span",{staticClass:"line-number"},[e._v("11")]),r("br")])]),r("p",[e._v("从上一个记录模块命名空间外来对象的示例中可以看出，"),r("code",[e._v("name")]),e._v(" 导出是从 "),r("code",[e._v("module.exports")]),e._v(" 对象复制出来的，并在导入模块时直接设置在 ES 模块命名空间上。")]),e._v(" "),r("p",[e._v("未检测到这些命名导出的实时绑定更新或添加到 "),r("code",[e._v("module.exports")]),e._v(" 的新导出。")]),e._v(" "),r("p",[e._v("命名导出的检测基于通用语法模式，但并不总是正确地检测命名导出。 在这些情况下，使用上述默认导入形式可能是更好的选择。")]),e._v(" "),r("p",[e._v("命名导出检测涵盖了许多常见的导出模式、再导出模式、以及构建工具和转译器输出。 参阅 "),r("a",{attrs:{href:"http://url.nodejs.cn/ecpd1v",target:"_blank",rel:"noopener noreferrer"}},[e._v("cjs-module-lexer"),r("OutboundLink")],1),e._v(" 以了解实现的确切语义。")]),e._v(" "),r("h3",{attrs:{id:"内置模块"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#内置模块"}},[e._v("#")]),e._v(" 内置模块"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#builtin-modules",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm/builtin_modules.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"http://nodejs.cn/api-v12/modules.html#modules_core_modules",target:"_blank",rel:"noopener noreferrer"}},[e._v("核心模块"),r("OutboundLink")],1),e._v("提供了其公共 API 的命名导出。 还提供了默认导出，其是 CommonJS 导出的值。 默认导出可用于修改命名导出等。 内置模块的命名导出仅通过调用 "),r("a",{attrs:{href:"http://nodejs.cn/api-v12/module.html#module_module_syncbuiltinesmexports",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("module.syncBuiltinESMExports()")]),r("OutboundLink")],1),e._v(" 进行更新。")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("import EventEmitter from 'events';\nconst e = new EventEmitter();\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br")])]),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("import { readFile } from 'fs';\nreadFile('./foo.txt', (err, source) => {\n  if (err) {\n    console.error(err);\n  } else {\n    console.log(source);\n  }\n});\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br"),r("span",{staticClass:"line-number"},[e._v("7")]),r("br"),r("span",{staticClass:"line-number"},[e._v("8")]),r("br")])]),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("import fs, { readFileSync } from 'fs';\nimport { syncBuiltinESMExports } from 'module';\n\nfs.readFileSync = () => Buffer.from('Hello, ESM');\nsyncBuiltinESMExports();\n\nfs.readFileSync === readFileSync;\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br"),r("span",{staticClass:"line-number"},[e._v("7")]),r("br")])]),r("h3",{attrs:{id:"commonjs-json-and-native-modules"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#commonjs-json-and-native-modules"}},[e._v("#")]),e._v(" CommonJS, JSON, and native modules"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#commonjs-json-and-native-modules",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("CommonJS, JSON, and native modules can be used with "),r("a",{attrs:{href:"http://nodejs.cn/api-v12/module.html#module_module_createrequire_filename",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("module.createRequire()")]),r("OutboundLink")],1),e._v(".")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// cjs.cjs\nmodule.exports = 'cjs';\n\n// esm.mjs\nimport { createRequire } from 'module';\n\nconst require = createRequire(import.meta.url);\n\nconst cjs = require('./cjs.cjs');\ncjs === 'cjs'; // true\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br"),r("span",{staticClass:"line-number"},[e._v("7")]),r("br"),r("span",{staticClass:"line-number"},[e._v("8")]),r("br"),r("span",{staticClass:"line-number"},[e._v("9")]),r("br"),r("span",{staticClass:"line-number"},[e._v("10")]),r("br")])]),r("h3",{attrs:{id:"experimental-json-modules"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#experimental-json-modules"}},[e._v("#")]),e._v(" Experimental JSON modules"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#experimental-json-modules",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm/experimental_json_modules.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("目前导入 JSON 模块仅支持 "),r("code",[e._v("commonjs")]),e._v(" 模式，并且使用 CJS 加载器加载。 "),r("a",{attrs:{href:"http://url.nodejs.cn/xZrkEh",target:"_blank",rel:"noopener noreferrer"}},[e._v("WHATWG JSON 模块规范"),r("OutboundLink")],1),e._v("仍在标准化中，并且通过在运行 Node.js 时包含额外的标志 "),r("code",[e._v("--experimental-json-modules")]),e._v(" 进行实验性地支持。")]),e._v(" "),r("p",[e._v("当包含 "),r("code",[e._v("--experimental-json-modules")]),e._v(" 标志时，"),r("code",[e._v("commonjs")]),e._v(" 和 "),r("code",[e._v("module")]),e._v(" 模式都使用新的实验性 JSON 加载器。 导入的 JSON 只暴露 "),r("code",[e._v("default")]),e._v("。 不支持命名导出。 在 CommonJS 缓存中创建缓存条目，以避免重复。 如果 JSON 模块已经从同一路径导入，则在 CommonJS 中返回相同的对象。")]),e._v(" "),r("p",[e._v("假设 "),r("code",[e._v("index.mjs")]),e._v(" 具有")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("import packageConfig from './package.json';\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br")])]),r("p",[e._v("模块需要 "),r("code",[e._v("--experimental-json-modules")]),e._v(" 标志才有效。")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("node index.mjs # 失败\nnode --experimental-json-modules index.mjs # 有效\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br")])]),r("h3",{attrs:{id:"experimental-wasm-modules"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#experimental-wasm-modules"}},[e._v("#")]),e._v(" Experimental Wasm modules"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#experimental-wasm-modules",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm/experimental_wasm_modules.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("在 "),r("code",[e._v("--experimental-wasm-modules")]),e._v(" 标志下支持导入 Web Assembly 模块，允许将任何 "),r("code",[e._v(".wasm")]),e._v(" 文件作为普通模块导入，同时还支持它们的模块导入。")]),e._v(" "),r("p",[e._v("此集成符合"),r("a",{attrs:{href:"http://url.nodejs.cn/3w7yUG",target:"_blank",rel:"noopener noreferrer"}},[e._v("用于 Web Assembly 的 ES 模块集成提案"),r("OutboundLink")],1),e._v("。")]),e._v(" "),r("p",[e._v("例如，"),r("code",[e._v("index.mjs")]),e._v(" 包含：")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("import * as M from './module.wasm';\nconsole.log(M);\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br")])]),r("p",[e._v("在以下条件下执行：")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("node --experimental-wasm-modules index.mjs\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br")])]),r("p",[e._v("将为 "),r("code",[e._v("module.wasm")]),e._v(" 的实例化提供导出接口。")]),e._v(" "),r("h3",{attrs:{id:"experimental-loaders"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#experimental-loaders"}},[e._v("#")]),e._v(" Experimental loaders"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#experimental-loaders",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm/experimental_loaders.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("strong",[e._v("注意：此 API 目前正在重新设计，并将继续更改。")])]),e._v(" "),r("p",[e._v("要自定义默认的模块解析，则可以选择通过 Node.js 的 "),r("code",[e._v("--experimental-loader ./loader-name.mjs")]),e._v(" 参数提供加载器钩子。")]),e._v(" "),r("p",[e._v("当使用钩子时，只适用于 ES 模块加载，而不适用于任何加载的 CommonJS 模块。")]),e._v(" "),r("h4",{attrs:{id:"钩子"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#钩子"}},[e._v("#")]),e._v(" 钩子"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#hooks",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("h5",{attrs:{id:"resolve-specifier-context-defaultresolve"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#resolve-specifier-context-defaultresolve"}},[e._v("#")]),e._v(" "),r("code",[e._v("resolve(specifier, context, defaultResolve)")]),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#resolvespecifier-context-defaultresolve",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm/resolve_specifier_context_defaultresolve.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),r("OutboundLink")],1)]),e._v(" "),r("blockquote",[r("p",[e._v("注意：加载器 API 正在重新设计。 这个钩子可能会消失，或者它的签名可能会改变。 不要依赖下面描述的 API。")])]),e._v(" "),r("ul",[r("li",[r("code",[e._v("specifier")]),e._v(" "),r("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[r("string",[r("OutboundLink")],1)],1)]),e._v(" "),r("li",[r("code",[e._v("context")]),e._v(" "),r("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[r("Object",[r("OutboundLink")],1)],1),e._v(" "),r("ul",[r("li",[r("code",[e._v("conditions")]),e._v(" "),r("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[e._v("<string[]>"),r("OutboundLink")],1)]),e._v(" "),r("li",[r("code",[e._v("parentURL")]),e._v(" "),r("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[r("string",[r("OutboundLink")],1)],1)])])]),e._v(" "),r("li",[r("code",[e._v("defaultResolve")]),e._v(" "),r("a",{attrs:{href:"http://url.nodejs.cn/ceTQa6",target:"_blank",rel:"noopener noreferrer"}},[r("Function",[r("OutboundLink")],1)],1)]),e._v(" "),r("li",[e._v("返回: "),r("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[r("Object",[r("OutboundLink")],1)],1),e._v(" "),r("ul",[r("li",[r("code",[e._v("url")]),e._v(" "),r("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[r("string",[r("OutboundLink")],1)],1)])])])]),e._v(" "),r("p",[r("code",[e._v("resolve")]),e._v(" 钩子返回给定模块说明符和父 URL 的解析文件 URL。 模块说明符是 "),r("code",[e._v("import")]),e._v(" 语句或 "),r("code",[e._v("import()")]),e._v(" 表达式中的字符串，父 URL 是导入此模块的 URL，如果这是应用程序的主要入口点，则为 "),r("code",[e._v("undefined")])]),e._v(" "),r("p",[r("code",[e._v("context")]),e._v(" 上的 "),r("code",[e._v("conditions")]),e._v(" 属性是适用于此解析请求的"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/packages.html#packages_conditional_exports",target:"_blank",rel:"noopener noreferrer"}},[e._v("条件导出"),r("OutboundLink")],1),e._v("的条件数组。 它们可用于在别处查找条件映射或在调用默认解析逻辑时修改列表。")]),e._v(" "),r("p",[e._v("当前的"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/packages.html#packages_conditional_exports",target:"_blank",rel:"noopener noreferrer"}},[e._v("包导出条件"),r("OutboundLink")],1),e._v("始终在传入钩子的 "),r("code",[e._v("context.conditions")]),e._v(" 数组中。 为了在调用 "),r("code",[e._v("defaultResolve")]),e._v(" 时保证默认的 Node.js 模块说明符解析行为，传给它的 "),r("code",[e._v("context.conditions")]),e._v(" 数组必须包含最初传到 "),r("code",[e._v("resolve")]),e._v(" 钩子的 "),r("code",[e._v("context.conditions")]),e._v(" 数组的所有元素。")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("/**\n * @param {string} specifier\n * @param {{\n *   conditions: !Array<string>,\n *   parentURL: !(string | undefined),\n * }} context\n * @param {Function} defaultResolve\n * @returns {Promise<{ url: string }>}\n */\nexport async function resolve(specifier, context, defaultResolve) {\n  const { parentURL = null } = context;\n  if (Math.random() > 0.5) { // 一些条件。\n    // 对于部分或全部说明符，做一些自定义逻辑来解决。\n    // 总是返回 {url: <string>} 形式的对象。\n    return {\n      url: parentURL ?\n        new URL(specifier, parentURL).href :\n        new URL(specifier).href,\n    };\n  }\n  if (Math.random() < 0.5) { // 另一个条件。\n    // 当调用 `defaultResolve` 时，可以修改参数。\n    // 在这种情况下，它为匹配条件导出添加了另一个值。\n    return defaultResolve(specifier, {\n      ...context,\n      conditions: [...context.conditions, 'another-condition'],\n    });\n  }\n  // 对于所有其他说明符，请遵循 Node.js。\n  return defaultResolve(specifier, context, defaultResolve);\n}\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br"),r("span",{staticClass:"line-number"},[e._v("7")]),r("br"),r("span",{staticClass:"line-number"},[e._v("8")]),r("br"),r("span",{staticClass:"line-number"},[e._v("9")]),r("br"),r("span",{staticClass:"line-number"},[e._v("10")]),r("br"),r("span",{staticClass:"line-number"},[e._v("11")]),r("br"),r("span",{staticClass:"line-number"},[e._v("12")]),r("br"),r("span",{staticClass:"line-number"},[e._v("13")]),r("br"),r("span",{staticClass:"line-number"},[e._v("14")]),r("br"),r("span",{staticClass:"line-number"},[e._v("15")]),r("br"),r("span",{staticClass:"line-number"},[e._v("16")]),r("br"),r("span",{staticClass:"line-number"},[e._v("17")]),r("br"),r("span",{staticClass:"line-number"},[e._v("18")]),r("br"),r("span",{staticClass:"line-number"},[e._v("19")]),r("br"),r("span",{staticClass:"line-number"},[e._v("20")]),r("br"),r("span",{staticClass:"line-number"},[e._v("21")]),r("br"),r("span",{staticClass:"line-number"},[e._v("22")]),r("br"),r("span",{staticClass:"line-number"},[e._v("23")]),r("br"),r("span",{staticClass:"line-number"},[e._v("24")]),r("br"),r("span",{staticClass:"line-number"},[e._v("25")]),r("br"),r("span",{staticClass:"line-number"},[e._v("26")]),r("br"),r("span",{staticClass:"line-number"},[e._v("27")]),r("br"),r("span",{staticClass:"line-number"},[e._v("28")]),r("br"),r("span",{staticClass:"line-number"},[e._v("29")]),r("br"),r("span",{staticClass:"line-number"},[e._v("30")]),r("br"),r("span",{staticClass:"line-number"},[e._v("31")]),r("br")])]),r("h5",{attrs:{id:"getformat-url-context-defaultgetformat"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#getformat-url-context-defaultgetformat"}},[e._v("#")]),e._v(" "),r("code",[e._v("getFormat(url, context, defaultGetFormat)")]),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#getformaturl-context-defaultgetformat",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm/getformat_url_context_defaultgetformat.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),r("OutboundLink")],1)]),e._v(" "),r("blockquote",[r("p",[e._v("注意：加载器 API 正在重新设计。 这个钩子可能会消失，或者它的签名可能会改变。 不要依赖下面描述的 API。")])]),e._v(" "),r("ul",[r("li",[r("code",[e._v("url")]),e._v(" "),r("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[r("string",[r("OutboundLink")],1)],1)]),e._v(" "),r("li",[r("code",[e._v("context")]),e._v(" "),r("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[r("Object",[r("OutboundLink")],1)],1)]),e._v(" "),r("li",[r("code",[e._v("defaultGetFormat")]),e._v(" "),r("a",{attrs:{href:"http://url.nodejs.cn/ceTQa6",target:"_blank",rel:"noopener noreferrer"}},[r("Function",[r("OutboundLink")],1)],1)]),e._v(" "),r("li",[e._v("返回: "),r("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[r("Object",[r("OutboundLink")],1)],1),e._v(" "),r("ul",[r("li",[r("code",[e._v("format")]),e._v(" "),r("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[r("string",[r("OutboundLink")],1)],1)])])])]),e._v(" "),r("p",[r("code",[e._v("getFormat")]),e._v(" 钩子提供了一种方式来定义确定网址应如何解释的自定义方法。 返回的 "),r("code",[e._v("format")]),e._v(" 也会影响解析时模块的可接受的源值形式。 这可以是以下之一：")]),e._v(" "),r("table",[r("thead",[r("tr",[r("th",[r("code",[e._v("format")])]),e._v(" "),r("th",[e._v("描述")]),e._v(" "),r("th",[r("code",[e._v("getSource")]),e._v(" 或 "),r("code",[e._v("transformSource")]),e._v(" 返回的 "),r("code",[e._v("source")]),e._v(" 的可接受类型")])])]),e._v(" "),r("tbody",[r("tr",[r("td",[r("code",[e._v("'builtin'")])]),e._v(" "),r("td",[e._v("加载 Node.js 内置模块")]),e._v(" "),r("td",[e._v("不适用")])]),e._v(" "),r("tr",[r("td",[r("code",[e._v("'dynamic'")])]),e._v(" "),r("td",[e._v("Use a "),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#esm_code_dynamicinstantiate_code_hook",target:"_blank",rel:"noopener noreferrer"}},[e._v("dynamic instantiate hook"),r("OutboundLink")],1)]),e._v(" "),r("td",[e._v("不适用")])]),e._v(" "),r("tr",[r("td",[r("code",[e._v("'commonjs'")])]),e._v(" "),r("td",[e._v("加载 Node.js CommonJS 模块")]),e._v(" "),r("td",[e._v("不适用")])]),e._v(" "),r("tr",[r("td",[r("code",[e._v("'json'")])]),e._v(" "),r("td",[e._v("加载 JSON 文件")]),e._v(" "),r("td",[e._v("{ "),r("a",{attrs:{href:"http://url.nodejs.cn/NmKbqJ",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("string")]),r("OutboundLink")],1),e._v(", "),r("a",{attrs:{href:"http://url.nodejs.cn/mUbfvF",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("ArrayBuffer")]),r("OutboundLink")],1),e._v(", "),r("a",{attrs:{href:"http://url.nodejs.cn/oh3CkV",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("TypedArray")]),r("OutboundLink")],1),e._v(" }")])]),e._v(" "),r("tr",[r("td",[r("code",[e._v("'module'")])]),e._v(" "),r("td",[e._v("加载 ES 模块")]),e._v(" "),r("td",[e._v("{ "),r("a",{attrs:{href:"http://url.nodejs.cn/NmKbqJ",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("string")]),r("OutboundLink")],1),e._v(", "),r("a",{attrs:{href:"http://url.nodejs.cn/mUbfvF",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("ArrayBuffer")]),r("OutboundLink")],1),e._v(", "),r("a",{attrs:{href:"http://url.nodejs.cn/oh3CkV",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("TypedArray")]),r("OutboundLink")],1),e._v(" }")])]),e._v(" "),r("tr",[r("td",[r("code",[e._v("'wasm'")])]),e._v(" "),r("td",[e._v("加载 WebAssembly 模块")]),e._v(" "),r("td",[e._v("{ "),r("a",{attrs:{href:"http://url.nodejs.cn/mUbfvF",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("ArrayBuffer")]),r("OutboundLink")],1),e._v(", "),r("a",{attrs:{href:"http://url.nodejs.cn/oh3CkV",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("TypedArray")]),r("OutboundLink")],1),e._v(" }")])])])]),e._v(" "),r("p",[e._v("注意：这些类型都对应于 ECMAScript 中定义的类。")]),e._v(" "),r("ul",[r("li",[e._v("特定的 "),r("a",{attrs:{href:"http://url.nodejs.cn/mUbfvF",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("ArrayBuffer")]),r("OutboundLink")],1),e._v(" 对象是 "),r("a",{attrs:{href:"http://url.nodejs.cn/6J6LBy",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("SharedArrayBuffer")]),r("OutboundLink")],1),e._v("。")]),e._v(" "),r("li",[e._v("特定的 "),r("a",{attrs:{href:"http://url.nodejs.cn/oh3CkV",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("TypedArray")]),r("OutboundLink")],1),e._v(" 对象是 "),r("a",{attrs:{href:"http://url.nodejs.cn/ZbDkpm",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("Uint8Array")]),r("OutboundLink")],1),e._v("。")])]),e._v(" "),r("p",[e._v("注意：如果基于文本的格式（即 "),r("code",[e._v("'json'")]),e._v("、"),r("code",[e._v("'module'")]),e._v("）的源值不是字符串，则使用 "),r("a",{attrs:{href:"http://url.nodejs.cn/GF1K8i",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("util.TextDecoder")]),r("OutboundLink")],1),e._v(" 将其转换为字符串。")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("/**\n * @param {string} url\n * @param {Object} context (currently empty)\n * @param {Function} defaultGetFormat\n * @returns {Promise<{ format: string }>}\n */\nexport async function getFormat(url, context, defaultGetFormat) {\n  if (Math.random() > 0.5) { // 一些条件。\n    // 对于部分或所有 URL，执行一些自定义逻辑来确定格式。\n    // 始终返回 {format: <string>} 形式的对象，\n    // 其中格式是上表中的字符串之一。\n    return {\n      format: 'module',\n    };\n  }\n  // 所有其他 URL 都遵循 Node.js。\n  return defaultGetFormat(url, context, defaultGetFormat);\n}\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br"),r("span",{staticClass:"line-number"},[e._v("7")]),r("br"),r("span",{staticClass:"line-number"},[e._v("8")]),r("br"),r("span",{staticClass:"line-number"},[e._v("9")]),r("br"),r("span",{staticClass:"line-number"},[e._v("10")]),r("br"),r("span",{staticClass:"line-number"},[e._v("11")]),r("br"),r("span",{staticClass:"line-number"},[e._v("12")]),r("br"),r("span",{staticClass:"line-number"},[e._v("13")]),r("br"),r("span",{staticClass:"line-number"},[e._v("14")]),r("br"),r("span",{staticClass:"line-number"},[e._v("15")]),r("br"),r("span",{staticClass:"line-number"},[e._v("16")]),r("br"),r("span",{staticClass:"line-number"},[e._v("17")]),r("br"),r("span",{staticClass:"line-number"},[e._v("18")]),r("br")])]),r("h5",{attrs:{id:"getsource-url-context-defaultgetsource"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#getsource-url-context-defaultgetsource"}},[e._v("#")]),e._v(" "),r("code",[e._v("getSource(url, context, defaultGetSource)")]),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#getsourceurl-context-defaultgetsource",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm/getsource_url_context_defaultgetsource.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),r("OutboundLink")],1)]),e._v(" "),r("blockquote",[r("p",[e._v("注意：加载器 API 正在重新设计。 这个钩子可能会消失，或者它的签名可能会改变。 不要依赖下面描述的 API。")])]),e._v(" "),r("ul",[r("li",[r("code",[e._v("url")]),e._v(" "),r("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[r("string",[r("OutboundLink")],1)],1)]),e._v(" "),r("li",[r("code",[e._v("context")]),e._v(" "),r("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[r("Object",[r("OutboundLink")],1)],1),e._v(" "),r("ul",[r("li",[r("code",[e._v("format")]),e._v(" "),r("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[r("string",[r("OutboundLink")],1)],1)])])]),e._v(" "),r("li",[r("code",[e._v("defaultGetSource")]),e._v(" "),r("a",{attrs:{href:"http://url.nodejs.cn/ceTQa6",target:"_blank",rel:"noopener noreferrer"}},[r("Function",[r("OutboundLink")],1)],1)]),e._v(" "),r("li",[e._v("返回: "),r("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[r("Object",[r("OutboundLink")],1)],1),e._v(" "),r("ul",[r("li",[r("code",[e._v("source")]),e._v(" "),r("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[r("string",[r("OutboundLink")],1)],1),e._v(" | "),r("a",{attrs:{href:"http://url.nodejs.cn/6J6LBy",target:"_blank",rel:"noopener noreferrer"}},[r("SharedArrayBuffer",[r("OutboundLink")],1)],1),e._v(" | "),r("a",{attrs:{href:"http://url.nodejs.cn/ZbDkpm",target:"_blank",rel:"noopener noreferrer"}},[r("Uint8Array",[r("OutboundLink")],1)],1)])])])]),e._v(" "),r("p",[r("code",[e._v("getSource")]),e._v(" 钩子提供了一种方法来定义用于检索 ES 模块说明符的源代码的自定义方法。 这将允许加载器潜在地避免从磁盘读取文件。")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("/**\n * @param {string} url\n * @param {{ format: string }} context\n * @param {Function} defaultGetSource\n * @returns {Promise<{ source: !(string | SharedArrayBuffer | Uint8Array) }>}\n */\nexport async function getSource(url, context, defaultGetSource) {\n  const { format } = context;\n  if (Math.random() > 0.5) { // 一些条件。\n    // 对于部分或所有 URL，执行一些自定义逻辑来检索源。\n    // 总是返回 {source: <string|buffer>} 形式的对象。\n    return {\n      source: '...',\n    };\n  }\n  // 所有其他 URL 都遵循 Node.js。\n  return defaultGetSource(url, context, defaultGetSource);\n}\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br"),r("span",{staticClass:"line-number"},[e._v("7")]),r("br"),r("span",{staticClass:"line-number"},[e._v("8")]),r("br"),r("span",{staticClass:"line-number"},[e._v("9")]),r("br"),r("span",{staticClass:"line-number"},[e._v("10")]),r("br"),r("span",{staticClass:"line-number"},[e._v("11")]),r("br"),r("span",{staticClass:"line-number"},[e._v("12")]),r("br"),r("span",{staticClass:"line-number"},[e._v("13")]),r("br"),r("span",{staticClass:"line-number"},[e._v("14")]),r("br"),r("span",{staticClass:"line-number"},[e._v("15")]),r("br"),r("span",{staticClass:"line-number"},[e._v("16")]),r("br"),r("span",{staticClass:"line-number"},[e._v("17")]),r("br"),r("span",{staticClass:"line-number"},[e._v("18")]),r("br")])]),r("h5",{attrs:{id:"transformsource-source-context-defaulttransformsource"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#transformsource-source-context-defaulttransformsource"}},[e._v("#")]),e._v(" "),r("code",[e._v("transformSource(source, context, defaultTransformSource)")]),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#transformsourcesource-context-defaulttransformsource",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm/transformsource_source_context_defaulttransformsource.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),r("OutboundLink")],1)]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("NODE_OPTIONS='--experimental-loader ./custom-loader.mjs' node x.js\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br")])]),r("blockquote",[r("p",[e._v("注意：加载器 API 正在重新设计。 这个钩子可能会消失，或者它的签名可能会改变。 不要依赖下面描述的 API。")])]),e._v(" "),r("ul",[r("li",[r("code",[e._v("source")]),e._v(" "),r("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[r("string",[r("OutboundLink")],1)],1),e._v(" | "),r("a",{attrs:{href:"http://url.nodejs.cn/6J6LBy",target:"_blank",rel:"noopener noreferrer"}},[r("SharedArrayBuffer",[r("OutboundLink")],1)],1),e._v(" | "),r("a",{attrs:{href:"http://url.nodejs.cn/ZbDkpm",target:"_blank",rel:"noopener noreferrer"}},[r("Uint8Array",[r("OutboundLink")],1)],1)]),e._v(" "),r("li",[r("code",[e._v("context")]),e._v(" "),r("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[r("Object",[r("OutboundLink")],1)],1),e._v(" "),r("ul",[r("li",[r("code",[e._v("format")]),e._v(" "),r("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[r("string",[r("OutboundLink")],1)],1)]),e._v(" "),r("li",[r("code",[e._v("url")]),e._v(" "),r("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[r("string",[r("OutboundLink")],1)],1)])])]),e._v(" "),r("li",[e._v("返回: "),r("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[r("Object",[r("OutboundLink")],1)],1),e._v(" "),r("ul",[r("li",[r("code",[e._v("source")]),e._v(" "),r("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[r("string",[r("OutboundLink")],1)],1),e._v(" | "),r("a",{attrs:{href:"http://url.nodejs.cn/6J6LBy",target:"_blank",rel:"noopener noreferrer"}},[r("SharedArrayBuffer",[r("OutboundLink")],1)],1),e._v(" | "),r("a",{attrs:{href:"http://url.nodejs.cn/ZbDkpm",target:"_blank",rel:"noopener noreferrer"}},[r("Uint8Array",[r("OutboundLink")],1)],1)])])])]),e._v(" "),r("p",[r("code",[e._v("transformSource")]),e._v(" 钩子提供了一种在加载源字符串之后但在 Node.js 对其进行任何操作之前修改加载的 ES 模块文件的源代码的方法。")]),e._v(" "),r("p",[e._v("如果此钩子用于将未知的 Node.js 文件类型转换为可执行的 JavaScript，则还需要解析钩子来注册任何未知的 Node.js 文件扩展名。 请参阅下面的"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#esm_transpiler_loader",target:"_blank",rel:"noopener noreferrer"}},[e._v("转译加载器示例"),r("OutboundLink")],1),e._v("。")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("/**\n * @param {!(string | SharedArrayBuffer | Uint8Array)} source\n * @param {{\n *   format: string,\n *   url: string,\n * }} context\n * @param {Function} defaultTransformSource\n * @returns {Promise<{ source: !(string | SharedArrayBuffer | Uint8Array) }>}\n */\nexport async function transformSource(source, context, defaultTransformSource) {\n  const { url, format } = context;\n  if (Math.random() > 0.5) { // 一些条件。\n    // 对于部分或全部 URL，做一些修改源的自定义逻辑。\n    // 总是返回 {source: <string|buffer>} 形式的对象。\n    return {\n      source: '...',\n    };\n  }\n  // 对于所有其他来源，请遵循 Node.js。\n  return defaultTransformSource(source, context, defaultTransformSource);\n}\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br"),r("span",{staticClass:"line-number"},[e._v("7")]),r("br"),r("span",{staticClass:"line-number"},[e._v("8")]),r("br"),r("span",{staticClass:"line-number"},[e._v("9")]),r("br"),r("span",{staticClass:"line-number"},[e._v("10")]),r("br"),r("span",{staticClass:"line-number"},[e._v("11")]),r("br"),r("span",{staticClass:"line-number"},[e._v("12")]),r("br"),r("span",{staticClass:"line-number"},[e._v("13")]),r("br"),r("span",{staticClass:"line-number"},[e._v("14")]),r("br"),r("span",{staticClass:"line-number"},[e._v("15")]),r("br"),r("span",{staticClass:"line-number"},[e._v("16")]),r("br"),r("span",{staticClass:"line-number"},[e._v("17")]),r("br"),r("span",{staticClass:"line-number"},[e._v("18")]),r("br"),r("span",{staticClass:"line-number"},[e._v("19")]),r("br"),r("span",{staticClass:"line-number"},[e._v("20")]),r("br"),r("span",{staticClass:"line-number"},[e._v("21")]),r("br")])]),r("h5",{attrs:{id:"getglobalpreloadcode"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#getglobalpreloadcode"}},[e._v("#")]),e._v(" "),r("code",[e._v("getGlobalPreloadCode()")]),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#getglobalpreloadcode",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm/getglobalpreloadcode.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),r("OutboundLink")],1)]),e._v(" "),r("blockquote",[r("p",[e._v("注意：加载器 API 正在重新设计。 这个钩子可能会消失，或者它的签名可能会改变。 不要依赖下面描述的 API。")])]),e._v(" "),r("ul",[r("li",[e._v("返回: "),r("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[r("string",[r("OutboundLink")],1)],1)])]),e._v(" "),r("p",[e._v("有时可能需要在应用程序运行所在的同一全局范围内运行一些代码。 此钩子允许返回在启动时作为宽松模式脚本运行的字符串。")]),e._v(" "),r("p",[e._v("类似于 CommonJS 封装器的工作方式，代码在隐式函数范围内运行。 唯一的参数是类似 "),r("code",[e._v("require")]),e._v(' 的函数，可用于加载内置函数，如 "fs"：'),r("code",[e._v("getBuiltin(request: string)")]),e._v("。")]),e._v(" "),r("p",[e._v("如果代码需要更高级的 "),r("code",[e._v("require")]),e._v(" 特性，则必须使用 "),r("code",[e._v("module.createRequire()")]),e._v(" 构建自己的 "),r("code",[e._v("require")]),e._v("。")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("/**\n * @returns {string} 在应用程序启动之前运行的代码\n */\nexport function getGlobalPreloadCode() {\n  return `\\\nglobalThis.someInjectedProperty = 42;\nconsole.log('I just set some globals!');\n\nconst { createRequire } = getBuiltin('module');\n\nconst require = createRequire(process.cwd() + '/<preload>');\n// [...]\n`;\n}\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br"),r("span",{staticClass:"line-number"},[e._v("7")]),r("br"),r("span",{staticClass:"line-number"},[e._v("8")]),r("br"),r("span",{staticClass:"line-number"},[e._v("9")]),r("br"),r("span",{staticClass:"line-number"},[e._v("10")]),r("br"),r("span",{staticClass:"line-number"},[e._v("11")]),r("br"),r("span",{staticClass:"line-number"},[e._v("12")]),r("br"),r("span",{staticClass:"line-number"},[e._v("13")]),r("br"),r("span",{staticClass:"line-number"},[e._v("14")]),r("br")])]),r("h5",{attrs:{id:"dynamicinstantiate-hook"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#dynamicinstantiate-hook"}},[e._v("#")]),e._v(" "),r("code",[e._v("dynamicInstantiate")]),e._v(" hook"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#codedynamicinstantiatecode-hook",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm/code_dynamicinstantiate_code_hook.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),r("OutboundLink")],1)]),e._v(" "),r("blockquote",[r("p",[e._v("注意：加载器 API 正在重新设计。 这个钩子可能会消失，或者它的签名可能会改变。 不要依赖下面描述的 API。")])]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("/**\n * @param {string} url\n * @returns {object} response\n * @returns {array} response.exports\n * @returns {function} response.execute\n */\nexport async function dynamicInstantiate(url) {\n  return {\n    exports: ['customExportName'],\n    execute: (exports) => {\n      // \n      exports.customExportName.set('value');\n    }\n  };\n}\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br"),r("span",{staticClass:"line-number"},[e._v("7")]),r("br"),r("span",{staticClass:"line-number"},[e._v("8")]),r("br"),r("span",{staticClass:"line-number"},[e._v("9")]),r("br"),r("span",{staticClass:"line-number"},[e._v("10")]),r("br"),r("span",{staticClass:"line-number"},[e._v("11")]),r("br"),r("span",{staticClass:"line-number"},[e._v("12")]),r("br"),r("span",{staticClass:"line-number"},[e._v("13")]),r("br"),r("span",{staticClass:"line-number"},[e._v("14")]),r("br"),r("span",{staticClass:"line-number"},[e._v("15")]),r("br")])]),r("h4",{attrs:{id:"示例"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#示例"}},[e._v("#")]),e._v(" 示例"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#examples",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm/examples.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("各种加载器钩子可以一起使用来完成对 Node.js 代码加载和评估行为的广泛定制。")]),e._v(" "),r("h5",{attrs:{id:"https-加载器"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#https-加载器"}},[e._v("#")]),e._v(" HTTPS 加载器"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#https-loader",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm/https_loader.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("在当前的 Node.js 中，不支持以 "),r("code",[e._v("https://")]),e._v(" 开头的说明符。 下面的加载器注册钩子以启用对此类说明符的基本支持。 虽然这似乎是对 Node.js 核心功能的重大改进，但实际使用这个加载器有很大的缺点：性能比从磁盘加载文件慢得多，没有缓存，也没有安全性。")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// https-loader.mjs\nimport { get } from 'https';\n\nexport function resolve(specifier, context, defaultResolve) {\n  const { parentURL = null } = context;\n\n  // 通常，Node.js 会在以 'https://' 开头的说明符上出错，\n  // 因此此钩子会拦截它们并将它们转换为绝对 URL，\n  // 以便传给下面的后面的钩子。\n  if (specifier.startsWith('https://')) {\n    return {\n      url: specifier\n    };\n  } else if (parentURL && parentURL.startsWith('https://')) {\n    return {\n      url: new URL(specifier, parentURL).href\n    };\n  }\n\n  // 让 Node.js 处理所有其他说明符。\n  return defaultResolve(specifier, context, defaultResolve);\n}\n\nexport function getFormat(url, context, defaultGetFormat) {\n  // 此加载器假定所有网络提供的 JavaScript 都是 ES 模块代码。\n  if (url.startsWith('https://')) {\n    return {\n      format: 'module'\n    };\n  }\n\n  // 让 Node.js 处理所有其他 URL。\n  return defaultGetFormat(url, context, defaultGetFormat);\n}\n\nexport function getSource(url, context, defaultGetSource) {\n  // 要通过网络加载 JavaScript，\n  // 则需要获取并返回它。\n  if (url.startsWith('https://')) {\n    return new Promise((resolve, reject) => {\n      get(url, (res) => {\n        let data = '';\n        res.on('data', (chunk) => data += chunk);\n        res.on('end', () => resolve({ source: data }));\n      }).on('error', (err) => reject(err));\n    });\n  }\n\n  // 让 Node.js 处理所有其他 URL。\n  return defaultGetSource(url, context, defaultGetSource);\n}\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br"),r("span",{staticClass:"line-number"},[e._v("7")]),r("br"),r("span",{staticClass:"line-number"},[e._v("8")]),r("br"),r("span",{staticClass:"line-number"},[e._v("9")]),r("br"),r("span",{staticClass:"line-number"},[e._v("10")]),r("br"),r("span",{staticClass:"line-number"},[e._v("11")]),r("br"),r("span",{staticClass:"line-number"},[e._v("12")]),r("br"),r("span",{staticClass:"line-number"},[e._v("13")]),r("br"),r("span",{staticClass:"line-number"},[e._v("14")]),r("br"),r("span",{staticClass:"line-number"},[e._v("15")]),r("br"),r("span",{staticClass:"line-number"},[e._v("16")]),r("br"),r("span",{staticClass:"line-number"},[e._v("17")]),r("br"),r("span",{staticClass:"line-number"},[e._v("18")]),r("br"),r("span",{staticClass:"line-number"},[e._v("19")]),r("br"),r("span",{staticClass:"line-number"},[e._v("20")]),r("br"),r("span",{staticClass:"line-number"},[e._v("21")]),r("br"),r("span",{staticClass:"line-number"},[e._v("22")]),r("br"),r("span",{staticClass:"line-number"},[e._v("23")]),r("br"),r("span",{staticClass:"line-number"},[e._v("24")]),r("br"),r("span",{staticClass:"line-number"},[e._v("25")]),r("br"),r("span",{staticClass:"line-number"},[e._v("26")]),r("br"),r("span",{staticClass:"line-number"},[e._v("27")]),r("br"),r("span",{staticClass:"line-number"},[e._v("28")]),r("br"),r("span",{staticClass:"line-number"},[e._v("29")]),r("br"),r("span",{staticClass:"line-number"},[e._v("30")]),r("br"),r("span",{staticClass:"line-number"},[e._v("31")]),r("br"),r("span",{staticClass:"line-number"},[e._v("32")]),r("br"),r("span",{staticClass:"line-number"},[e._v("33")]),r("br"),r("span",{staticClass:"line-number"},[e._v("34")]),r("br"),r("span",{staticClass:"line-number"},[e._v("35")]),r("br"),r("span",{staticClass:"line-number"},[e._v("36")]),r("br"),r("span",{staticClass:"line-number"},[e._v("37")]),r("br"),r("span",{staticClass:"line-number"},[e._v("38")]),r("br"),r("span",{staticClass:"line-number"},[e._v("39")]),r("br"),r("span",{staticClass:"line-number"},[e._v("40")]),r("br"),r("span",{staticClass:"line-number"},[e._v("41")]),r("br"),r("span",{staticClass:"line-number"},[e._v("42")]),r("br"),r("span",{staticClass:"line-number"},[e._v("43")]),r("br"),r("span",{staticClass:"line-number"},[e._v("44")]),r("br"),r("span",{staticClass:"line-number"},[e._v("45")]),r("br"),r("span",{staticClass:"line-number"},[e._v("46")]),r("br"),r("span",{staticClass:"line-number"},[e._v("47")]),r("br"),r("span",{staticClass:"line-number"},[e._v("48")]),r("br"),r("span",{staticClass:"line-number"},[e._v("49")]),r("br"),r("span",{staticClass:"line-number"},[e._v("50")]),r("br"),r("span",{staticClass:"line-number"},[e._v("51")]),r("br")])]),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// main.mjs\nimport { VERSION } from 'https://coffeescript.org/browser-compiler-modern/coffeescript.js';\n\nconsole.log(VERSION);\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br")])]),r("p",[e._v("使用前面的加载器，运行 "),r("code",[e._v("node --experimental-loader ./https-loader.mjs ./main.mjs")]),e._v(" 会在 "),r("code",[e._v("main.mjs")]),e._v(" 中的 URL 处按照模块打印当前版本的 CoffeeScript。")]),e._v(" "),r("h5",{attrs:{id:"转译器加载器"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#转译器加载器"}},[e._v("#")]),e._v(" 转译器加载器"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#transpiler-loader",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm/transpiler_loader.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("可以使用 "),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#esm_transformsource_source_context_defaulttransformsource",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("transformSource")]),e._v(" 钩子"),r("OutboundLink")],1),e._v("将 Node.js 无法理解的格式的源转换为 JavaScript。 但是，在调用该钩子之前，其他钩子需要告诉 Node.js 不要在未知文件类型上抛出错误；并告诉 Node.js 如何加载这种新文件类型。")]),e._v(" "),r("p",[e._v("这比在运行 Node.js 之前转译源文件的性能要低；转译加载器应该只用于开发和测试目的。")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("// coffeescript-loader.mjs\nimport { URL, pathToFileURL } from 'url';\nimport CoffeeScript from 'coffeescript';\n\nconst baseURL = pathToFileURL(`${process.cwd()}/`).href;\n\n// CoffeeScript 文件以 .coffee、.litcoffee 或 .coffee.md 结尾。\nconst extensionsRegex = /\\.coffee$|\\.litcoffee$|\\.coffee\\.md$/;\n\nexport function resolve(specifier, context, defaultResolve) {\n  const { parentURL = baseURL } = context;\n\n  // Node.js 通常在未知文件扩展名上出错，\n  // 因此返回以 CoffeeScript 文件扩展名结尾的说明符的 URL。\n  if (extensionsRegex.test(specifier)) {\n    return {\n      url: new URL(specifier, parentURL).href\n    };\n  }\n\n  // 让 Node.js 处理所有其他说明符。\n  return defaultResolve(specifier, context, defaultResolve);\n}\n\nexport function getFormat(url, context, defaultGetFormat) {\n  // 现在修补了解决以让 CoffeeScript URL 通过，\n  // 需要告诉 Node.js 这样的 URL 应该被解释为什么格式。\n  // 为了这个加载器的目的，所有 CoffeeScript URL 都是 ES 模块。\n  if (extensionsRegex.test(url)) {\n    return {\n      format: 'module'\n    };\n  }\n\n  // 让 Node.js 处理所有其他 URL。\n  return defaultGetFormat(url, context, defaultGetFormat);\n}\n\nexport function transformSource(source, context, defaultTransformSource) {\n  const { url, format } = context;\n\n  if (extensionsRegex.test(url)) {\n    return {\n      source: CoffeeScript.compile(source, { bare: true })\n    };\n  }\n\n  // 让 Node.js 处理所有其他来源。\n  return defaultTransformSource(source, context, defaultTransformSource);\n}\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br"),r("span",{staticClass:"line-number"},[e._v("7")]),r("br"),r("span",{staticClass:"line-number"},[e._v("8")]),r("br"),r("span",{staticClass:"line-number"},[e._v("9")]),r("br"),r("span",{staticClass:"line-number"},[e._v("10")]),r("br"),r("span",{staticClass:"line-number"},[e._v("11")]),r("br"),r("span",{staticClass:"line-number"},[e._v("12")]),r("br"),r("span",{staticClass:"line-number"},[e._v("13")]),r("br"),r("span",{staticClass:"line-number"},[e._v("14")]),r("br"),r("span",{staticClass:"line-number"},[e._v("15")]),r("br"),r("span",{staticClass:"line-number"},[e._v("16")]),r("br"),r("span",{staticClass:"line-number"},[e._v("17")]),r("br"),r("span",{staticClass:"line-number"},[e._v("18")]),r("br"),r("span",{staticClass:"line-number"},[e._v("19")]),r("br"),r("span",{staticClass:"line-number"},[e._v("20")]),r("br"),r("span",{staticClass:"line-number"},[e._v("21")]),r("br"),r("span",{staticClass:"line-number"},[e._v("22")]),r("br"),r("span",{staticClass:"line-number"},[e._v("23")]),r("br"),r("span",{staticClass:"line-number"},[e._v("24")]),r("br"),r("span",{staticClass:"line-number"},[e._v("25")]),r("br"),r("span",{staticClass:"line-number"},[e._v("26")]),r("br"),r("span",{staticClass:"line-number"},[e._v("27")]),r("br"),r("span",{staticClass:"line-number"},[e._v("28")]),r("br"),r("span",{staticClass:"line-number"},[e._v("29")]),r("br"),r("span",{staticClass:"line-number"},[e._v("30")]),r("br"),r("span",{staticClass:"line-number"},[e._v("31")]),r("br"),r("span",{staticClass:"line-number"},[e._v("32")]),r("br"),r("span",{staticClass:"line-number"},[e._v("33")]),r("br"),r("span",{staticClass:"line-number"},[e._v("34")]),r("br"),r("span",{staticClass:"line-number"},[e._v("35")]),r("br"),r("span",{staticClass:"line-number"},[e._v("36")]),r("br"),r("span",{staticClass:"line-number"},[e._v("37")]),r("br"),r("span",{staticClass:"line-number"},[e._v("38")]),r("br"),r("span",{staticClass:"line-number"},[e._v("39")]),r("br"),r("span",{staticClass:"line-number"},[e._v("40")]),r("br"),r("span",{staticClass:"line-number"},[e._v("41")]),r("br"),r("span",{staticClass:"line-number"},[e._v("42")]),r("br"),r("span",{staticClass:"line-number"},[e._v("43")]),r("br"),r("span",{staticClass:"line-number"},[e._v("44")]),r("br"),r("span",{staticClass:"line-number"},[e._v("45")]),r("br"),r("span",{staticClass:"line-number"},[e._v("46")]),r("br"),r("span",{staticClass:"line-number"},[e._v("47")]),r("br"),r("span",{staticClass:"line-number"},[e._v("48")]),r("br"),r("span",{staticClass:"line-number"},[e._v("49")]),r("br"),r("span",{staticClass:"line-number"},[e._v("50")]),r("br")])]),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("# main.coffee\nimport { scream } from './scream.coffee'\nconsole.log scream 'hello, world'\n\nimport { version } from 'process'\nconsole.log \"Brought to you by Node.js version #{version}\"\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br")])]),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("# scream.coffee\nexport scream = (str) -> str.toUpperCase()\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br")])]),r("p",[e._v("使用前面的加载器，运行 "),r("code",[e._v("node --experimental-loader ./coffeescript-loader.mjs main.coffee")]),e._v(" 会导致 "),r("code",[e._v("main.coffee")]),e._v(" 在其源代码从磁盘加载之后但在 Node.js 执行之前转换为 JavaScript；对于通过任何加载文件的 "),r("code",[e._v("import")]),e._v(" 语句引用的任何 "),r("code",[e._v(".coffee")]),e._v("、"),r("code",[e._v(".litcoffee")]),e._v(" 或 "),r("code",[e._v(".coffee.md")]),e._v(" 文件，依此类推。")]),e._v(" "),r("h3",{attrs:{id:"解析算法"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#解析算法"}},[e._v("#")]),e._v(" 解析算法"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#resolution-algorithm",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("h4",{attrs:{id:"特性"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#特性"}},[e._v("#")]),e._v(" 特性"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#features",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm/features.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("解析器具有以下属性：")]),e._v(" "),r("ul",[r("li",[e._v("ES 模块使用的基于 FileURL 的解析")]),e._v(" "),r("li",[e._v("支持内置模块加载")]),e._v(" "),r("li",[e._v("相对和绝对的网址解析")]),e._v(" "),r("li",[e._v("没有默认的扩展名")]),e._v(" "),r("li",[e._v("没有主文件夹")]),e._v(" "),r("li",[e._v("通过 node_modules 进行裸说明符包解析查找")])]),e._v(" "),r("h4",{attrs:{id:"解析器算法"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#解析器算法"}},[e._v("#")]),e._v(" 解析器算法"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#resolver-algorithm",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm/resolver_algorithm.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("加载 ES 模块说明符的算法通过下面的 "),r("strong",[e._v("ESM_RESOLVE")]),e._v(" 方法给出。 它返回相对于 parentURL 的模块说明符的解析 URL。")]),e._v(" "),r("p",[e._v("确定解析 URL 的模块格式的算法由 "),r("strong",[e._v("ESM_FORMAT")]),e._v(' 提供，它返回任何文件的唯一模块格式。 "module" 格式为 ECMAScript 模块返回，而 "commonjs" 格式用于指示通过旧版 CommonJS 加载器加载。 其他格式，如 "addon" 可以在未来的更新中扩展。')]),e._v(" "),r("p",[e._v("在以下算法中，除非另有说明，否则所有子程序错误都将作为这些顶层程序的错误传播。")]),e._v(" "),r("p",[e._v("defaultConditions 是条件环境名称数组，"),r("code",[e._v('["node", "import"]')]),e._v("。")]),e._v(" "),r("p",[e._v("解析器可能会抛出以下错误：")]),e._v(" "),r("ul",[r("li",[e._v("无效的模块说明符：模块说明符是无效的 URL、包名称、或包子路径说明符。")]),e._v(" "),r("li",[e._v("无效的包配置：package.json 配置无效或包含无效配置。")]),e._v(" "),r("li",[e._v("无效的包目标：包导出或导入为无效类型或字符串目标的包定义了目标模块。")]),e._v(" "),r("li",[e._v("未导出包路径：包导出未定义或允许给定模块的包中的目标子路径。")]),e._v(" "),r("li",[e._v("未定义包导入：包导入未定义说明符。")]),e._v(" "),r("li",[e._v("未找到模块：请求的包或模块不存在。")])]),e._v(" "),r("h4",{attrs:{id:"解析器算法规范"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#解析器算法规范"}},[e._v("#")]),e._v(" 解析器算法规范"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#resolver-algorithm-specification",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("strong",[e._v("ESM_RESOLVE")]),e._v("("),r("em",[e._v("specifier")]),e._v(", "),r("em",[e._v("parentURL")]),e._v(")")]),e._v(" "),r("blockquote",[r("ol",[r("li",[e._v("Let "),r("em",[e._v("resolved")]),e._v(" be "),r("strong",[e._v("undefined")]),e._v(".")]),e._v(" "),r("li",[e._v("If "),r("em",[e._v("specifier")]),e._v(" is a valid URL, then\n"),r("ol",[r("li",[e._v("Set "),r("em",[e._v("resolved")]),e._v(" to the result of parsing and reserializing "),r("em",[e._v("specifier")]),e._v(" as a URL.")])])]),e._v(" "),r("li",[e._v("Otherwise, if "),r("em",[e._v("specifier")]),e._v(" starts with "),r("em",[e._v('"/"')]),e._v(", "),r("em",[e._v('"./"')]),e._v(" or "),r("em",[e._v('"../"')]),e._v(", then\n"),r("ol",[r("li",[e._v("Set "),r("em",[e._v("resolved")]),e._v(" to the URL resolution of "),r("em",[e._v("specifier")]),e._v(" relative to "),r("em",[e._v("parentURL")]),e._v(".")])])]),e._v(" "),r("li",[e._v("Otherwise, if "),r("em",[e._v("specifier")]),e._v(" starts with "),r("em",[e._v('"#"')]),e._v(", then\n"),r("ol",[r("li",[e._v("Set "),r("em",[e._v("resolved")]),e._v(" to the destructured value of the result of "),r("strong",[e._v("PACKAGE_IMPORTS_RESOLVE")]),e._v("("),r("em",[e._v("specifier")]),e._v(", "),r("em",[e._v("parentURL")]),e._v(", "),r("em",[e._v("defaultConditions")]),e._v(").")])])]),e._v(" "),r("li",[e._v("Otherwise,\n"),r("ol",[r("li",[e._v("Note: "),r("em",[e._v("specifier")]),e._v(" is now a bare specifier.")]),e._v(" "),r("li",[e._v("Set "),r("em",[e._v("resolved")]),e._v(" the result of "),r("strong",[e._v("PACKAGE_RESOLVE")]),e._v("("),r("em",[e._v("specifier")]),e._v(", "),r("em",[e._v("parentURL")]),e._v(").")])])]),e._v(" "),r("li",[e._v("If "),r("em",[e._v("resolved")]),e._v(" contains any percent encodings of "),r("em",[e._v('"/"')]),e._v(" or "),r("em",[e._v('"\\"')]),e._v(" ("),r("em",[e._v('"%2f"')]),e._v(" and "),r("em",[e._v('"%5C"')]),e._v(" respectively), then\n"),r("ol",[r("li",[e._v("Throw an "),r("em",[e._v("Invalid Module Specifier")]),e._v(" error.")])])]),e._v(" "),r("li",[e._v("If the file at "),r("em",[e._v("resolved")]),e._v(" is a directory, then\n"),r("ol",[r("li",[e._v("Throw an "),r("em",[e._v("Unsupported Directory Import")]),e._v(" error.")])])]),e._v(" "),r("li",[e._v("If the file at "),r("em",[e._v("resolved")]),e._v(" does not exist, then\n"),r("ol",[r("li",[e._v("Throw a "),r("em",[e._v("Module Not Found")]),e._v(" error.")])])]),e._v(" "),r("li",[e._v("Set "),r("em",[e._v("resolved")]),e._v(" to the real path of "),r("em",[e._v("resolved")]),e._v(".")]),e._v(" "),r("li",[e._v("Let "),r("em",[e._v("format")]),e._v(" be the result of "),r("strong",[e._v("ESM_FORMAT")]),e._v("("),r("em",[e._v("resolved")]),e._v(").")]),e._v(" "),r("li",[e._v("Load "),r("em",[e._v("resolved")]),e._v(" as module format, "),r("em",[e._v("format")]),e._v(".")]),e._v(" "),r("li",[e._v("Return "),r("em",[e._v("resolved")]),e._v(".")])])]),e._v(" "),r("p",[r("strong",[e._v("PACKAGE_RESOLVE")]),e._v("("),r("em",[e._v("packageSpecifier")]),e._v(", "),r("em",[e._v("parentURL")]),e._v(")")]),e._v(" "),r("blockquote",[r("ol",[r("li",[e._v("Let "),r("em",[e._v("packageName")]),e._v(" be "),r("strong",[e._v("undefined")]),e._v(".")]),e._v(" "),r("li",[e._v("If "),r("em",[e._v("packageSpecifier")]),e._v(" is an empty string, then\n"),r("ol",[r("li",[e._v("Throw an "),r("em",[e._v("Invalid Module Specifier")]),e._v(" error.")])])]),e._v(" "),r("li",[e._v("If "),r("em",[e._v("packageSpecifier")]),e._v(" does not start with "),r("em",[e._v('"@"')]),e._v(", then\n"),r("ol",[r("li",[e._v("Set "),r("em",[e._v("packageName")]),e._v(" to the substring of "),r("em",[e._v("packageSpecifier")]),e._v(" until the first "),r("em",[e._v('"/"')]),e._v(" separator or the end of the string.")])])]),e._v(" "),r("li",[e._v("Otherwise,\n"),r("ol",[r("li",[e._v("If "),r("em",[e._v("packageSpecifier")]),e._v(" does not contain a "),r("em",[e._v('"/"')]),e._v(" separator, then\n"),r("ol",[r("li",[e._v("Throw an "),r("em",[e._v("Invalid Module Specifier")]),e._v(" error.")])])]),e._v(" "),r("li",[e._v("Set "),r("em",[e._v("packageName")]),e._v(" to the substring of "),r("em",[e._v("packageSpecifier")]),e._v(" until the second "),r("em",[e._v('"/"')]),e._v(" separator or the end of the string.")])])]),e._v(" "),r("li",[e._v("If "),r("em",[e._v("packageName")]),e._v(" starts with "),r("em",[e._v('"."')]),e._v(" or contains "),r("em",[e._v('"\\"')]),e._v(" or "),r("em",[e._v('"%"')]),e._v(", then\n"),r("ol",[r("li",[e._v("Throw an "),r("em",[e._v("Invalid Module Specifier")]),e._v(" error.")])])]),e._v(" "),r("li",[e._v("Let "),r("em",[e._v("packageSubpath")]),e._v(" be "),r("em",[e._v('"."')]),e._v(" concatenated with the substring of "),r("em",[e._v("packageSpecifier")]),e._v(" from the position at the length of "),r("em",[e._v("packageName")]),e._v(".")]),e._v(" "),r("li",[e._v("Let "),r("em",[e._v("selfUrl")]),e._v(" be the result of "),r("strong",[e._v("PACKAGE_SELF_RESOLVE")]),e._v("("),r("em",[e._v("packageName")]),e._v(", "),r("em",[e._v("packageSubpath")]),e._v(", "),r("em",[e._v("parentURL")]),e._v(").")]),e._v(" "),r("li",[e._v("If "),r("em",[e._v("selfUrl")]),e._v(" is not "),r("strong",[e._v("undefined")]),e._v(", return "),r("em",[e._v("selfUrl")]),e._v(".")]),e._v(" "),r("li",[e._v("If "),r("em",[e._v("packageSubpath")]),e._v(" is "),r("em",[e._v('"."')]),e._v(" and "),r("em",[e._v("packageName")]),e._v(" is a Node.js builtin module, then\n"),r("ol",[r("li",[e._v("Return the string "),r("em",[e._v('"node:"')]),e._v(" concatenated with "),r("em",[e._v("packageSpecifier")]),e._v(".")])])]),e._v(" "),r("li",[e._v("While "),r("em",[e._v("parentURL")]),e._v(" is not the file system root,")]),e._v(" "),r("li",[e._v("Let "),r("em",[e._v("packageURL")]),e._v(" be the URL resolution of "),r("em",[e._v('"node_modules/"')]),e._v(" concatenated with "),r("em",[e._v("packageSpecifier")]),e._v(", relative to "),r("em",[e._v("parentURL")]),e._v(".")]),e._v(" "),r("li",[e._v("Set "),r("em",[e._v("parentURL")]),e._v(" to the parent folder URL of "),r("em",[e._v("parentURL")]),e._v(".")]),e._v(" "),r("li",[e._v("If the folder at "),r("em",[e._v("packageURL")]),e._v(" does not exist, then\n"),r("ol",[r("li",[e._v("Set "),r("em",[e._v("parentURL")]),e._v(" to the parent URL path of "),r("em",[e._v("parentURL")]),e._v(".")]),e._v(" "),r("li",[e._v("Continue the next loop iteration.")])])]),e._v(" "),r("li",[e._v("Let "),r("em",[e._v("pjson")]),e._v(" be the result of "),r("strong",[e._v("READ_PACKAGE_JSON")]),e._v("("),r("em",[e._v("packageURL")]),e._v(").")]),e._v(" "),r("li",[e._v("If "),r("em",[e._v("pjson")]),e._v(" is not "),r("strong",[e._v("null")]),e._v(" and "),r("em",[e._v("pjson")]),e._v("."),r("em",[e._v("exports")]),e._v(" is not "),r("strong",[e._v("null")]),e._v(" or "),r("strong",[e._v("undefined")]),e._v(", then\n"),r("ol",[r("li",[e._v("Let "),r("em",[e._v("exports")]),e._v(" be "),r("em",[e._v("pjson.exports")]),e._v(".")]),e._v(" "),r("li",[e._v("Return the "),r("em",[e._v("resolved")]),e._v(" destructured value of the result of "),r("strong",[e._v("PACKAGE_EXPORTS_RESOLVE")]),e._v("("),r("em",[e._v("packageURL")]),e._v(", "),r("em",[e._v("packageSubpath")]),e._v(", "),r("em",[e._v("pjson.exports")]),e._v(", "),r("em",[e._v("defaultConditions")]),e._v(").")])])]),e._v(" "),r("li",[e._v("Otherwise, if "),r("em",[e._v("packageSubpath")]),e._v(" is equal to "),r("em",[e._v('"."')]),e._v(", then\n"),r("ol",[r("li",[e._v("Return the result applying the legacy "),r("strong",[e._v("LOAD_AS_DIRECTORY")]),e._v(" CommonJS resolver to "),r("em",[e._v("packageURL")]),e._v(", throwing a "),r("em",[e._v("Module Not Found")]),e._v(" error for no resolution.")])])]),e._v(" "),r("li",[e._v("Otherwise,\n"),r("ol",[r("li",[e._v("Return the URL resolution of "),r("em",[e._v("packageSubpath")]),e._v(" in "),r("em",[e._v("packageURL")]),e._v(".")])])]),e._v(" "),r("li",[e._v("Throw a "),r("em",[e._v("Module Not Found")]),e._v(" error.")])])]),e._v(" "),r("p",[r("strong",[e._v("PACKAGE_SELF_RESOLVE")]),e._v("("),r("em",[e._v("packageName")]),e._v(", "),r("em",[e._v("packageSubpath")]),e._v(", "),r("em",[e._v("parentURL")]),e._v(")")]),e._v(" "),r("blockquote",[r("ol",[r("li",[e._v("Let "),r("em",[e._v("packageURL")]),e._v(" be the result of "),r("strong",[e._v("READ_PACKAGE_SCOPE")]),e._v("("),r("em",[e._v("parentURL")]),e._v(").")]),e._v(" "),r("li",[e._v("If "),r("em",[e._v("packageURL")]),e._v(" is "),r("strong",[e._v("null")]),e._v(", then\n"),r("ol",[r("li",[e._v("Return "),r("strong",[e._v("undefined")]),e._v(".")])])]),e._v(" "),r("li",[e._v("Let "),r("em",[e._v("pjson")]),e._v(" be the result of "),r("strong",[e._v("READ_PACKAGE_JSON")]),e._v("("),r("em",[e._v("packageURL")]),e._v(").")]),e._v(" "),r("li",[e._v("If "),r("em",[e._v("pjson")]),e._v(" is "),r("strong",[e._v("null")]),e._v(" or if "),r("em",[e._v("pjson")]),e._v("."),r("em",[e._v("exports")]),e._v(" is "),r("strong",[e._v("null")]),e._v(" or "),r("strong",[e._v("undefined")]),e._v(", then\n"),r("ol",[r("li",[e._v("Return "),r("strong",[e._v("undefined")]),e._v(".")])])]),e._v(" "),r("li",[e._v("If "),r("em",[e._v("pjson.name")]),e._v(" is equal to "),r("em",[e._v("packageName")]),e._v(", then\n"),r("ol",[r("li",[e._v("Return the "),r("em",[e._v("resolved")]),e._v(" destructured value of the result of "),r("strong",[e._v("PACKAGE_EXPORTS_RESOLVE")]),e._v("("),r("em",[e._v("packageURL")]),e._v(", "),r("em",[e._v("subpath")]),e._v(", "),r("em",[e._v("pjson.exports")]),e._v(", "),r("em",[e._v("defaultConditions")]),e._v(").")])])]),e._v(" "),r("li",[e._v("Otherwise, return "),r("strong",[e._v("undefined")]),e._v(".")])])]),e._v(" "),r("p",[r("strong",[e._v("PACKAGE_EXPORTS_RESOLVE")]),e._v("("),r("em",[e._v("packageURL")]),e._v(", "),r("em",[e._v("subpath")]),e._v(", "),r("em",[e._v("exports")]),e._v(", "),r("em",[e._v("conditions")]),e._v(")")]),e._v(" "),r("blockquote",[r("ol",[r("li",[e._v("If "),r("em",[e._v("exports")]),e._v(" is an Object with both a key starting with "),r("em",[e._v('"."')]),e._v(" and a key not starting with "),r("em",[e._v('"."')]),e._v(", throw an "),r("em",[e._v("Invalid Package Configuration")]),e._v(" error.")]),e._v(" "),r("li",[e._v("If "),r("em",[e._v("subpath")]),e._v(" is equal to "),r("em",[e._v('"."')]),e._v(", then\n"),r("ol",[r("li",[e._v("Let "),r("em",[e._v("mainExport")]),e._v(" be "),r("strong",[e._v("undefined")]),e._v(".")]),e._v(" "),r("li",[e._v("If "),r("em",[e._v("exports")]),e._v(" is a String or Array, or an Object containing no keys starting with "),r("em",[e._v('"."')]),e._v(", then\n"),r("ol",[r("li",[e._v("Set "),r("em",[e._v("mainExport")]),e._v(" to "),r("em",[e._v("exports")]),e._v(".")])])]),e._v(" "),r("li",[e._v("Otherwise if "),r("em",[e._v("exports")]),e._v(" is an Object containing a "),r("em",[e._v('"."')]),e._v(" property, then\n"),r("ol",[r("li",[e._v("Set "),r("em",[e._v("mainExport")]),e._v(" to "),r("em",[e._v("exports")]),e._v("["),r("em",[e._v('"."')]),e._v("].")])])]),e._v(" "),r("li",[e._v("If "),r("em",[e._v("mainExport")]),e._v(" is not "),r("strong",[e._v("undefined")]),e._v(", then\n"),r("ol",[r("li",[e._v("Let "),r("em",[e._v("resolved")]),e._v(" be the result of "),r("strong",[e._v("PACKAGE_TARGET_RESOLVE")]),e._v("( "),r("em",[e._v("packageURL")]),e._v(", "),r("em",[e._v("mainExport")]),e._v(", "),r("em",[e._v('""')]),e._v(", "),r("strong",[e._v("false")]),e._v(", "),r("strong",[e._v("false")]),e._v(", "),r("em",[e._v("conditions")]),e._v(").")]),e._v(" "),r("li",[e._v("If "),r("em",[e._v("resolved")]),e._v(" is not "),r("strong",[e._v("null")]),e._v(" or "),r("strong",[e._v("undefined")]),e._v(", then\n"),r("ol",[r("li",[e._v("Return "),r("em",[e._v("resolved")]),e._v(".")])])])])])])]),e._v(" "),r("li",[e._v("Otherwise, if "),r("em",[e._v("exports")]),e._v(" is an Object and all keys of "),r("em",[e._v("exports")]),e._v(" start with "),r("em",[e._v('"."')]),e._v(", then\n"),r("ol",[r("li",[e._v("Let "),r("em",[e._v("matchKey")]),e._v(" be the string "),r("em",[e._v('"./"')]),e._v(" concatenated with "),r("em",[e._v("subpath")]),e._v(".")]),e._v(" "),r("li",[e._v("Let "),r("em",[e._v("resolvedMatch")]),e._v(" be result of "),r("strong",[e._v("PACKAGE_IMPORTS_EXPORTS_RESOLVE")]),e._v("( "),r("em",[e._v("matchKey")]),e._v(", "),r("em",[e._v("exports")]),e._v(", "),r("em",[e._v("packageURL")]),e._v(", "),r("strong",[e._v("false")]),e._v(", "),r("em",[e._v("conditions")]),e._v(").")]),e._v(" "),r("li",[e._v("If "),r("em",[e._v("resolvedMatch")]),e._v("."),r("em",[e._v("resolve")]),e._v(" is not "),r("strong",[e._v("null")]),e._v(" or "),r("strong",[e._v("undefined")]),e._v(", then\n"),r("ol",[r("li",[e._v("Return "),r("em",[e._v("resolvedMatch")]),e._v(".")])])])])]),e._v(" "),r("li",[e._v("Throw a "),r("em",[e._v("Package Path Not Exported")]),e._v(" error.")])])]),e._v(" "),r("p",[r("strong",[e._v("PACKAGE_IMPORTS_RESOLVE")]),e._v("("),r("em",[e._v("specifier")]),e._v(", "),r("em",[e._v("parentURL")]),e._v(", "),r("em",[e._v("conditions")]),e._v(")")]),e._v(" "),r("blockquote",[r("ol",[r("li",[e._v("Assert: "),r("em",[e._v("specifier")]),e._v(" begins with "),r("em",[e._v('"#"')]),e._v(".")]),e._v(" "),r("li",[e._v("If "),r("em",[e._v("specifier")]),e._v(" is exactly equal to "),r("em",[e._v('"#"')]),e._v(" or starts with "),r("em",[e._v('"#/"')]),e._v(", then\n"),r("ol",[r("li",[e._v("Throw an "),r("em",[e._v("Invalid Module Specifier")]),e._v(" error.")])])]),e._v(" "),r("li",[e._v("Let "),r("em",[e._v("packageURL")]),e._v(" be the result of "),r("strong",[e._v("READ_PACKAGE_SCOPE")]),e._v("("),r("em",[e._v("parentURL")]),e._v(").")]),e._v(" "),r("li",[e._v("If "),r("em",[e._v("packageURL")]),e._v(" is not "),r("strong",[e._v("null")]),e._v(", then\n"),r("ol",[r("li",[e._v("Let "),r("em",[e._v("pjson")]),e._v(" be the result of "),r("strong",[e._v("READ_PACKAGE_JSON")]),e._v("("),r("em",[e._v("packageURL")]),e._v(").")]),e._v(" "),r("li",[e._v("If "),r("em",[e._v("pjson.imports")]),e._v(" is a non-null Object, then\n"),r("ol",[r("li",[e._v("Let "),r("em",[e._v("resolvedMatch")]),e._v(" be the result of "),r("strong",[e._v("PACKAGE_IMPORTS_EXPORTS_RESOLVE")]),e._v("("),r("em",[e._v("specifier")]),e._v(", "),r("em",[e._v("pjson.imports")]),e._v(", "),r("em",[e._v("packageURL")]),e._v(", "),r("strong",[e._v("true")]),e._v(", "),r("em",[e._v("conditions")]),e._v(").")]),e._v(" "),r("li",[e._v("If "),r("em",[e._v("resolvedMatch")]),e._v("."),r("em",[e._v("resolve")]),e._v(" is not "),r("strong",[e._v("null")]),e._v(" or "),r("strong",[e._v("undefined")]),e._v(", then\n"),r("ol",[r("li",[e._v("Return "),r("em",[e._v("resolvedMatch")]),e._v(".")])])])])])])]),e._v(" "),r("li",[e._v("Throw a "),r("em",[e._v("Package Import Not Defined")]),e._v(" error.")])])]),e._v(" "),r("p",[r("strong",[e._v("PACKAGE_IMPORTS_EXPORTS_RESOLVE")]),e._v("("),r("em",[e._v("matchKey")]),e._v(", "),r("em",[e._v("matchObj")]),e._v(", "),r("em",[e._v("packageURL")]),e._v(", "),r("em",[e._v("isImports")]),e._v(", "),r("em",[e._v("conditions")]),e._v(")")]),e._v(" "),r("blockquote",[r("ol",[r("li",[e._v("If "),r("em",[e._v("matchKey")]),e._v(" is a key of "),r("em",[e._v("matchObj")]),e._v(", and does not end in "),r("em",[e._v('"*"')]),e._v(", then\n"),r("ol",[r("li",[e._v("Let "),r("em",[e._v("target")]),e._v(" be the value of "),r("em",[e._v("matchObj")]),e._v("["),r("em",[e._v("matchKey")]),e._v("].")]),e._v(" "),r("li",[e._v("Let "),r("em",[e._v("resolved")]),e._v(" be the result of "),r("strong",[e._v("PACKAGE_TARGET_RESOLVE")]),e._v("( "),r("em",[e._v("packageURL")]),e._v(", "),r("em",[e._v("target")]),e._v(", "),r("em",[e._v('""')]),e._v(", "),r("strong",[e._v("false")]),e._v(", "),r("em",[e._v("isImports")]),e._v(", "),r("em",[e._v("conditions")]),e._v(").")]),e._v(" "),r("li",[e._v("Return the object "),r("em",[e._v("{ resolved, exact: "),r("strong",[e._v("true")]),e._v(" }")]),e._v(".")])])]),e._v(" "),r("li",[e._v("Let "),r("em",[e._v("expansionKeys")]),e._v(" be the list of keys of "),r("em",[e._v("matchObj")]),e._v(" ending in "),r("em",[e._v('"/"')]),e._v(" or "),r("em",[e._v('"*"')]),e._v(", sorted by length descending.")]),e._v(" "),r("li",[e._v("For each key "),r("em",[e._v("expansionKey")]),e._v(" in "),r("em",[e._v("expansionKeys")]),e._v(", do\n"),r("ol",[r("li",[e._v("If "),r("em",[e._v("expansionKey")]),e._v(" ends in "),r("em",[e._v('"*"')]),e._v(" and "),r("em",[e._v("matchKey")]),e._v(" starts with but is not equal to the substring of "),r("em",[e._v("expansionKey")]),e._v(" excluding the last "),r("em",[e._v('"*"')]),e._v(" character, then\n"),r("ol",[r("li",[e._v("Let "),r("em",[e._v("target")]),e._v(" be the value of "),r("em",[e._v("matchObj")]),e._v("["),r("em",[e._v("expansionKey")]),e._v("].")]),e._v(" "),r("li",[e._v("Let "),r("em",[e._v("subpath")]),e._v(" be the substring of "),r("em",[e._v("matchKey")]),e._v(" starting at the index of the length of "),r("em",[e._v("expansionKey")]),e._v(" minus one.")]),e._v(" "),r("li",[e._v("Let "),r("em",[e._v("resolved")]),e._v(" be the result of "),r("strong",[e._v("PACKAGE_TARGET_RESOLVE")]),e._v("( "),r("em",[e._v("packageURL")]),e._v(", "),r("em",[e._v("target")]),e._v(", "),r("em",[e._v("subpath")]),e._v(", "),r("strong",[e._v("true")]),e._v(", "),r("em",[e._v("isImports")]),e._v(", "),r("em",[e._v("conditions")]),e._v(").")]),e._v(" "),r("li",[e._v("Return the object "),r("em",[e._v("{ resolved, exact: "),r("strong",[e._v("true")]),e._v(" }")]),e._v(".")])])]),e._v(" "),r("li",[e._v("If "),r("em",[e._v("matchKey")]),e._v(" starts with "),r("em",[e._v("expansionKey")]),e._v(", then\n"),r("ol",[r("li",[e._v("Let "),r("em",[e._v("target")]),e._v(" be the value of "),r("em",[e._v("matchObj")]),e._v("["),r("em",[e._v("expansionKey")]),e._v("].")]),e._v(" "),r("li",[e._v("Let "),r("em",[e._v("subpath")]),e._v(" be the substring of "),r("em",[e._v("matchKey")]),e._v(" starting at the index of the length of "),r("em",[e._v("expansionKey")]),e._v(".")]),e._v(" "),r("li",[e._v("Let "),r("em",[e._v("resolved")]),e._v(" be the result of "),r("strong",[e._v("PACKAGE_TARGET_RESOLVE")]),e._v("( "),r("em",[e._v("packageURL")]),e._v(", "),r("em",[e._v("target")]),e._v(", "),r("em",[e._v("subpath")]),e._v(", "),r("strong",[e._v("false")]),e._v(", "),r("em",[e._v("isImports")]),e._v(", "),r("em",[e._v("conditions")]),e._v(").")]),e._v(" "),r("li",[e._v("Return the object "),r("em",[e._v("{ resolved, exact: "),r("strong",[e._v("false")]),e._v(" }")]),e._v(".")])])])])]),e._v(" "),r("li",[e._v("Return the object "),r("em",[e._v("{ resolved: "),r("strong",[e._v("null")]),e._v(", exact: "),r("strong",[e._v("true")]),e._v(" }")]),e._v(".")])])]),e._v(" "),r("p",[r("strong",[e._v("PACKAGE_TARGET_RESOLVE")]),e._v("("),r("em",[e._v("packageURL")]),e._v(", "),r("em",[e._v("target")]),e._v(", "),r("em",[e._v("subpath")]),e._v(", "),r("em",[e._v("pattern")]),e._v(", "),r("em",[e._v("internal")]),e._v(", "),r("em",[e._v("conditions")]),e._v(")")]),e._v(" "),r("blockquote",[r("ol",[r("li",[e._v("If "),r("em",[e._v("target")]),e._v(" is a String, then\n"),r("ol",[r("li",[e._v("If "),r("em",[e._v("pattern")]),e._v(" is "),r("strong",[e._v("false")]),e._v(", "),r("em",[e._v("subpath")]),e._v(" has non-zero length and "),r("em",[e._v("target")]),e._v(" does not end with "),r("em",[e._v('"/"')]),e._v(", throw an "),r("em",[e._v("Invalid Module Specifier")]),e._v(" error.")]),e._v(" "),r("li",[e._v("If "),r("em",[e._v("target")]),e._v(" does not start with "),r("em",[e._v('"./"')]),e._v(", then\n"),r("ol",[r("li",[e._v("If "),r("em",[e._v("internal")]),e._v(" is "),r("strong",[e._v("true")]),e._v(" and "),r("em",[e._v("target")]),e._v(" does not start with "),r("em",[e._v('"../"')]),e._v(" or "),r("em",[e._v('"/"')]),e._v(" and is not a valid URL, then\n"),r("ol",[r("li",[e._v("If "),r("em",[e._v("pattern")]),e._v(" is "),r("strong",[e._v("true")]),e._v(", then\n"),r("ol",[r("li",[e._v("Return "),r("strong",[e._v("PACKAGE_RESOLVE")]),e._v("("),r("em",[e._v("target")]),e._v(" with every instance of "),r("em",[e._v('"*"')]),e._v(" replaced by "),r("em",[e._v("subpath")]),e._v(", "),r("em",[e._v("packageURL")]),e._v(" + "),r("em",[e._v('"/"')]),e._v(")_.")])])]),e._v(" "),r("li",[e._v("Return "),r("strong",[e._v("PACKAGE_RESOLVE")]),e._v("("),r("em",[e._v("target")]),e._v(" + "),r("em",[e._v("subpath")]),e._v(", "),r("em",[e._v("packageURL")]),e._v(" + "),r("em",[e._v('"/"')]),e._v(")_.")])])]),e._v(" "),r("li",[e._v("Otherwise, throw an "),r("em",[e._v("Invalid Package Target")]),e._v(" error.")])])]),e._v(" "),r("li",[e._v("If "),r("em",[e._v("target")]),e._v(" split on "),r("em",[e._v('"/"')]),e._v(" or "),r("em",[e._v('"\\"')]),e._v(" contains any "),r("em",[e._v('"."')]),e._v(", "),r("em",[e._v('".."')]),e._v(" or "),r("em",[e._v('"node_modules"')]),e._v(" segments after the first segment, throw an "),r("em",[e._v("Invalid Package Target")]),e._v(" error.")]),e._v(" "),r("li",[e._v("Let "),r("em",[e._v("resolvedTarget")]),e._v(" be the URL resolution of the concatenation of "),r("em",[e._v("packageURL")]),e._v(" and "),r("em",[e._v("target")]),e._v(".")]),e._v(" "),r("li",[e._v("Assert: "),r("em",[e._v("resolvedTarget")]),e._v(" is contained in "),r("em",[e._v("packageURL")]),e._v(".")]),e._v(" "),r("li",[e._v("If "),r("em",[e._v("subpath")]),e._v(" split on "),r("em",[e._v('"/"')]),e._v(" or "),r("em",[e._v('"\\"')]),e._v(" contains any "),r("em",[e._v('"."')]),e._v(", "),r("em",[e._v('".."')]),e._v(" or "),r("em",[e._v('"node_modules"')]),e._v(" segments, throw an "),r("em",[e._v("Invalid Module Specifier")]),e._v(" error.")]),e._v(" "),r("li",[e._v("If "),r("em",[e._v("pattern")]),e._v(" is "),r("strong",[e._v("true")]),e._v(", then\n"),r("ol",[r("li",[e._v("Return the URL resolution of "),r("em",[e._v("resolvedTarget")]),e._v(" with every instance of "),r("em",[e._v('"*"')]),e._v(" replaced with "),r("em",[e._v("subpath")]),e._v(".")])])]),e._v(" "),r("li",[e._v("Otherwise,\n"),r("ol",[r("li",[e._v("Return the URL resolution of the concatenation of "),r("em",[e._v("subpath")]),e._v(" and "),r("em",[e._v("resolvedTarget")]),e._v(".")])])])])]),e._v(" "),r("li",[e._v("Otherwise, if "),r("em",[e._v("target")]),e._v(" is a non-null Object, then\n"),r("ol",[r("li",[e._v("If "),r("em",[e._v("exports")]),e._v(" contains any index property keys, as defined in ECMA-262 "),r("a",{attrs:{href:"http://url.nodejs.cn/HGLN85",target:"_blank",rel:"noopener noreferrer"}},[e._v("6.1.7 Array Index"),r("OutboundLink")],1),e._v(", throw an "),r("em",[e._v("Invalid Package Configuration")]),e._v(" error.")]),e._v(" "),r("li",[e._v("For each property "),r("em",[e._v("p")]),e._v(" of "),r("em",[e._v("target")]),e._v(", in object insertion order as,\n"),r("ol",[r("li",[e._v("If "),r("em",[e._v("p")]),e._v(" equals "),r("em",[e._v('"default"')]),e._v(" or "),r("em",[e._v("conditions")]),e._v(" contains an entry for "),r("em",[e._v("p")]),e._v(", then\n"),r("ol",[r("li",[e._v("Let "),r("em",[e._v("targetValue")]),e._v(" be the value of the "),r("em",[e._v("p")]),e._v(" property in "),r("em",[e._v("target")]),e._v(".")]),e._v(" "),r("li",[e._v("Let "),r("em",[e._v("resolved")]),e._v(" be the result of "),r("strong",[e._v("PACKAGE_TARGET_RESOLVE")]),e._v("( "),r("em",[e._v("packageURL")]),e._v(", "),r("em",[e._v("targetValue")]),e._v(", "),r("em",[e._v("subpath")]),e._v(", "),r("em",[e._v("pattern")]),e._v(", "),r("em",[e._v("internal")]),e._v(", "),r("em",[e._v("conditions")]),e._v(").")]),e._v(" "),r("li",[e._v("If "),r("em",[e._v("resolved")]),e._v(" is equal to "),r("strong",[e._v("undefined")]),e._v(", continue the loop.")]),e._v(" "),r("li",[e._v("Return "),r("em",[e._v("resolved")]),e._v(".")])])])])]),e._v(" "),r("li",[e._v("Return "),r("strong",[e._v("undefined")]),e._v(".")])])]),e._v(" "),r("li",[e._v("Otherwise, if "),r("em",[e._v("target")]),e._v(" is an Array, then\n"),r("ol",[r("li",[e._v("If _target.length is zero, return "),r("strong",[e._v("null")]),e._v(".")]),e._v(" "),r("li",[e._v("For each item "),r("em",[e._v("targetValue")]),e._v(" in "),r("em",[e._v("target")]),e._v(", do\n"),r("ol",[r("li",[e._v("Let "),r("em",[e._v("resolved")]),e._v(" be the result of "),r("strong",[e._v("PACKAGE_TARGET_RESOLVE")]),e._v("( "),r("em",[e._v("packageURL")]),e._v(", "),r("em",[e._v("targetValue")]),e._v(", "),r("em",[e._v("subpath")]),e._v(", "),r("em",[e._v("pattern")]),e._v(", "),r("em",[e._v("internal")]),e._v(", "),r("em",[e._v("conditions")]),e._v("), continuing the loop on any "),r("em",[e._v("Invalid Package Target")]),e._v(" error.")]),e._v(" "),r("li",[e._v("If "),r("em",[e._v("resolved")]),e._v(" is "),r("strong",[e._v("undefined")]),e._v(", continue the loop.")]),e._v(" "),r("li",[e._v("Return "),r("em",[e._v("resolved")]),e._v(".")])])]),e._v(" "),r("li",[e._v("Return or throw the last fallback resolution "),r("strong",[e._v("null")]),e._v(" return or error.")])])]),e._v(" "),r("li",[e._v("Otherwise, if "),r("em",[e._v("target")]),e._v(" is "),r("em",[e._v("null")]),e._v(", return "),r("strong",[e._v("null")]),e._v(".")]),e._v(" "),r("li",[e._v("Otherwise throw an "),r("em",[e._v("Invalid Package Target")]),e._v(" error.")])])]),e._v(" "),r("p",[r("strong",[e._v("ESM_FORMAT")]),e._v("("),r("em",[e._v("url")]),e._v(")")]),e._v(" "),r("blockquote",[r("ol",[r("li",[e._v("Assert: "),r("em",[e._v("url")]),e._v(" corresponds to an existing file.")]),e._v(" "),r("li",[e._v("Let "),r("em",[e._v("pjson")]),e._v(" be the result of "),r("strong",[e._v("READ_PACKAGE_SCOPE")]),e._v("("),r("em",[e._v("url")]),e._v(").")]),e._v(" "),r("li",[e._v("If "),r("em",[e._v("url")]),e._v(" ends in "),r("em",[e._v('".mjs"')]),e._v(", then\n"),r("ol",[r("li",[e._v("Return "),r("em",[e._v('"module"')]),e._v(".")])])]),e._v(" "),r("li",[e._v("If "),r("em",[e._v("url")]),e._v(" ends in "),r("em",[e._v('".cjs"')]),e._v(", then\n"),r("ol",[r("li",[e._v("Return "),r("em",[e._v('"commonjs"')]),e._v(".")])])]),e._v(" "),r("li",[e._v("If "),r("em",[e._v("pjson?.type")]),e._v(" exists and is "),r("em",[e._v('"module"')]),e._v(", then\n"),r("ol",[r("li",[e._v("If "),r("em",[e._v("url")]),e._v(" ends in "),r("em",[e._v('".js"')]),e._v(", then\n"),r("ol",[r("li",[e._v("Return "),r("em",[e._v('"module"')]),e._v(".")])])]),e._v(" "),r("li",[e._v("Throw an "),r("em",[e._v("Unsupported File Extension")]),e._v(" error.")])])]),e._v(" "),r("li",[e._v("Otherwise,\n"),r("ol",[r("li",[e._v("Throw an "),r("em",[e._v("Unsupported File Extension")]),e._v(" error.")])])])])]),e._v(" "),r("p",[r("strong",[e._v("READ_PACKAGE_SCOPE")]),e._v("("),r("em",[e._v("url")]),e._v(")")]),e._v(" "),r("blockquote",[r("ol",[r("li",[e._v("Let "),r("em",[e._v("scopeURL")]),e._v(" be "),r("em",[e._v("url")]),e._v(".")]),e._v(" "),r("li",[e._v("While "),r("em",[e._v("scopeURL")]),e._v(" is not the file system root,\n"),r("ol",[r("li",[e._v("Set "),r("em",[e._v("scopeURL")]),e._v(" to the parent URL of "),r("em",[e._v("scopeURL")]),e._v(".")]),e._v(" "),r("li",[e._v("If "),r("em",[e._v("scopeURL")]),e._v(" ends in a "),r("em",[e._v('"node_modules"')]),e._v(" path segment, return "),r("strong",[e._v("null")]),e._v(".")]),e._v(" "),r("li",[e._v("Let "),r("em",[e._v("pjson")]),e._v(" be the result of "),r("strong",[e._v("READ_PACKAGE_JSON")]),e._v("("),r("em",[e._v("scopeURL")]),e._v(").")]),e._v(" "),r("li",[e._v("If "),r("em",[e._v("pjson")]),e._v(" is not "),r("strong",[e._v("null")]),e._v(", then\n"),r("ol",[r("li",[e._v("Return "),r("em",[e._v("pjson")]),e._v(".")])])])])]),e._v(" "),r("li",[e._v("Return "),r("strong",[e._v("null")]),e._v(".")])])]),e._v(" "),r("p",[r("strong",[e._v("READ_PACKAGE_JSON")]),e._v("("),r("em",[e._v("packageURL")]),e._v(")")]),e._v(" "),r("blockquote",[r("ol",[r("li",[e._v("Let "),r("em",[e._v("pjsonURL")]),e._v(" be the resolution of "),r("em",[e._v('"package.json"')]),e._v(" within "),r("em",[e._v("packageURL")]),e._v(".")]),e._v(" "),r("li",[e._v("If the file at "),r("em",[e._v("pjsonURL")]),e._v(" does not exist, then\n"),r("ol",[r("li",[e._v("Return "),r("strong",[e._v("null")]),e._v(".")])])]),e._v(" "),r("li",[e._v("If the file at "),r("em",[e._v("packageURL")]),e._v(" does not parse as valid JSON, then\n"),r("ol",[r("li",[e._v("Throw an "),r("em",[e._v("Invalid Package Configuration")]),e._v(" error.")])])]),e._v(" "),r("li",[e._v("Return the parsed JSON source of the file at "),r("em",[e._v("pjsonURL")]),e._v(".")])])]),e._v(" "),r("h4",{attrs:{id:"自定义的-esm-说明符解析算法"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#自定义的-esm-说明符解析算法"}},[e._v("#")]),e._v(" 自定义的 ESM 说明符解析算法"),r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm.html#customizing-esm-specifier-resolution-algorithm",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"http://nodejs.cn/api-v12/esm/customizing_esm_specifier_resolution_algorithm.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("中英对照"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("当前的说明符解析不支持 CommonJS 加载器的所有默认行为。 行为差异之一是文件扩展名的自动解析以及导入具有索引文件的目录的能力。")]),e._v(" "),r("p",[r("code",[e._v("--experimental-specifier-resolution=[mode]")]),e._v(" 标志可用于自定义扩展解析算法。 默认模式是 "),r("code",[e._v("explicit")]),e._v("，这需要向加载器提供模块的完整路径。 要启用自动扩展解析并从包含索引文件的目录导入，则使用 "),r("code",[e._v("node")]),e._v(" 模式。")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("$ node index.mjs\nsuccess!\n$ node index # 失败！\nError: Cannot find module\n$ node --experimental-specifier-resolution=node index\nsuccess!\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br")])])])}),[],!1,null,null,null);t.default=s.exports}}]);