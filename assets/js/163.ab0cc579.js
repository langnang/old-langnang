(window.webpackJsonp=window.webpackJsonp||[]).push([[163],{630:function(e,t,n){"use strict";n.r(t);var a=n(18),r=Object(a.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"trace-events-跟踪事件-node-js-api-文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#trace-events-跟踪事件-node-js-api-文档"}},[e._v("#")]),e._v(" trace_events 跟踪事件 | Node.js API 文档")]),e._v(" "),n("blockquote",[n("h2",{attrs:{id:"excerpt"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#excerpt"}},[e._v("#")]),e._v(" Excerpt")]),e._v(" "),n("p",[e._v("源代码: lib/trace_events.js")])]),e._v(" "),n("hr"),e._v(" "),n("p",[n("strong",[e._v("源代码:")]),e._v(" "),n("a",{attrs:{href:"https://github.com/nodejs/node/blob/v12.22.12/lib/trace_events.js",target:"_blank",rel:"noopener noreferrer"}},[e._v("lib/trace_events.js"),n("OutboundLink")],1)]),e._v(" "),n("p",[e._v("The "),n("code",[e._v("trace_events")]),e._v(" module provides a mechanism to centralize tracing information generated by V8, Node.js core, and userspace code.")]),e._v(" "),n("p",[e._v("Tracing can be enabled with the "),n("code",[e._v("--trace-event-categories")]),e._v(" command-line flag or by using the "),n("code",[e._v("trace_events")]),e._v(" module. The "),n("code",[e._v("--trace-event-categories")]),e._v(" flag accepts a list of comma-separated category names.")]),e._v(" "),n("p",[e._v("The available categories are:")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("node")]),e._v(": An empty placeholder.")]),e._v(" "),n("li",[n("code",[e._v("node.async_hooks")]),e._v(": Enables capture of detailed "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/async_hooks.html",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("async_hooks")]),n("OutboundLink")],1),e._v(" trace data. The "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/async_hooks.html",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("async_hooks")]),n("OutboundLink")],1),e._v(" events have a unique "),n("code",[e._v("asyncId")]),e._v(" and a special "),n("code",[e._v("triggerId")]),e._v(" "),n("code",[e._v("triggerAsyncId")]),e._v(" property.")]),e._v(" "),n("li",[n("code",[e._v("node.bootstrap")]),e._v(": Enables capture of Node.js bootstrap milestones.")]),e._v(" "),n("li",[n("code",[e._v("node.console")]),e._v(": Enables capture of "),n("code",[e._v("console.time()")]),e._v(" and "),n("code",[e._v("console.count()")]),e._v(" output.")]),e._v(" "),n("li",[n("code",[e._v("node.dns.native")]),e._v(": Enables capture of trace data for DNS queries.")]),e._v(" "),n("li",[n("code",[e._v("node.environment")]),e._v(": Enables capture of Node.js Environment milestones.")]),e._v(" "),n("li",[n("code",[e._v("node.fs.sync")]),e._v(": Enables capture of trace data for file system sync methods.")]),e._v(" "),n("li",[n("code",[e._v("node.perf")]),e._v(": Enables capture of "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/perf_hooks.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Performance API"),n("OutboundLink")],1),e._v(" measurements.\n"),n("ul",[n("li",[n("code",[e._v("node.perf.usertiming")]),e._v(": Enables capture of only Performance API User Timing measures and marks.")]),e._v(" "),n("li",[n("code",[e._v("node.perf.timerify")]),e._v(": Enables capture of only Performance API timerify measurements.")])])]),e._v(" "),n("li",[n("code",[e._v("node.promises.rejections")]),e._v(": Enables capture of trace data tracking the number of unhandled Promise rejections and handled-after-rejections.")]),e._v(" "),n("li",[n("code",[e._v("node.vm.script")]),e._v(": Enables capture of trace data for the "),n("code",[e._v("vm")]),e._v(" module's "),n("code",[e._v("runInNewContext()")]),e._v(", "),n("code",[e._v("runInContext()")]),e._v(", and "),n("code",[e._v("runInThisContext()")]),e._v(" methods.")]),e._v(" "),n("li",[n("code",[e._v("v8")]),e._v(": The "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/v8.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("V8"),n("OutboundLink")],1),e._v(" events are GC, compiling, and execution related.")])]),e._v(" "),n("p",[e._v("By default the "),n("code",[e._v("node")]),e._v(", "),n("code",[e._v("node.async_hooks")]),e._v(", and "),n("code",[e._v("v8")]),e._v(" categories are enabled.")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("node --trace-event-categories v8,node,node.async_hooks server.js\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("p",[e._v("Prior versions of Node.js required the use of the "),n("code",[e._v("--trace-events-enabled")]),e._v(" flag to enable trace events. This requirement has been removed. However, the "),n("code",[e._v("--trace-events-enabled")]),e._v(" flag "),n("em",[e._v("may")]),e._v(" still be used and will enable the "),n("code",[e._v("node")]),e._v(", "),n("code",[e._v("node.async_hooks")]),e._v(", and "),n("code",[e._v("v8")]),e._v(" trace event categories by default.")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("node --trace-events-enabled\n\n# is equivalent to\n\nnode --trace-event-categories v8,node,node.async_hooks\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br")])]),n("p",[e._v("Alternatively, trace events may be enabled using the "),n("code",[e._v("trace_events")]),e._v(" module:")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("const trace_events = require('trace_events');\nconst tracing = trace_events.createTracing({ categories: ['node.perf'] });\ntracing.enable();  // Enable trace event capture for the 'node.perf' category\n\n// do work\n\ntracing.disable();  // Disable trace event capture for the 'node.perf' category\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br")])]),n("p",[e._v("Running Node.js with tracing enabled will produce log files that can be opened in the "),n("a",{attrs:{href:"http://url.nodejs.cn/iRRSAT",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("chrome://tracing")]),n("OutboundLink")],1),e._v(" tab of Chrome.")]),e._v(" "),n("p",[e._v("The logging file is by default called "),n("code",[e._v("node_trace.${rotation}.log")]),e._v(", where "),n("code",[e._v("${rotation}")]),e._v(" is an incrementing log-rotation id. The filepath pattern can be specified with "),n("code",[e._v("--trace-event-file-pattern")]),e._v(" that accepts a template string that supports "),n("code",[e._v("${rotation}")]),e._v(" and "),n("code",[e._v("${pid}")]),e._v(":")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("node --trace-event-categories v8 --trace-event-file-pattern '${pid}-${rotation}.log' server.js\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("p",[e._v("The tracing system uses the same time source as the one used by "),n("code",[e._v("process.hrtime()")]),e._v(". However the trace-event timestamps are expressed in microseconds, unlike "),n("code",[e._v("process.hrtime()")]),e._v(" which returns nanoseconds.")]),e._v(" "),n("p",[e._v("The features from this module are not available in "),n("a",{attrs:{href:"http://nodejs.cn/api-v12/worker_threads.html#worker_threads_class_worker",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("Worker")]),n("OutboundLink")],1),e._v(" threads.")]),e._v(" "),n("h3",{attrs:{id:"trace-events-模块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#trace-events-模块"}},[e._v("#")]),e._v(" `trace_events` 模块"),n("a",{attrs:{href:"http://nodejs.cn/api-v12/tracing.html#the-trace_events-module",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[e._v("新增于: v10.0.0")]),e._v(" "),n("h4",{attrs:{id:"tracing-对象"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#tracing-对象"}},[e._v("#")]),e._v(" `Tracing` 对象"),n("a",{attrs:{href:"http://nodejs.cn/api-v12/tracing.html#tracing-object",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[e._v("新增于: v10.0.0")]),e._v(" "),n("p",[e._v("The "),n("code",[e._v("Tracing")]),e._v(" object is used to enable or disable tracing for sets of categories. Instances are created using the "),n("code",[e._v("trace_events.createTracing()")]),e._v(" method.")]),e._v(" "),n("p",[e._v("When created, the "),n("code",[e._v("Tracing")]),e._v(" object is disabled. Calling the "),n("code",[e._v("tracing.enable()")]),e._v(" method adds the categories to the set of enabled trace event categories. Calling "),n("code",[e._v("tracing.disable()")]),e._v(" will remove the categories from the set of enabled trace event categories.")]),e._v(" "),n("h5",{attrs:{id:"tracing-categories"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#tracing-categories"}},[e._v("#")]),e._v(" "),n("code",[e._v("tracing.categories")]),n("a",{attrs:{href:"http://nodejs.cn/api-v12/tracing.html#tracingcategories",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[e._v("新增于: v10.0.0")]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1)])]),e._v(" "),n("p",[e._v("A comma-separated list of the trace event categories covered by this "),n("code",[e._v("Tracing")]),e._v(" object.")]),e._v(" "),n("h5",{attrs:{id:"tracing-disable"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#tracing-disable"}},[e._v("#")]),e._v(" "),n("code",[e._v("tracing.disable()")]),n("a",{attrs:{href:"http://nodejs.cn/api-v12/tracing.html#tracingdisable",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[e._v("新增于: v10.0.0")]),e._v(" "),n("p",[e._v("Disables this "),n("code",[e._v("Tracing")]),e._v(" object.")]),e._v(" "),n("p",[e._v("Only trace event categories "),n("em",[e._v("not")]),e._v(" covered by other enabled "),n("code",[e._v("Tracing")]),e._v(" objects and "),n("em",[e._v("not")]),e._v(" specified by the "),n("code",[e._v("--trace-event-categories")]),e._v(" flag will be disabled.")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("const trace_events = require('trace_events');\nconst t1 = trace_events.createTracing({ categories: ['node', 'v8'] });\nconst t2 = trace_events.createTracing({ categories: ['node.perf', 'node'] });\nt1.enable();\nt2.enable();\n\n// Prints 'node,node.perf,v8'\nconsole.log(trace_events.getEnabledCategories());\n\nt2.disable(); // Will only disable emission of the 'node.perf' category\n\n// Prints 'node,v8'\nconsole.log(trace_events.getEnabledCategories());\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br")])]),n("h5",{attrs:{id:"tracing-enable"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#tracing-enable"}},[e._v("#")]),e._v(" "),n("code",[e._v("tracing.enable()")]),n("a",{attrs:{href:"http://nodejs.cn/api-v12/tracing.html#tracingenable",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[e._v("新增于: v10.0.0")]),e._v(" "),n("p",[e._v("Enables this "),n("code",[e._v("Tracing")]),e._v(" object for the set of categories covered by the "),n("code",[e._v("Tracing")]),e._v(" object.")]),e._v(" "),n("h5",{attrs:{id:"tracing-enabled"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#tracing-enabled"}},[e._v("#")]),e._v(" "),n("code",[e._v("tracing.enabled")]),n("a",{attrs:{href:"http://nodejs.cn/api-v12/tracing.html#tracingenabled",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[e._v("新增于: v10.0.0")]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"http://url.nodejs.cn/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1),e._v(" "),n("code",[e._v("true")]),e._v(" only if the "),n("code",[e._v("Tracing")]),e._v(" object has been enabled.")])]),e._v(" "),n("h4",{attrs:{id:"trace-events-createtracing-options"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#trace-events-createtracing-options"}},[e._v("#")]),e._v(" "),n("code",[e._v("trace_events.createTracing(options)")]),n("a",{attrs:{href:"http://nodejs.cn/api-v12/tracing.html#trace_eventscreatetracingoptions",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[e._v("新增于: v10.0.0")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("options")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1),e._v(" "),n("ul",[n("li",[n("code",[e._v("categories")]),e._v(" "),n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[e._v("<string[]>"),n("OutboundLink")],1),e._v(" An array of trace category names. Values included in the array are coerced to a string when possible. An error will be thrown if the value cannot be coerced.")])])]),e._v(" "),n("li",[e._v("返回: "),n("a",{attrs:{href:"http://nodejs.cn/api/tracing.html#tracing-object",target:"_blank",rel:"noopener noreferrer"}},[n("Tracing",[n("OutboundLink")],1)],1),e._v(".")])]),e._v(" "),n("p",[e._v("Creates and returns a "),n("code",[e._v("Tracing")]),e._v(" object for the given set of "),n("code",[e._v("categories")]),e._v(".")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("const trace_events = require('trace_events');\nconst categories = ['node.perf', 'node.async_hooks'];\nconst tracing = trace_events.createTracing({ categories });\ntracing.enable();\n// do stuff\ntracing.disable();\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br")])]),n("h4",{attrs:{id:"trace-events-getenabledcategories"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#trace-events-getenabledcategories"}},[e._v("#")]),e._v(" "),n("code",[e._v("trace_events.getEnabledCategories()")]),n("a",{attrs:{href:"http://nodejs.cn/api-v12/tracing.html#trace_eventsgetenabledcategories",target:"_blank",rel:"noopener noreferrer"}},[e._v("#"),n("OutboundLink")],1)]),e._v(" "),n("p",[e._v("新增于: v10.0.0")]),e._v(" "),n("ul",[n("li",[e._v("返回: "),n("a",{attrs:{href:"http://url.nodejs.cn/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1)])]),e._v(" "),n("p",[e._v("Returns a comma-separated list of all currently-enabled trace event categories. The current set of enabled trace event categories is determined by the "),n("em",[e._v("union")]),e._v(" of all currently-enabled "),n("code",[e._v("Tracing")]),e._v(" objects and any categories enabled using the "),n("code",[e._v("--trace-event-categories")]),e._v(" flag.")]),e._v(" "),n("p",[e._v("Given the file "),n("code",[e._v("test.js")]),e._v(" below, the command "),n("code",[e._v("node --trace-event-categories node.perf test.js")]),e._v(" will print "),n("code",[e._v("'node.async_hooks,node.perf'")]),e._v(" to the console.")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("const trace_events = require('trace_events');\nconst t1 = trace_events.createTracing({ categories: ['node.async_hooks'] });\nconst t2 = trace_events.createTracing({ categories: ['node.perf'] });\nconst t3 = trace_events.createTracing({ categories: ['v8'] });\n\nt1.enable();\nt2.enable();\n\nconsole.log(trace_events.getEnabledCategories());\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br")])])])}),[],!1,null,null,null);t.default=r.exports}}]);